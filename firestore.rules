rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ⚠️⚠️⚠️ DEVELOPMENT MODE - MUST CHANGE BEFORE PRODUCTION! ⚠️⚠️⚠️
    // Temporarily allowing all operations for development
    // TODO: Implement proper Clerk + Firebase integration before production
    
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return true; // TEMPORARY: Allow all for development
    }
    
    // Helper function to get current user ID (works with Clerk)
    function getUserId() {
      // TEMPORARY: Return a dummy value for development
      return request.auth != null && request.auth.uid != null ? request.auth.uid : 
             (request.auth != null && request.auth.token.sub != null ? request.auth.token.sub : "dev-user");
    }
    
    // Users can only access their own data
    match /users/{userId} {
      allow read, write: if isAuthenticated() && getUserId() == userId;
    }
    
    // Income data - users can only access their own income records
    match /incomes/{incomeId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Expense data - users can only access their own expense records
    match /expenses/{expenseId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Portfolio data - users can only access their own portfolio
    match /portfolios/{portfolioId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Budget data - users can only access their own budgets
    match /budgets/{budgetId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Notes data - users can only access their own notes
    match /notes/{noteId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Calendar events - users can only access their own events
    match /calendar/{eventId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Cargo tracking - users can only access their own cargo data
    match /cargo/{cargoId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Subscriptions - users can only access their own subscriptions
    match /subscriptions/{subscriptionId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Family data - users can access family data they belong to
    match /families/{familyId} {
      allow read, write: if isAuthenticated() && getUserId() in resource.data.members;
      allow create: if isAuthenticated() && getUserId() in request.resource.data.members;
    }
    
    // Support tickets - users can access all support tickets for admin, or their own
    match /teknokapsul-help/{ticketId} {
      allow read, write: if isAuthenticated();
      allow create: if isAuthenticated();
    }
    
    // Applications - users can access all applications
    match /teknokapsul-application/{applicationId} {
      allow read, write: if isAuthenticated();
      allow create: if isAuthenticated();
    }
    
    // Login records - users can only access their own login records
    match /loginRecords/{recordId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Teknokapsul user data - users can only access their own data
    match /teknokapsul/{userId}/{document=**} {
      allow read, write: if isAuthenticated() && getUserId() == userId;
    }

    match /sharedPaymentPlans/{planId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if false;
    }
    
    // Work tracking - users can only access their own work entries
    match /workEntries/{entryId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Work settings - users can only access their own settings
    match /workSettings/{settingId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Salary history - users can only access their own salary history
    match /salaryHistory/{historyId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Warranties - users can only access their own warranties
    match /warranties/{warrantyId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Goals - users can only access their own goals
    match /goals/{goalId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Financial data - users can only access their own financial data
    match /financialData/{dataId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Loans - users can only access their own loans
    match /loans/{loanId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Cash advance accounts - users can only access their own accounts
    match /cashAdvanceAccounts/{accountId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Credit scores - users can only access their own credit scores
    match /creditScores/{scoreId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Stock market data - users can only access their own stock data
    match /stockMarket/{stockId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Payment plans - users can only access their own payment plans
    match /paymentPlans/{planId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Documents - users can only access their own documents
    match /documents/{documentId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Notifications - users can only access their own notifications
    match /notifications/{notificationId} {
      allow read, write: if isAuthenticated() && getUserId() == resource.data.userId;
      allow create: if isAuthenticated() && getUserId() == request.resource.data.userId;
    }
    
    // Deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
