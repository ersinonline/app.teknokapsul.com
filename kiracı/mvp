Aşağıda MVP’yi **uçtan uca**, “siteyi sıfırdan biri okuyup yapabilsin” seviyesinde (ama dağılmadan) anlatıyorum.

---

## 1) Ürün ne yapıyor?

Konut/işyeri kira sürecini tek yerde yönetiyor:

1. Ev sahibi / emlakçı sitede **kira sözleşmesi** oluşturur (şablon + opsiyonel maddeler + ek madde + demirbaş/foto).
2. Sistem **e-Devlet’e kopyala-yapıştır** ile aktarılacak maddeleri hazırlar ve kullanıcıya bir **checklist** ile süreç takibi yaptırır.
3. e-Devlet onayı “manuel işaretlenir”; onay olmadan **tahsilat başlamaz**.
4. Onaydan sonra kiracı her ay **iyzico ile** (kart/taksit/havale) öder.
5. Gecikme olursa: **00:00’da** gecikme başlar, sistem **kırmızı** olur, ev sahibinde **hukuki süreç checklist’i** otomatik açılır. Faiz: ilk 5 gün yok; 6. günden itibaren günlük %1 (açıksa).
6. Para önce senin iyzico hesabına düşer; **ödemeden 8 gün sonra** (hafta sonu ve resmi tatil değilse) ev sahibine **manuel** iyzico transferi yaparsın. Sistem sadece “bugün aktarılacaklar” listesini çıkarır.
7. Kiracı ayrıca “**peşin ödeme teklifi**” yapabilir: ödenmemiş ayların toplamından max %10 indirimle teklif verir; teklif 1 hafta geçerli, kabul edilince ödeme için 1 hafta süre.

---

## 2) Roller ve yetkiler

### Ev sahibi

* Taşınmaz ekler.
* Sözleşme oluşturur / düzenler.
* e-Devlet adımlarını işaretler, “onaylandı” yapar.
* Gecikme/faiz ayarını açıp kapatır.
* İptal edebilir.
* Hukuki checklist’i **sadece ev sahibi görür**.

### Kiracı

* Sözleşmeyi görür (misafir linkiyle veya hesapla).
* “Sistem içi onay” verebilir (opsiyonel süreç takibi).
* Ödeme yapar.
* Peşin ödeme teklifi oluşturur.

### Emlakçı

* AgentID’ye sahip.
* Ev sahibi agentID girip **ev bazında** yetki verirse sadece o evleri/sözleşmeleri görür ve yönetir.
* Kiracı/ev sahibi adına sözleşme oluşturabilir.
* Hukuki checklist’i görmez.

### Admin (sadece `clk.ersinnn@gmail.com`)

* Tüm sözleşmeler/ödemeler/payoutlar/agent yetkileri/audit log/hareketler.
* Resmi tatilleri manuel girer.
* “Aktarıldı” (payout) modal onayını verir.

---

## 3) Sayfalar / ekranlar (React)

### Public

* Landing (`/`)
* Login/Register (`/login`, `/register`)
* Misafir sözleşme görüntüleme/onay (`/tenant/:contractId?token=...`)
* Misafir ödeme (`/pay/:contractId?token=...`)

### Uygulama (role-based)

**Taşınmaz**

* `/properties` – liste
* `/properties/new` – ekle

**Sözleşmeler**

* `/contracts` – liste (rolüne göre)
* `/contracts/new` – sihirbaz
* `/contracts/:id` – detay
* `/contracts/:id/edevlet` – kopyala-yapıştır + checklist
* `/contracts/:id/renewal` – 11. ay artış teklifi (MVP’de şart)
* `/contracts/:id/upfront` – peşin teklif ekranı

**Ödemeler**

* `/invoices` – kiracı için “borçlarım”, ev sahibi için “tahsilatlar”

**Ev sahibi payout görünümü**

* `/payouts` – “planlandı / aktarıldı” (bilgilendirme)

### Admin (sadece sen)

* `/admin` – dashboard
* `/admin/contracts` – sözleşmeler
* `/admin/payments` – ödemeler (iyzico status)
* `/admin/payouts` – “bugün aktarılacaklar” + **modal onay**
* `/admin/agents` – emlakçılar
* `/admin/permissions` – kim kime hangi ev yetkisi verdi
* `/admin/audit` – kim ne yaptı
* `/admin/holidays` – resmi tatil yönetimi

---

## 4) Sözleşme sihirbazı (MVP detay)

Adımlar:

1. **Taraflar**

* Ev sahibi: (hesap sahibi veya seçilen kişi)
* Kiracı: ad soyad, telefon/e-posta, **TCKN**
* Emlakçı: varsa otomatik bağlı

2. **Taşınmaz seçimi**

* Konut/işyeri + adres

3. **Tarih & ödeme günü**

* Başlangıç tarihi
* `payDay` 1–30
* 31 girilse bile 30’a yuvarlanır (varsayılan “ay 30 gün” mantığı)

4. **Tutarlar**

* Aylık kira
* Depozito (opsiyonel)
* Diğer (opsiyonel)

5. **Maddeler**

* Zorunlu maddeler (şablon)
* Opsiyonel maddeler (seçilebilir)
* Ek madde (başlık + metin)

6. **Demirbaş**

* ürün adı, adet, açıklama
* foto opsiyonel

7. **Gecikme faizi**

* default açık/kapalı (sen belirlersin; ev sahibi değiştirebilir)
* sözleşme metnine otomatik madde eklenir

8. **IBAN / alıcı bilgisi**

* Ev sahibinin ad soyadı ile uyumlu olmalı
* IBAN sözleşmede yer alır
* Başka kişiye ödeme gidemez

9. **Önizleme + PDF**

* PDF oluşturulur, versiyon kaydı tutulur

---

## 5) e-Devlet aktarım modu

* Madde listesi: her madde için “Kopyala”
* Toplu kopyala
* Checklist:

  * aktardım
  * onay bekliyor
  * onaylandı (**bunu işaretleyince tahsilat açılır**)

Durumlar:

* `DRAFT_READY`
* `EDEVLET_TRANSFERRED`
* `EDEVLET_PENDING`
* `EDEVLET_APPROVED` → ödeme aktif
* `CANCELLED`

---

## 6) Ödeme sistemi (iyzico)

### Aylık invoice mantığı

* e-Devlet onayı gelince sistem her ay için bir `invoice` üretir.
* Kiracı:

  * Kart / taksit / havale ile öder (iyzico)

### Havale durumları (iyzico’dan)

* SUCCESS → PAID
* PENDING → PAYMENT_PENDING
* REJECTED → FAILED

### Komisyon

**Standart**

* Kiracı +%3
* Ev sahibi -%3

**Emlakçı aracılı**

* Kiracı +%5
* Ev sahibi -%5
* Toplam %10’un %2’si emlakçıya ayrılır

> Bu, invoice üzerinde hesaplanıp saklanır: tenantTotal / landlordNet / platformRevenue / agentRevenue.

---

## 7) Gecikme, kırmızı, hukuki süreç

* Vade günü 23:59 → 00:00’a geçince ödeme yoksa:

  * invoice OVERDUE
  * **kırmızı**
  * ev sahibinde **hukuki checklist otomatik açılır**
* Faiz (lateFeeEnabled açıksa):

  * 1–5 gün: 0
  * 6. günden itibaren günlük %1:

    * 7 gün gecikme: +%2
    * 8 gün gecikme: +%3

> Kırmızı durum gecikme başlar başlamaz; hukuki liste sadece ev sahibinde.

---

## 8) Peşin ödeme teklifi (upfront)

* Kiracı “peşin teklif” oluşturur.
* Teklif, **ödenmemiş tüm kiralar** için hesaplanır.
* `baseTotal = unpaidMonths × kira`
* İndirim sınırı: max %10

  * min teklif: `ceil(baseTotal×0.90)`
  * max teklif: `baseTotal`
  * 100 toplamda min 90; 91–100 serbest; 89 yasak
* Teklif 1 hafta geçerli.
* Ev sahibi kabul ederse kiracının ödeme için 1 haftası var.
* Ödeme gelmezse teklif iptal (timeout).
* Ödeme gelirse:

  * tek “upfront invoice” PAID olur
  * kapsanan aylık invoice’lar `CLOSED_UPFRONT` yapılır

---

## 9) Payout (ev sahibine aktarım)

* Kiracı öder → para sende birikir.
* `paidAt + 8 gün` → aktarım planlanır.
* Eğer gün hafta sonu veya resmi tatilse → **sonraki iş günü**.
* Transferi **sen iyzico panelinden manuel** yaparsın.
* Admin panelde “Aktarıldı” modalı ile işaretlenir (ref no eklenebilir).

---

## 10) Admin panel (MVP)

Senin “her şeyi göreyim” dediğin kapsam:

* Sözleşmeler (filtreli)
* Ödemeler (iyzico status + payout plan)
* Aktarılacaklar (bugün/hafta) + modal onayı
* Emlakçılar + yetkiler (ev bazlı)
* Audit log (kim ne yaptı)
* Resmi tatiller (manuel giriş)

Admin erişimi:

* Firebase custom claim `isAdmin=true` sadece `clk.ersinnn@gmail.com`.

---

## 11) Veri yapısı (tek kök + alt koleksiyon)

`accounts/{accountId}/`

* `members/{uid}`
* `properties/{propertyId}/agent_permissions/{agentId}`
* `contracts/{contractId}/invoices/{invoiceId}`
* `contracts/{contractId}/payments/{paymentId}`
* `contracts/{contractId}/upfront_offers/{offerId}`
* `legal_cases/{caseId}` (sadece ev sahibi)
* `payouts/{payoutId}`
* `audit_logs/{logId}`
* `admin/holidays/{YYYY-MM-DD}`

---

## 12) Otomasyonlar (Cloud Functions)

* Admin claim set
* Invoice üretimi (günlük)
* Hatırlatma e-postaları (günlük)
* 00:00 gecikme işaretleme + kırmızı + legal case
* iyzico webhook handler (success/pending/reject)
* payout planlama (paidAt+8 gün + iş günü/tatil kaydırma)
* admin payout “aktarıldı” işaretleme (modal)
* renewal: 11. ay teklif, 13. ay devreye alma


Süper. Aşağıya **(1) Firebase/Firestore Security Rules taslağı** + **(2) Jira tarzı backlog (epic → story → acceptance)** ikisini birden bırakıyorum. Kod olan yerleri normal code block’ta veriyorum.

---

## 1) Firebase Security Rules taslağı (MVP)

### Varsayımlar (MVP için pratik)

* Firestore kökü: `accounts/{accountId}/...`
* Her kullanıcı bir veya birden fazla `account` üyesi olabilir: `accounts/{accountId}/members/{uid}`
* Admin erişimi: Firebase Custom Claims `isAdmin == true` (sadece `clk.ersinnn@gmail.com`)
* Kiracı misafir erişimi: **token doğrulamasını Rules içinde güvenli yapmak zor** (hash karşılaştırma vb.). MVP’de en güvenlisi:

  * Misafir ödeme/sözleşme görüntüleme **doğrudan Firestore read ile değil**,
  * **Cloud Function üzerinden** yapılır (token doğrulanır, sadece gerekli veri döndürülür, ödeme başlatılır).
  * Firestore rules misafir için kapalı kalır.

> Bu yaklaşım hem güvenli hem de daha kontrollü.

### Rules (çekirdek)

```rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    function isAdmin() {
      return isSignedIn() && request.auth.token.isAdmin == true;
    }

    function isAccountMember(accountId) {
      return isSignedIn() &&
        exists(/databases/$(database)/documents/accounts/$(accountId)/members/$(request.auth.uid));
    }

    // Members doc read helper
    function memberDoc(accountId) {
      return get(/databases/$(database)/documents/accounts/$(accountId)/members/$(request.auth.uid));
    }

    function hasRole(accountId, role) {
      return isAccountMember(accountId) && memberDoc(accountId).data.roles[role] == true;
    }

    // Contract helpers (expects contract doc exists)
    function contractDoc(accountId, contractId) {
      return get(/databases/$(database)/documents/accounts/$(accountId)/contracts/$(contractId));
    }

    function isLandlordOfContract(accountId, contractId) {
      return isSignedIn() && contractDoc(accountId, contractId).data.landlordUid == request.auth.uid;
    }

    function isAgentOfContract(accountId, contractId) {
      return isSignedIn() && contractDoc(accountId, contractId).data.agentUid == request.auth.uid;
    }

    // Agent permissions are property-based
    function hasAgentPermissionForProperty(accountId, propertyId) {
      // agentId doc id could be agentUid or agentId; easiest is store by agentUid
      return isSignedIn() &&
        exists(/databases/$(database)/documents/accounts/$(accountId)/properties/$(propertyId)/agent_permissions/$(request.auth.uid));
    }

    function canAgentAccessContract(accountId, contractId) {
      let c = contractDoc(accountId, contractId).data;
      return isSignedIn() &&
        (c.agentUid == request.auth.uid) &&
        hasAgentPermissionForProperty(accountId, c.propertyId);
    }

    // ----- Accounts root -----
    match /accounts/{accountId} {
      allow read: if isAdmin() || isAccountMember(accountId);
      allow write: if false; // MVP: accounts meta sadece backend/admin

      // ----- Members -----
      match /members/{uid} {
        allow read: if isAdmin() || (isSignedIn() && uid == request.auth.uid && isAccountMember(accountId));
        allow write: if isAdmin(); // rol atama vs admin/backend
      }

      // ----- Admin docs (holidays etc.) -----
      match /admin/{docId} {
        allow read, write: if isAdmin();
      }

      // ----- Holidays under admin -----
      match /admin/holidays/{dayId} {
        allow read, write: if isAdmin();
      }

      // ----- Audit logs -----
      match /audit_logs/{logId} {
        allow read: if isAdmin();
        allow create: if isAdmin() || isAccountMember(accountId); // create genelde backend; istersen sadece backend/admin yap
        allow update, delete: if isAdmin();
      }

      // ----- Properties -----
      match /properties/{propertyId} {
        allow read: if isAdmin() || isAccountMember(accountId);
        allow create: if isAdmin() || hasRole(accountId, "landlord") || hasRole(accountId, "agent");
        allow update, delete: if isAdmin() || hasRole(accountId, "landlord") || hasRole(accountId, "agent");

        // Agent permissions per property
        match /agent_permissions/{agentUid} {
          // Only landlord/admin can grant/revoke; agent can read own permission
          allow read: if isAdmin()
            || (isSignedIn() && agentUid == request.auth.uid)
            || hasRole(accountId, "landlord");

          allow create, update, delete: if isAdmin() || hasRole(accountId, "landlord");
        }
      }

      // ----- Contracts -----
      match /contracts/{contractId} {
        allow read: if isAdmin()
          || isLandlordOfContract(accountId, contractId)
          || canAgentAccessContract(accountId, contractId);
        // Kiracı read: MVP’de kiracı hesabı varsa tenantUid bağlayıp açmak daha güvenli.
        // Eğer tenantUid alanını kullanacaksan:
        // || (isSignedIn() && contractDoc(accountId, contractId).data.tenantUid == request.auth.uid);

        allow create: if isAdmin() || hasRole(accountId, "landlord") || hasRole(accountId, "agent");

        // Update: ev sahibi + yetkili emlakçı, bazı alanlar kısıtlı olmalı.
        allow update: if isAdmin()
          || isLandlordOfContract(accountId, contractId)
          || canAgentAccessContract(accountId, contractId);

        // Cancel: only landlord/agent/admin
        allow delete: if false;

        // ----- Invoices -----
        match /invoices/{invoiceId} {
          allow read: if isAdmin()
            || isLandlordOfContract(accountId, contractId)
            || canAgentAccessContract(accountId, contractId);
          // Kiracı read/pay: tenantUid bağlıysa ekle:
          // || (isSignedIn() && contractDoc(accountId, contractId).data.tenantUid == request.auth.uid);

          allow create, update: if isAdmin(); // invoice üretimi backend
          allow delete: if false;
        }

        // ----- Payments -----
        match /payments/{paymentId} {
          allow read: if isAdmin()
            || isLandlordOfContract(accountId, contractId)
            || canAgentAccessContract(accountId, contractId);
          // Kiracı ödeme geçmişi için tenantUid varsa:
          // || (isSignedIn() && contractDoc(accountId, contractId).data.tenantUid == request.auth.uid);

          allow create: if isAdmin(); // ödeme kayıtlarını webhook/backend yazsın
          allow update: if isAdmin();
          allow delete: if false;
        }

        // ----- Upfront offers -----
        match /upfront_offers/{offerId} {
          // Tenant tarafı: tenantUid varsa allow read/create; yoksa Cloud Function ile yönet (önerim)
          allow read: if isAdmin()
            || isLandlordOfContract(accountId, contractId)
            || canAgentAccessContract(accountId, contractId);
          // tenantUid eklenince:
          // || (isSignedIn() && contractDoc(accountId, contractId).data.tenantUid == request.auth.uid);

          allow create: if isAdmin(); // MVP: Cloud Function create etsin
          allow update: if isAdmin(); // accept/pay/expire backend
          allow delete: if false;
        }
      }

      // ----- Legal cases -----
      match /legal_cases/{caseId} {
        // Only landlord (and admin) can read/write
        allow read, write: if isAdmin()
          || (isSignedIn() && resource.data.landlordUid == request.auth.uid && isAccountMember(accountId));
      }

      // ----- Payouts -----
      match /payouts/{payoutId} {
        allow read: if isAdmin()
          || (isSignedIn() && resource.data.landlordUid == request.auth.uid)
          || (isSignedIn() && resource.data.agentUid == request.auth.uid);
        allow create, update: if isAdmin(); // admin modal ile işaretleme
        allow delete: if false;
      }
    }
  }
}
```

### Önemli MVP notları (kuralların yanına)

* **Misafir erişimi** (token ile) Firestore rules ile tam güvenli olmaz → Cloud Function tercih et.
* Kiracı hesaplı kullanım istiyorsan sözleşmede **`tenantUid`** alanını set etmek en sağlıklısı:

  * Kiracı kayıt olunca “Sözleşmeme bağlan” akışı (TCKN+telefon doğrulama veya token) ile `tenantUid` set edilir.
* Webhook ve cron işleri Firestore’a yazacağı için bunları **admin/service account** ile yazdır (rules’tan bağımsız).

---

## 2) Jira Backlog (MVP) — Epic / Story / Acceptance

### EPIC 0 — Temel altyapı

**0.1 Firebase Auth + React routing**

* AC: Login/Register çalışır, session korunur.
  **0.2 Admin claim**
* AC: `clk.ersinnn@gmail.com` giriş yapınca `/admin` açılır, diğerleri 403.

---

### EPIC 1 — Roller, üyelik, emlakçı yetkisi

**1.1 Roller (ev sahibi/kiracı/emlakçı)**

* AC: Kullanıcı birden fazla role sahip olabilir, menüler role göre değişir.
  **1.2 AgentID üretimi**
* AC: Emlakçı profilde sabit agentId görür.
  **1.3 Ev bazlı yetki verme**
* AC: Ev sahibi agentId girip emlakçıya sadece seçilen `propertyId` için erişim verir.
  **1.4 Yetki listesi**
* AC: Admin ve ev sahibi “kim kime ne verdi”yi görür.

---

### EPIC 2 — Taşınmazlar

**2.1 Taşınmaz ekle/listele**

* AC: Konut/işyeri, adres alanları kaydedilir.
  **2.2 Taşınmaz-ev sahibi ilişkisi**
* AC: Taşınmaz sahibi sözleşmede doğru bağlanır.

---

### EPIC 3 — Sözleşme oluşturma

**3.1 Sihirbaz**

* AC: Taraflar (kiracı TCKN), taşınmaz, kira, başlangıç, payDay(1–30).
  **3.2 Maddeler**
* AC: Zorunlu + opsiyonel + serbest ek madde.
  **3.3 Demirbaş**
* AC: ürün/adet/açıklama + opsiyonel foto.
  **3.4 Gecikme faizi ayarı**
* AC: lateFeeEnabled açık/kapalı; kapalıysa hesaplamaya girmez.
  **3.5 IBAN kuralı**
* AC: Ev sahibi adı/soyadı ile alıcı adı/soyadı aynı değilse sözleşme finalize olmaz.
  **3.6 PDF**
* AC: PDF indir/görüntüle, sürüm kaydı tutulur.

---

### EPIC 4 — e-Devlet aktarım ve süreç takibi

**4.1 Madde kopyalama ekranı**

* AC: tek tek kopyala + toplu kopyala.
  **4.2 Checklist durumları**
* AC: transferred/pending/approved manuel işaretlenir.
  **4.3 Onay olmadan ödeme yok**
* AC: EDEVLET_APPROVED olmadan invoice üretilmez ve ödeme ekranı “kapalı”dır.
  **4.4 Kiracı “sistem içi onay”**
* AC: Kiracı (hesaplı veya misafir) “onayladım” işaretleyebilir; ev sahibi isterse onun yerine de ilerletebilir.

---

### EPIC 5 — Invoice üretimi ve bildirimler

**5.1 Aylık invoice üretimi**

* AC: e-Devlet onayı sonrası her ay dueDate = payDay.
  **5.2 Hatırlatma mailleri**
* AC: -3 gün, vade günü, +1 gün (ödenmediyse).
  **5.3 Gecikme anı (00:00)**
* AC: dueDate sonrası 00:00’da ödeme yoksa invoice OVERDUE + isRed.

---

### EPIC 6 — Ödeme (iyzico)

**6.1 Kart/taksit/havale başlatma**

* AC: Kiracı iyzico’ya gider, sonucu webhook ile işler.
  **6.2 Havale statüleri**
* AC: SUCCESS→PAID, PENDING→PAYMENT_PENDING, REJECTED→FAILED.
  **6.3 Komisyon**
* AC: Standart (%3/%3) ve emlakçı aracılı (%5/%5, emlakçı %2) hesaplanır ve kaydedilir.
  **6.4 Ödeme sonrası ev sahibine mail**
* AC: payment success sonrası ev sahibine “ödeme alındı” maili gider.

---

### EPIC 7 — Gecikme faizi + hukuki süreç (sadece ev sahibi)

**7.1 Faiz hesap**

* AC:

  * daysLate 1–5: 0
  * daysLate ≥ 6: günlük %1 (daysLate-5 gün kadar)
    **7.2 Hukuki checklist açılması**
* AC: Gecikme başladığı saniyede legal case otomatik açılır, sadece ev sahibi görür.
  **7.3 Checklist ekranı**
* AC: Item’lar işaretlenebilir, “belge paketi indir” linki (MVP’de PDF paket opsiyonel).

---

### EPIC 8 — Payout (ev sahibine aktarım) + iş günü/tatil

**8.1 plannedPayoutAt hesaplama**

* AC: paidAt + 8 gün; hafta sonu/resmi tatil ise sonraki iş günü.
  **8.2 Tatil yönetimi (admin)**
* AC: Admin tatil ekleyip silebilir; planlama bunu dikkate alır.
  **8.3 Admin “Aktarıldı” modal**
* AC: Admin modal onayı olmadan payout SENT olamaz; ref no eklenebilir.
  **8.4 Ev sahibine payout görünümü**
* AC: Ev sahibi planlanan/aktarılan tutarları görür.

---

### EPIC 9 — Peşin ödeme teklifi (Upfront)

**9.1 Teklif oluşturma**

* AC: Teklif sadece ödenmemiş aylar üzerinden; min=ceil(%90), max=%100.
  **9.2 Teklif geçerlilik**
* AC: OFFERED 7 gün; kabul edilirse ödeme için 7 gün; ödeme gelmezse TIMEOUT.
  **9.3 Upfront ödeme ve dönem kapatma**
* AC: Upfront PAID olunca kapsanan aylık invoice’lar CLOSED_UPFRONT olur.

---

### EPIC 10 — Admin panel + audit

**10.1 Admin dashboard**

* AC: sözleşme/ödeme/payout/g gecikme metrikleri.
  **10.2 Admin listeler**
* AC: contracts/payments/payouts/agents/permissions sayfaları + filtre.
  **10.3 Audit log**
* AC: Kritik olaylar loglanır, admin arar/filtreler.



Tamam—o zaman sana **(A) Firestore koleksiyon şeması (field field)** + **(B) Cloud Functions listesi (trigger, input/output)** + **(C) e-posta şablonları**nı tek yerde veriyorum. (MVP’ye birebir uyumlu.)

---

## A) Firestore şeması (tek kök + alt koleksiyon)

> Kök: `accounts/{accountId}`
> Her account: bireysel veya emlakçı ajansı olabilir.

### 1) `accounts/{accountId}`

* `type`: `"individual" | "agency"`
* `ownerUid`: string
* `createdAt`: timestamp

#### `accounts/{accountId}/members/{uid}`

* `uid`: string
* `displayName`: string
* `email`: string
* `phone`: string (ops.)
* `roles`: `{ landlord: bool, tenant: bool, agent: bool }`
* `createdAt`: timestamp

#### `accounts/{accountId}/agents/{agentUid}` *(emlakçı kayıtları)*

* `uid`: string
* `publicAgentId`: string *(ev sahibi bunu girer)*
* `displayName`: string
* `email`: string
* `createdAt`: timestamp

---

### 2) Taşınmaz

#### `accounts/{accountId}/properties/{propertyId}`

* `ownerUid`: string *(ev sahibi uid)*
* `createdByUid`: string *(ev sahibi veya emlakçı)*
* `type`: `"residential" | "commercial"`
* `address`: `{ city, district, fullText }`
* `meta`: `{ roomCount?, floor?, ... }` *(MVP minimal)*
* `createdAt`, `updatedAt`

#### `accounts/{accountId}/properties/{propertyId}/agent_permissions/{agentUid}`

* `agentUid`: string
* `grantedByUid`: string *(ev sahibi)*
* `createdAt`: timestamp
* `isActive`: bool

---

### 3) Sözleşme

#### `accounts/{accountId}/contracts/{contractId}`

* `status`: `"DRAFT_READY" | "EDEVLET_TRANSFERRED" | "EDEVLET_PENDING" | "EDEVLET_APPROVED" | "ACTIVE" | "CANCELLED"`

* `createdByUid`: string

* `landlordUid`: string

* `agentUid`: string|null

* `propertyId`: string

* `tenant`: `{ name, tckn, phone, email }`

* `tenantUid`: string|null *(kiracı hesap bağlanırsa)*

* `rentAmount`: number

* `depositAmount`: number|null

* `startDate`: timestamp

* `endDate`: timestamp|null *(yenileme/remaining hesap için önerilir)*

* `payDay`: number *(1–30)*

* `lateFeeEnabled`: bool

* `iban`: `{ iban, receiverName }` *(receiverName ev sahibi adıyla aynı olacak)*

* `commissionPlan`:

  * `mode`: `"standard" | "agent"`
  * `payerExtraPct`: 3|5
  * `receiverCutPct`: 3|5
  * `agentSharePct`: 0|2

* `edevlet`:

  * `transferredAt`: timestamp|null
  * `pendingAt`: timestamp|null
  * `approvedAt`: timestamp|null
  * `approvedByUid`: string|null

* `tenantAck`:

  * `ack`: bool
  * `ackAt`: timestamp|null

* `termsVersion`: number

* `terms`: array of `{ no, title, text, isOptional, isSelected }`

* `inventory`: array of

  * `{ name, qty, note, photoUrls: string[] }`

* Renewal:

  * `renewal`:

    * `state`: `"RENEWAL_NONE" | "RENEWAL_OFFERED" | "RENEWAL_TENANT_APPROVED" | "RENEWAL_ACTIVE"`
    * `offeredAt`: timestamp|null *(11. ay)*
    * `newRentAmount`: number|null
    * `tenantApprovedAt`: timestamp|null
    * `activeAt`: timestamp|null *(13. ay)*

* Cancel:

  * `cancelledAt`: timestamp|null
  * `cancelledByUid`: string|null
  * `cancelReason`: string|null

* `flags`:

  * `hasRed`: bool

* `createdAt`, `updatedAt`

---

### 4) Aylık faturalar (invoice)

#### `accounts/{accountId}/contracts/{contractId}/invoices/{invoiceId}`

* `period`: `"YYYY-MM"`

* `dueDate`: timestamp *(aylık vade: payDay)*

* `baseRentAmount`: number *(o dönem kira)*

* `lateFeeAmount`: number *(hesaplanmış, günlük güncellenir)*

* `lateDays`: number

* `isRed`: bool

* `status`: `"DUE" | "OVERDUE" | "PAYMENT_PENDING" | "FAILED" | "PAID" | "CLOSED_UPFRONT"`

* Komisyon kırılımı:

  * `payerExtraPct`: 3|5
  * `receiverCutPct`: 3|5
  * `agentSharePct`: 0|2
  * `tenantTotal`: number
  * `landlordNet`: number
  * `platformRevenue`: number
  * `agentRevenue`: number

* `paidAt`: timestamp|null

* `paymentId`: string|null

* `createdAt`, `updatedAt`

---

### 5) Ödemeler (iyzico)

#### `accounts/{accountId}/contracts/{contractId}/payments/{paymentId}`

* `invoiceId`: string|null *(upfront olabilir)*

* `type`: `"MONTHLY" | "UPFRONT"`

* `method`: `"card" | "transfer" | "installment"`

* `amountCharged`: number *(kiracıdan çekilen)*

* `iyzico`: `{ ref, status: "SUCCESS"|"PENDING"|"REJECTED", raw?: object }`

* `status`: `"SUCCESS" | "PENDING" | "REJECTED"`

* payout:

  * `plannedPayoutAt`: timestamp
  * `paidOut`: bool
  * `paidOutAt`: timestamp|null
  * `payoutId`: string|null

* `createdAt`

---

### 6) Peşin teklif

#### `accounts/{accountId}/contracts/{contractId}/upfront_offers/{offerId}`

* `status`: `"OFFERED" | "REJECTED" | "EXPIRED" | "ACCEPTED_PENDING_PAYMENT" | "PAID" | "PAYMENT_TIMEOUT" | "CANCELLED"`

* `createdAt`

* `expiresAt` *(createdAt+7d)*

* `acceptedAt`: timestamp|null

* `paymentDeadlineAt`: timestamp|null *(acceptedAt+7d)*

* kapsadığı dönemler:

  * `coversInvoiceIds`: string[]
  * `coversPeriods`: string[] *(YYYY-MM)*
  * `remainingMonths`: number

* hesap:

  * `baseTotal`: number
  * `minAllowed`: number *(ceil(baseTotal*0.90))*
  * `maxAllowed`: number *(baseTotal)*
  * `offerAmount`: number

* `upfrontInvoiceId`: string|null

* `paymentId`: string|null

* `createdBy`: `{ uid, mode: "guest"|"user" }`

---

### 7) Hukuki checklist (sadece ev sahibi görünür)

#### `accounts/{accountId}/legal_cases/{caseId}`

* `contractId`
* `landlordUid`
* `trigger`: `"NON_PAYMENT" | "CANCEL_REQUEST"`
* `createdAt`
* `isOpen`: bool
* `items`: array of `{ key, title, done, doneAt }`

---

### 8) Payout kayıtları (admin manuel işaretler)

#### `accounts/{accountId}/payouts/{payoutId}`

* `landlordUid`
* `agentUid`: string|null
* `amount`
* `paymentIds`: string[]
* `plannedPayoutAt`
* `status`: `"PLANNED" | "SENT" | "SETTLED"`
* `sentAt`: timestamp|null
* `sentByUid`: string|null
* `transferRef`: string|null

---

### 9) Resmi tatiller

#### `accounts/{accountId}/admin/holidays/{YYYY-MM-DD}`

* `name`: string
* `isHoliday`: true

---

### 10) Audit log

#### `accounts/{accountId}/audit_logs/{logId}`

* `createdAt`
* `actorUid`
* `actorEmail`
* `actorRole`: `"landlord"|"tenant"|"agent"|"admin"`
* `eventType`: string
* `entityType`: `"contract"|"property"|"invoice"|"payment"|"payout"|"offer"|"permission"|"holiday"`
* `entityId`
* `metadata`: map

---

## B) Cloud Functions listesi (MVP)

### 1) Admin claim

**`auth_onCreate_setAdminClaim`**

* Trigger: Auth user create (veya callable “ensureClaims”)
* İş: email == `clk.ersinnn@gmail.com` → `customClaims.isAdmin=true`

### 2) Invoice üretimi

**`cron_generateInvoicesDaily`**

* Schedule: günlük 00:10
* Şart: contract `EDEVLET_APPROVED/ACTIVE` ve iptal değil
* İş: o ayın invoice’u yoksa oluştur (`period`, `dueDate`, komisyon planı kopyala)

### 3) Gecikme işaretleme + hukuki case açma (anında)

**`cron_markOverdueAtMidnight`**

* Schedule: günlük 00:00-00:05
* Şart: dueDate < today (yeni gün) ve invoice != PAID/CLOSED_UPFRONT
* İş:

  * invoice `OVERDUE`, `isRed=true`, `lateDays` güncelle
  * contract `flags.hasRed=true`
  * legal_case yoksa oluştur (trigger=NON_PAYMENT, visible landlord only)
  * audit log

### 4) Faiz hesap güncelleme (günlük)

**`cron_updateLateFeesDaily`**

* Schedule: günlük 00:20
* Hesap:

  * `daysLate = floor(today - dueDate)`
  * eğer `lateFeeEnabled=false` → 0
  * eğer `daysLate <= 5` → 0
  * else `lateFee = baseRentAmount * 0.01 * (daysLate - 5)`
* invoice’ı güncelle (lateFeeAmount, lateDays, tenantTotal/landlordNet vs yeniden hesap)

### 5) Hatırlatma mailleri

**`cron_sendInvoiceRemindersDaily`**

* Schedule: günlük 09:00
* Koşullar: -3 gün, vade günü, +1 gün (ödenmediyse)
* İş: kiracıya email gönder + audit log

### 6) iyzico webhook

**`http_iyzicoWebhook`**

* Input: iyzico event
* İş:

  * ödeme status map (SUCCESS/PENDING/REJECTED)
  * payment doc create/update
  * invoice status update (PAID/PAYMENT_PENDING/FAILED)
  * PAID ise ev sahibine “ödeme alındı” maili
  * payout planı oluştur (plannedPayoutAt = nextBusinessDay(paidAt+8d))
  * audit log

### 7) İş günü hesap yardımcıları

**`util_nextBusinessDay(date, holidaysCollection)`**

* weekend veya holiday ise +1 gün loop

### 8) Payout planlama (backup)

**`cron_planPayoutsDaily`**

* Schedule: günlük 01:00
* İş: webhook kaçarsa diye `SUCCESS` payment & plannedPayoutAt boş olanları planla

### 9) Admin payout “Aktarıldı” (callable)

**`call_adminMarkPayoutSent`**

* Auth: admin şart
* Input: payoutId, transferRef
* İş: payout status SENT, sentAt, sentByUid; ilgili payment’lar paidOut=true; audit log

### 10) Yenileme otomasyonu

**`cron_activateRenewalsDaily`**

* Schedule: günlük 00:30
* Şart: `renewal.state == RENEWAL_TENANT_APPROVED` ve `activeAt <= today` (13. ay)
* İş: `renewal.state=RENEWAL_ACTIVE`, yeni kira invoice’lara yansır

### 11) Peşin teklif süreleri

**`cron_expireUpfrontOffersHourly`**

* Schedule: saatlik
* İş:

  * OFFERED & now>expiresAt → EXPIRED
  * ACCEPTED_PENDING_PAYMENT & now>paymentDeadlineAt → PAYMENT_TIMEOUT

### 12) Upfront offer create/accept (callable)

> Misafir destek için bunu callable yapmak ideal.

* **`call_createUpfrontOffer`**: tenant/guest token doğrular, ödenmemiş invoice’ları bulur, min/max hesaplar, offer oluşturur.
* **`call_acceptUpfrontOffer`**: landlord/agent kabul eder, acceptedAt/paymentDeadlineAt set.
* Ödeme başarı → webhook `type=UPFRONT` olarak kapatır.

---

## C) E-posta şablonları (MVP metinleri)

### 1) Vade -3 gün

Konu: `Kira ödemeniz yaklaşıyor ({{period}})`
İçerik:

* `{{address}}` için `{{dueDate}}` tarihinde `{{tenantTotal}}` ödeme var.
* Ödeme linki: `{{payLink}}`

### 2) Vade günü

Konu: `Bugün kira ödeme gününüz ({{period}})`

* Bugün son gün, tutar `{{tenantTotal}}`
* Link: `{{payLink}}`

### 3) Vade +1 gün (gecikti)

Konu: `Kira ödemeniz gecikti ({{period}})`

* Ödeme gecikti, şu an tutar `{{tenantTotalWithLateFee}}`
* Gecikme cezası (açıksa): `{{lateFeeAmount}}`
* Link: `{{payLink}}`

### 4) Ödeme başarılı (ev sahibine)

Konu: `Kira ödemesi alındı ({{period}})`

* Kiracı `{{tenantName}}` ödeme yaptı.
* Net tutar (size): `{{landlordNet}}`
* Aktarım plan tarihi: `{{plannedPayoutAt}}`

### 5) Peşin teklif oluşturuldu (ev sahibine)

Konu: `Peşin ödeme teklifi geldi`

* Teklif: `{{offerAmount}}` (min {{minAllowed}} / max {{maxAllowed}})
* Kapsam: `{{remainingMonths}}` ay ({{coversPeriods}})
* Son geçerlilik: `{{expiresAt}}`
* Kabul/Reddet: `{{offerLink}}`

### 6) Peşin teklif kabul edildi (kiracıya)

Konu: `Peşin teklifiniz kabul edildi – 1 hafta içinde ödeyin`

* Ödenecek: `{{offerAmount}}` (komisyon dahil toplam: `{{tenantCharged}}`)
* Son ödeme: `{{paymentDeadlineAt}}`
* Link: `{{payLink}}`

### 7) Peşin teklif zaman aşımı

Konu: `Peşin teklif iptal edildi (ödeme yapılmadı)`

* Süre doldu: `{{paymentDeadlineAt}}`
* Yeni teklif oluşturabilirsiniz: `{{offerCreateLink}}`



// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBUTqMQPaWvSEYq-kVR198Zgvp_ZZUX3So",
  authDomain: "superapp-37db4.firebaseapp.com",
  projectId: "superapp-37db4",
  storageBucket: "superapp-37db4.appspot.com",
  messagingSenderId: "488411585201",
  appId: "1:488411585201:web:51a3138f763f1842156090",
  measurementId: "G-SJY3Z4VDPE"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);


NON-3DS Entegrasyonu

Entegrasyon Adımları
BIN Sorgulama

Ödeme Oluşturma

Ödeme Bilgilerine Erişim(Opsiyonel)

Webhook

ÖNEMLİ NOT : NON-3DS kullanımı için iyzico hesabınızda bu özelliğin olması gerekmektedir. Bu özelliği açtırmak için entegrasyon@iyzico.com adresine eposta göndererek bu talebi oluşturabilirsiniz.

Genel Özet

BIN Sorgulama; API'nin taksit seçenekleri ve kart ayrıntıları hakkında bilgi döndürdüğü, kartı veren kuruluşun ayrıntılarını tanımladığı adımdır.


Ödeme Oluşturma; Ödeme taleplerini tek adımda işlemenize ve yönetmenizi sağlar.


Ödeme Bilgilerine Erişim(Opsiyonel); iyzico tarafından kaydedilen ödemenin işlem ayrıntılarını kontrol etmenizi sağlar.


Webhook; İlgili ödemenin gerçek zamanlı bildirimininin yapıldığı adımdır.


Örnek Uygulama
Temel NON-3DS uygulaması, kısaca birbirini takip eden iki POST isteğinden oluşur.

Ödeme Oluşturma

Ödeme Bilgilerine Erişim(Opsiyonel)

Önerilen entegrasyon aşağıdaki sırayla izlenir;

1. BIN Sorgulama
İster 3DS ister NON-3DS ödeme yöntemi olsun, alışverişte kullanılacak kartın özelliğinin önceden belirlenmesi tavsiye edilir. BIN detay hizmetleri sayesinde kart türü, kart şeması, kart ile ilgili taksit bilgileri ve 3DS özelliklerine ilişkin daha ayrıntılı bilgiler alınır.

Taksit Bilgisini Almaya Yönelik Örnek İstek;

Copy
{
"price":"100.0",
"binNumber":"535805"
}
Taksit Bilgisini Almaya Yönelik Örnek Yanıt;

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1685905139724,
    "installmentDetails": [
        {
            "binNumber": "535805",
            "price": 100.0,
            "cardType": "DEBIT_CARD",
            "cardAssociation": "MASTER_CARD",
            "cardFamilyName": "iyzico DC",
            "force3ds": 0,
            "bankCode": 864,
            "bankName": "iyzico",
            "forceCvc": 0,
            "commercial": 0,
            "dccEnabled": 0,
            "installmentPrices": [
                {
                    "installmentPrice": 100.0,
                    "totalPrice": 100.0,
                    "installmentNumber": 1
                }
            ]
        }
    ]
}
2. Ödeme Oluşturma
NON-3DS ödeme yolculuğu, Ödeme Oluşturma POST isteği ile başlar.

Ödeme Oluşturmaya Yönelik Örnek İstek;

Copy
{
   "locale":"en",
   "conversationId":"deviyzico",
   "price":"10.01",
   "paidPrice":"10.01",
   "currency":"TRY",
   "installment":1,
   "paymentChannel":"WEB",
   "basketId":"B67832",
   "paymentGroup":"PRODUCT",
   "paymentCard":{
      "cardHolderName":"Mehmet Test",
      "cardNumber":"5526080000000006",
      "expireYear":"2028",
      "expireMonth":"11",
      "cvc":"245",
      "registerCard":0
   },
   "buyer":{
      "id":"BY789",
      "name":"John",
      "surname":"Doe",
      "identityNumber":"11111111111",
      "email":"test@testtt.com",
      "gsmNumber":"+905393623333",
      "registrationDate":"2013-04-21 15:12:09",
      "lastLoginDate":"2015-10-05 12:43:35",
      "registrationAddress":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
      "city":"Istanbul",
      "country":"Turkey",
      "zipCode":"34732",
      "ip":"85.34.78.112"
   },
   "shippingAddress":{
      "address":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
      "zipCode":"34742",
      "contactName":"Jane Doe",
      "city":"Istanbul",
      "country":"Turkey"
   },
   "billingAddress":{
      "address":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
      "zipCode":"34742",
      "contactName":"Jane Doe",
      "city":"Istanbul",
      "country":"Turkey"
   },
   "basketItems":[
      {
         "id":"BI101",
         "price":"10.01",
         "name":"Binocular",
         "category1":"Collectibles",
         "category2":"Accessories",
         "itemType":"PHYSICAL"
      }
   ]
}
Ödeme Oluşturmaya Yönelik Örnek Yanıt;

Copy
{
    "status": "success",
    "locale": "en",
    "systemTime": 1686413012592,
    "conversationId": "deviyzico",
    "price": 10.01,
    "paidPrice": 10.01,
    "installment": 1,
    "paymentId": "19682125",
    "fraudStatus": 1,
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0.00,
    "iyziCommissionRateAmount": 0.40040000,
    "iyziCommissionFee": 0.25000000,
    "cardType": "CREDIT_CARD",
    "cardAssociation": "MASTER_CARD",
    "cardFamily": "Axess",
    "binNumber": "552608",
    "lastFourDigits": "0006",
    "basketId": "B67832",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "20945921",
            "transactionStatus": 2,
            "price": 10.01,
            "paidPrice": 10.01000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.40040000,
            "iyziCommissionFee": 0.25000000,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0,
            "blockageResolvedDate": "2023-06-18 00:00:00",
            "subMerchantPrice": 0,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0,
            "merchantPayoutAmount": 9.35960000,
            "convertedPayout": {
                "paidPrice": 10.01000000,
                "iyziCommissionRateAmount": 0.40040000,
                "iyziCommissionFee": 0.25000000,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 9.35960000,
                "iyziConversionRate": 0,
                "iyziConversionRateAmount": 0,
                "currency": "TRY"
            }
        }
    ],
    "authCode": "013627",
    "phase": "AUTH",
    "hostReference": "mock00007iyzihostrfn"
}
3. Ödeme Bilgilerine Erişim(Opsiyonel)
Yukarıdaki tüm adımları tamamladıktan sonra, artık Issuer ile Acquirer arasındaki ödeme işlemini Ödeme Bilgilerine Erişim isteği ile kontrol etme zamanı.

Ödeme Bilgilerine Erişim adımı, paydaşlarımıza ürünlerini göndermeden önce gerçekleştirmelerini tavsiye ettiğimiz ek bir önlemdir.

Ödeme Bilgilerine Erişime Yönelik Örnek İstek;

Copy
{  
   "locale":"tr",
   "paymentId":"19682125" //or "paymentConversationId":"deviyzico"
}
Ödeme Bilgilerine Erişime Yönelik Örnek Yanıt;

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1686413104142,
    "price": 10.01000000,
    "paidPrice": 10.01000000,
    "installment": 1,
    "paymentId": "19682125",
    "fraudStatus": 1,
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0E-8,
    "iyziCommissionRateAmount": 0.40040000,
    "iyziCommissionFee": 0.25000000,
    "cardType": "CREDIT_CARD",
    "cardAssociation": "MASTER_CARD",
    "cardFamily": "Axess",
    "binNumber": "552608",
    "lastFourDigits": "0006",
    "basketId": "B67832",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "20945921",
            "transactionStatus": 2,
            "price": 10.01000000,
            "paidPrice": 10.01000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.40040000,
            "iyziCommissionFee": 0.25000000,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0E-8,
            "blockageResolvedDate": "2023-06-18 00:00:00",
            "subMerchantPrice": 0E-8,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0E-8,
            "merchantPayoutAmount": 9.35960000,
            "convertedPayout": {
                "paidPrice": 10.01000000,
                "iyziCommissionRateAmount": 0.40040000,
                "iyziCommissionFee": 0.25000000,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 9.35960000,
                "iyziConversionRate": 0E-8,
                "iyziConversionRateAmount": 0E-8,
                "currency": "TRY"
            }
        }
    ],
    "authCode": "013627",
    "phase": "AUTH",
    "hostReference": "mock00007iyzihostrfn",
    "paymentStatus": "SUCCESS"
}
4. Webhook
Webhook’lar NON-3DS akışımızın son konusudur.

Gerçek zamanlı ödeme bildirimlerinin alınması, genel olarak 3DS deneyiminden yararlanırken bildirimlerin güvenilir kaynaklardan gelmesini sağlar ve hassas verilere olası müdahaleleri veya yetkisiz erişimi önler.

Her ödeme olayı Webhook’ları tetikler;

Her 15 saniyede bir

Sunucunuz 200 yanıtını alana kadar.

Her 10 dakikada bir

Maksimum 3 kere

Örnek Webhook 3DS Yetkilendirmesi

Parametere
Type
Description
iyziEventTime

long

Unix timestamp value of first notification.

iyziEventType

string

Shows the request type. Values: API_AUTH, THREE_DS_AUTH, BKM_AUTH

iyziReferenceCode

string

A unique reference code for the notification

paymentId

long

Unique iyzico reference code of related payment

paymentConversationId

string

Merchant's reference id for the related payment

status

string

Payment status. Values: SUCCESS, FAILURE

Olumlu senaryo status değişkeninin success dönmesiyle gerçekleşir.

Doğrulama

Ödeme işlemlerinin başarılı bir şekilde sonuçlandırılmasında belirli değişkenlerin korelasyonu önemli rol oynar;

paymentId

status

price

Diğer Eşleştirme parametreleri opsiyoneldir.

Ödeme Oluşturma yanıtı ve Webhook bildiriminin birbirini doğrulaması hayati önem taşımaktadır.

Ödeme Oluşturma yanıtında bulunan paymentId değişkeni Webhook’tan gelen paymentId değişkeniyle aynı olmalıdır.

Her iki istekten gelen status değişkeni success olmalıdır.

price parametresindeki miktar aynı olmalıdır.

Ve son olarak, Eşleştirme parametreleri de eşit olmalıdır.

Eğer eşitse, tebrikler! NON-3DS entegrasyonunu bitirdiniz.

İşlem detaylarına panelinizden ulaşabilirsiniz.



Ödeme Oluşturma
Ödeme Oluşturma API’si müşterinin kart ödemelerinin işlenmesinden sorumludur. Bu hizmet kullanıldığında iyzico işlemin başarısına ilişkin anında yanıt verir.

TROY, MASTERCARD, VISA ve AMEX markalı kartlarla yapılan işlemleri destekler.

BONUS, WORLD, MAXIMUM, AXESS, CARDFINANS, PARAF, ADVANTAGE gibi taksit programlarına katılmış olan kartlara 2, 3, 6, 9 ve 12 taksit seçenekleri sunulmaktadır.

Panelde başarılı işlemler yeşil renkte, başarısız işlemler ise kırmızı renkte görüntülenir.

Üye iş yeri, conversationId ve basketId parametrelerini kendi tarafında sipariş numarası olarak kullanabilir.

Bu özellikleri birleştirerek müşterilerinize, işlemlerinin başarısı veya başarısızlığı hakkında gerçek zamanlı geri bildirim sağlayarak kusursuz bir ödeme deneyimi sağlayabilirsiniz.

Create Non3D Payment
post

https://api.iyzipay.com
/payment/auth
3D Secure olmadan ödeme başlatır.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve base64 formatında üretilmiş imzalı hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Content-Type değeri.

Example: application/json
Body

application/json

application/json
conversationId
string
İstek/yanıt eşleştirmesi için benzersiz ID.

Example: conversationId
locale
string · enum
Dil kodu. Alabileceği değerler; tr, en. Default; tr

Example: tr
Possible values: tren
paidPrice
decimal
Kullanıcıdan tahsil edilecek toplam tutar.

Example: 1
price
decimal
Sepet toplam tutarı.

Example: 1
paymentGroup
string · enum
Ödeme grubu. Default; PRODUCT.

Example: PRODUCT
Possible values: PRODUCTLISTINGSUBSCRIPTION
currency
string · enum
Para birimi. Default; TRY.

Example: TRY
Possible values: TRYUSDEURGBPNOKCHF
installment
integer · enum
Taksit sayısı. Gönderilmezse tek çekim (1) olarak işlem sağlanılabilir.

Possible values: 1236912
basketId
string
Sepet ID’si.

Example: B67832
paymentChannel
string · enum
Ödeme kanalı.

Example: WEB
Possible values: WEBMOBILEMOBILE_WEBMOBILE_IOSMOBILE_ANDROIDMOBILE_WINDOWSMOBILE_TABLETMOBILE_PHONE

paymentCard
object
Kart Bilgileri.


buyer
object
Alıcı Bilgileri.


shippingAddress
object
Kargo Adresi. Sepetteki ürünlerden en az bir tanesinin, itemType "PHYSICAL" olması durumunda gönderilmesi zorunludur. Tüm ürünler "VIRTUAL" olduğu taktirde gönderilmesi gerekmez.


billingAddress
object
Fatura Adresi.


basketItems
object[]
Sepetteki ürünler.

paymentSource
string
Bu alan, partner firmalar tarafından iletilen ödeme kaynağı bilgisidir. Eğer bir altyapı sağlayıcısıysanız ve iyzico ile entegrasyon/iş birliğiniz bulunuyorsa bu parametreyi gönderebilirsiniz.

Example: Shopify
Responses
200
Başarılı yanıt

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/auth
HTTP

Copy
POST https://api.iyzipay.com/payment/auth
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "conversationId":"conversationId",
  "locale":"tr",
  "paidPrice":1.0,
  "price":1.0,
  "paymentGroup":"PRODUCT",
  "currency":"TRY",
  "basketId":"B67832",
  "paymentChannel":"WEB",
  "installment": 1,
  "paymentCard":{
    "cardHolderName":"John Doe",
    "cardNumber":"5528790000000008",
    "expireMonth":"12",
    "expireYear":"2030",
    "cvc":"123",
    "registerCard":0
  },
  "buyer":{
    "id":"BY789",
    "name":"John",
    "surname":"Doe",
    "identityNumber":"74300864791",
    "email":"john.doe@email.com",
    "gsmNumber":"+905350000000",
    "registrationDate":"2013-04-21 15:12:09",
    "lastLoginDate":"2015-10-05 12:43:35",
    "registrationAddress":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
    "city":"Istanbul",
    "country":"Turkey",
    "zipCode":"34732",
    "ip":"85.34.78.112"
  },
  "shippingAddress":{
    "address":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
    "zipCode":"34742",
    "contactName":"Jane Doe",
    "city":"Istanbul",
    "country":"Turkey"
  },
  "billingAddress":{
    "address":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
    "zipCode":"34742",
    "contactName":"Jane Doe",
    "city":"Istanbul",
    "country":"Turkey"
  },
  "basketItems":[
    {
      "id":"BI101",
      "price":1.0,
      "name":"Binocular",
      "category1":"Collectibles",
      "category2":"Accessories",
      "itemType":"PHYSICAL"
    }
  ],
  "paymentSource": "Test"
}

200
Başarılı yanıt



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1700000000000,
  "conversationId": "conversationId",
  "price": 1,
  "paidPrice": 1,
  "installment": 1,
  "paymentId": "25147713",
  "fraudStatus": 1,
  "merchantCommissionRate": "0E-8",
  "merchantCommissionRateAmount": "0E-8",
  "iyziCommissionRateAmount": 0.0349,
  "iyziCommissionFee": 0.25,
  "cardType": "CREDIT_CARD",
  "cardAssociation": "MASTER_CARD",
  "cardFamily": "Axess",
  "binNumber": "552879",
  "lastFourDigits": "0008",
  "basketId": "B67832",
  "currency": "TRY",
  "itemTransactions": [
    {
      "itemId": "BI101",
      "paymentTransactionId": "27137212",
      "transactionStatus": 2,
      "price": 0.3,
      "paidPrice": 0.3,
      "merchantCommissionRate": "0E-8",
      "merchantCommissionRateAmount": "0E-8",
      "iyziCommissionRateAmount": 0.01047,
      "iyziCommissionFee": 0.075,
      "blockageRate": "0E-8",
      "blockageRateAmountMerchant": "0E-8",
      "blockageRateAmountSubMerchant": "0E-8",
      "blockageResolvedDate": "2025-08-22 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": "0E-8",
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 0.21453,
      "convertedPayout": {
        "paidPrice": 0.3,
        "iyziCommissionRateAmount": 0.01047,
        "iyziCommissionFee": 0.075,
        "blockageRateAmountMerchant": "0E-8",
        "blockageRateAmountSubMerchant": "0E-8",
        "subMerchantPayoutAmount": "0E-8",
        "merchantPayoutAmount": 0.21453,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    }
  ],
  "authCode": "579803",
  "phase": "AUTH",
  "hostReference": "mock00007iyzihostrfn",
  "signature": "5ab609ed2e0f4cae0035c8c136d29b00c2616cf8fb4856df65bb52b5a796369f"
}
Örnek Kodlar
PHP

Java

.NET

Node.Js

Python

Son olarak aşağıdaki başlıkları analiz ederek, ödeme sorgusunun sonucunu etkili bir şekilde yönetebilir ve yanıtlayabilirsiniz, böylece müşterileriniz için sorunsuz ve güvenilir bir ödeme süreci sağlayabilirsiniz.

status parametresi işlemin durumu hakkında bilgi sağlar. success, işlemin başarıyla tamamlandığını ve ödemenin işlendiğini gösterir. failure, işlemin başarısız olduğunu belirtir ve başarısızlığın nedenine ilişkin bir hata mesajı verilir.

Bu hizmet için paymentStatus parametresi boştur.

paymentId ve paymentTransactionId değerleri, ileride referans noktası olarak kullanılabileceği için saklanmalıdır.

Başarısız bir işlem durumunda (failure durumu), errorCode, errorMessage ve errorGroup parametreleri, hatayla ilgili ayrıntıları sağlayarak ilgili değerlerle birlikte döndürülür.



Ödeme Sorgulama
iyzico'da kayıtlı bir işlemin detayına ulaşmak için ödeme sorgulama hizmetini kullanabilirsiniz. 

Servise gönderilmesi gereken parametreler aşağıdaki gibidir. Hem paymentId hemde paymentConversationId ile sorgulama yapma imkanı sunar. 

Retrieve Payment Result
post

https://api.iyzipay.com
/payment/detail
Ödeme sonucunu sorgular.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve base64 formatında üretilmiş imzalı hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Content-Type değeri.

Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Alabileceği değerler; tr, en. Default; tr

Example: tr
Possible values: tren
paymentId
string
Ödeme işlem ID’si.

Example: 25168803
paymentConversationId
string
Ödeme işlemine ait conversationId. paymentId gönderilmezse zorunludur.

Example: 123456789
Responses
200
Başarılı yanıt

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/detail
HTTP

Copy
POST https://api.iyzipay.com/payment/detail
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "paymentId":"25168803",
  "paymentConversationId":"123456789"
}

200
Başarılı yanıt



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1700000000000,
  "conversationId": "123456789",
  "paymentId": "1",
  "price": 1,
  "paidPrice": 1,
  "installment": 1,
  "fraudStatus": 1,
  "merchantCommissionRate": "0E-8",
  "merchantCommissionRateAmount": "0E-8",
  "iyziCommissionRateAmount": 0.0349,
  "iyziCommissionFee": 0.25,
  "cardType": "CREDIT_CARD",
  "cardAssociation": "MASTER_CARD",
  "cardFamily": "Axess",
  "binNumber": "552879",
  "lastFourDigits": "0008",
  "basketId": "B67832",
  "currency": "TRY",
  "itemTransactions": [
    {
      "itemId": "BI101",
      "paymentTransactionId": "27137212",
      "transactionStatus": 2,
      "price": 0.3,
      "paidPrice": 0.3,
      "merchantCommissionRate": "0E-8",
      "merchantCommissionRateAmount": "0E-8",
      "iyziCommissionRateAmount": 0.01047,
      "iyziCommissionFee": 0.075,
      "blockageRate": "0E-8",
      "blockageRateAmountMerchant": "0E-8",
      "blockageRateAmountSubMerchant": "0E-8",
      "blockageResolvedDate": "2025-08-22 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": "0E-8",
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 0.21453,
      "convertedPayout": {
        "paidPrice": 0.3,
        "iyziCommissionRateAmount": 0.01047,
        "iyziCommissionFee": 0.075,
        "blockageRateAmountMerchant": "0E-8",
        "blockageRateAmountSubMerchant": "0E-8",
        "subMerchantPayoutAmount": "0E-8",
        "merchantPayoutAmount": 0.21453,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    }
  ],
  "authCode": "579803",
  "phase": "AUTH",
  "hostReference": "mock00007iyzihostrfn",
  "signature": "5ab609ed2e0f4cae0035c8c136d29b00c2616cf8fb4856df65bb52b5a796369f",
  "paymentStatus": "SUCCESS"
}
Örnek Kodlar



3DS Entegrasyonu

Adımlar
BIN Sorgulama

3DS Başlatma

"threeDSHtmlContent" Decode

Yönlendirme

3DS Tamamlama

Webhook

Genel Özet

BIN Sorgulama; API'nin taksit seçenekleri ve kart ayrıntıları hakkında bilgi döndürdüğü, kartı veren kuruluşun ayrıntılarını tanımladığı bölüm.


3DS Başlatma; iki adımlı 3DS işlemlerini yönetmeye ilişkin ilk POST isteği


" threeDSHtmlContent"; son kullanıcınızın 3DS sayfa OTP doğrulamasını doğrulamasını beklediği base64 şifreli HTML sayfası.


Yönlendirme; Tüketicilerin ödemelerini takip eden iyzico, verilen callbackUrl'si ile ilişkilendirilen IPN'i (Anında Ödeme Bildirimi) tetikler.


3DS Tamamlama; Acquirer ve Issuer arasındaki işlemi resmileştirmek için gerçekleştirilen adım.


Webhook; İlgili ödemenin gerçek zamanlı bildirimi.


Örnek Uygulama
Temel NON-3DS uygulaması, kısaca birbirini takip eden iki POST isteğinden oluşur.

3DS Başlatma

3DS Tamamlama

Önerilen entegrasyon aşağıdaki sırayla izlenir;

1. BIN Check
İster 3DS ister NON-3DS ödeme yöntemi olsun, alışverişte kullanılacak kartın özelliğinin önceden belirlenmesi tavsiye edilir. BIN detay hizmetleri sayesinde kart türü, kart şeması, kart ile ilgili taksit bilgileri ve 3DS özelliklerine ilişkin daha ayrıntılı bilgiler alınır.

Taksit Bilgisini Almaya Yönelik Örnek İstek;

Copy
{
"price":"100.0",
"binNumber":"535805"
}
Taksit Bilgisini Almaya Yönelik Örnek Yanıt;

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1685905139724,
    "installmentDetails": [
        {
            "binNumber": "535805",
            "price": 100.0,
            "cardType": "DEBIT_CARD",
            "cardAssociation": "MASTER_CARD",
            "cardFamilyName": "iyzico DC",
            "force3ds": 0,
            "bankCode": 864,
            "bankName": "iyzico",
            "forceCvc": 0,
            "commercial": 0,
            "dccEnabled": 0,
            "installmentPrices": [
                {
                    "installmentPrice": 100.0,
                    "totalPrice": 100.0,
                    "installmentNumber": 1
                }
            ]
        }
    ]
}
2. Init 3DS
3DS ödeme yolculuğu, 3DS POST isteğinin başlatılmasıyla başlar.

Örnek 3DS Başlatma İsteği;


Copy
{
    "locale": "en",
    "price": "3.2",
    "paidPrice": "3.2",
    "installment": 1,
    "paymentChannel": "WEB",
    "basketId": "B67832",
    "paymentGroup": "PRODUCT",
    "paymentCard": {
        "cardHolderName": "Dev iyzico",
        "cardNumber": "5526080000000006",
        "expireYear": "2023",
        "expireMonth": "11",
        "cvc": "200"
    },
    "buyer": {
        "id": "BY789",
        "name": "John",
        "surname": "Doe",
        "identityNumber": "74300864791",
        "email": "email@email.com",
        "gsmNumber": "+905350000000",
        "registrationDate": "2013-04-21 15:12:09",
        "lastLoginDate": "2015-10-05 12:43:35",
        "registrationAddress": "Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34732",
        "ip": "85.34.78.112"
    },
    "conversationId": "deviyzico",
    "shippingAddress": {
        "address": "Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
        "zipCode": "34742",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey"
    },
    "billingAddress": {
        "address": "Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
        "zipCode": "34742",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey"
    },
    "basketItems": [
        {
            "id": "BI101",
            "price": "1.1",
            "name": "Binocular",
            "category1": "Collectibles",
            "category2": "Accessories",
            "itemType": "PHYSICAL"
        },
        {
            "id": "BI1012",
            "price": "2.1",
            "name": "Binocular",
            "category1": "Collectibles",
            "category2": "Accessories",
            "itemType": "PHYSICAL"
        }
    ],
    "currency": "TRY",
    "callbackUrl": "https://deviyzico.com/"
}n
Karşılığında diğer parçalarla birlikte " threeDSHtmlContent" anahtar/değerinin alınması beklenir.

Örnek 3DS Başlatma Yanıtı;


Copy
{
    "status": "success",
    "locale": "en",
    "systemTime": 1685539494559,
    "conversationId": "deviyzico",
    "threeDSHtmlContent": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8dGl0bGU+aXl6aWNvIE1vY2sgM0QtU2VjdXJlIFByb2Nlc3NpbmcgUGFnZTwvdGl0bGU+CjwvaGVhZD4KPGJvZHk+Cjxmb3JtIGlkPSJpeXppY28tM2RzLWZvcm0iIGFjdGlvbj0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L21vY2svaW5pdDNkcyIgbWV0aG9kPSJwb3N0Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9Im9yZGVySWQiIHZhbHVlPSJtb2NrNDYtNjg3NjU1ODAwODI2MjM5NWl5emlvcmQiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYmluIiB2YWx1ZT0iNTUyNjA4Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN1Y2Nlc3NVcmwiIHZhbHVlPSJodHRwczovL3NhbmRib3gtYXBpLml5emlwYXkuY29tL3BheW1lbnQvaXl6aXBvcy9jYWxsYmFjazNkcy9zdWNjZXNzLzI3Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImZhaWx1cmVVcmwiIHZhbHVlPSJodHRwczovL3NhbmRib3gtYXBpLml5emlwYXkuY29tL3BheW1lbnQvaXl6aXBvcy9jYWxsYmFjazNkcy9mYWlsdXJlLzI3Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImNvbmZpcm1hdGlvblVybCIgdmFsdWU9Imh0dHBzOi8vc2FuZGJveC1hcGkuaXl6aXBheS5jb20vcGF5bWVudC9tb2NrL2NvbmZpcm0zZHMiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iUGFSZXEiIHZhbHVlPSJjYWIxNjA0YS02MWJiLTQ0NGQtOGExNS1kZDZmMzhjZGRiNjMiPgo8L2Zvcm0+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpeXppY28tM2RzLWZvcm0iKS5zdWJtaXQoKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg=="
}
3. "threeDSHtmlContent" Kodu Çözme
"threeDSHtmlContent", şifrelenmiş 3DS formunun kendisini temsil eder. 3DS başlangıcının yanıtından kodlanmış " threeDSHtmlContent" parametresini tarayıcıda render ettiğimizde tüketicinin karşısına 3DS ekranı çıkacaktır.

Kodu Çözülmüş "thirdDSHtmlContent" Sandbox Örneği;


Copy
"threeDSHtmlContent": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8dGl0bGU+aXl6aWNvIE1vY2sgM0QtU2VjdXJlIFByb2Nlc3NpbmcgUGFnZTwvdGl0bGU+CjwvaGVhZD4KPGJvZHk+Cjxmb3JtIGlkPSJpeXppY28tM2RzLWZvcm0iIGFjdGlvbj0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L21vY2svaW5pdDNkcyIgbWV0aG9kPSJwb3N0Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9Im9yZGVySWQiIHZhbHVlPSJtb2NrNDYtNjg3NjU1ODAwODI2MjM5NWl5emlvcmQiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYmluIiB2YWx1ZT0iNTUyNjA4Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN1Y2Nlc3NVcmwiIHZhbHVlPSJodHRwczovL3NhbmRib3gtYXBpLml5emlwYXkuY29tL3BheW1lbnQvaXl6aXBvcy9jYWxsYmFjazNkcy9zdWNjZXNzLzI3Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImZhaWx1cmVVcmwiIHZhbHVlPSJodHRwczovL3NhbmRib3gtYXBpLml5emlwYXkuY29tL3BheW1lbnQvaXl6aXBvcy9jYWxsYmFjazNkcy9mYWlsdXJlLzI3Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9ImNvbmZpcm1hdGlvblVybCIgdmFsdWU9Imh0dHBzOi8vc2FuZGJveC1hcGkuaXl6aXBheS5jb20vcGF5bWVudC9tb2NrL2NvbmZpcm0zZHMiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iUGFSZXEiIHZhbHVlPSJjYWIxNjA0YS02MWJiLTQ0NGQtOGExNS1kZDZmMzhjZGRiNjMiPgo8L2Zvcm0+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpeXppY28tM2RzLWZvcm0iKS5zdWJtaXQoKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg=="
Kodlanmış "thirdDSHtmlContent" Sandbox Örneği;


Copy
<!doctype html>
<html lang="en">
<head>
    <title>iyzico Mock 3D-Secure Processing Page</title>
</head>
<body>
<form id="iyzico-3ds-form" action="https://sandbox-api.iyzipay.com/payment/mock/init3ds" method="post">
    <input type="hidden" name="orderId" value="mock46-6876558008262395iyziord">
    <input type="hidden" name="bin" value="552608">
    <input type="hidden" name="successUrl" value="https://sandbox-api.iyzipay.com/payment/iyzipos/callback3ds/success/27">
    <input type="hidden" name="failureUrl" value="https://sandbox-api.iyzipay.com/payment/iyzipos/callback3ds/failure/27">
    <input type="hidden" name="confirmationUrl" value="https://sandbox-api.iyzipay.com/payment/mock/confirm3ds">
    
    <input type="hidden" name="PaReq" value="cab1604a-61bb-444d-8a15-dd6f38cddb63">
    <input type="hidden" name="termUrl" value="cab1604a-61bb-444d-8a15-dd6f38cddb63">
    <input type="hidden" name="md" value="cab1604a-61bb-444d-8a15-dd6f38cddb63">
    
</form>
<script type="text/javascript">
    document.getElementById("iyzico-3ds-form").submit();
</script>
</body>
</html>
Tarayıcıdaki kodu çözülmüş threeDSHtmlContent arayüzünün bir örneği;


4. Yönlendirme
Yeniden yönlendirme aşaması, 3DS Başlatma ve 3DS Tamamlama adımlarını genel olarak birbirine bağlar. 

Kart sahibi OTP (Tek Kullanımlık Şifre) onayının ardından iyzico, sayfayı otomatik olarak "callbackUrl" parametresinde belirtilen adrese yönlendirecektir. Yönlendirme POST'u şunları içerir;

Parametre ismi
Tip
Açıklama
status

String

Yapılan isteğin sonucunu bildirir. İşlem başarılı ise success, hatalı ise failure döner.

paymentId

String

İşlem success yani başarılı ise, iyzico tarafından o ödemeye verilen değerdir. 3D bitirme sorgusunda kullanılacaktır.

conversationData

String

İşlem success yani başarılı ise, iyzico tarafından o ödemeye verilen değerdir. Bütün durumlarda dolu gelmeyebilir. Eğer dolu gelirse bu parametrenin de 3D bitirme sorgusunda gönderilmesi gerekir.

conversationId

Long

Başlatma sorgusunda gönderilen conversationId değeridir.

mdStatus

String

Bilgilendirme amaçlı dönen mdStatus değeridir. Başarılı durumlar için 1 başarısız durumlar için ise 0,2,3,4,5,6,7,8 olarak dönebilir.

mdStatus
"mdStatus", işlem sonucunu 3DS üçgeninde yorumlar.

Başarılı 3DS operasyonları "callbackUrl" üzerinde "mdStatus":"1" ile sonuçlanırken, başarısızlık senaryolarında aşağıdaki listeden biri olabilir;

mdStatus
Açıklama
mdStatus = 0

3-D Secure imzası geçersiz veya doğrulama.

mdStatus = -1

mdStatus = 0 ile aynıdır. QNB Finansbank'a özel dönüştür.

mdStatus = 2

Kart sahibi veya bankası sisteme kayıtlı değil.

mdStatus = 3

Kartın bankası sisteme kayıtlı değil.

mdStatus = 4

Doğrulama denemesi, kart sahibi sisteme daha sonra kayıt olmayı seçmiş.

mdStatus = 5

Doğrulama yapılamıyor.

mdStatus = 6

3-D Secure hatası.

mdStatus = 7

Sistem hatası.

mdStatus = 8

Bilinmeyen kart no.

5. 3DS Tamamlama
Yukarıdaki tüm adımları tamamladıktan sonra, artık ödeme işlemini 3DS Tamamlama talebi ile resmileştirme zamanı.

Örnek 3DS Tamamlama İsteği;


Copy
{
  "paymentId": "123456789"
}
Örnek 3DS Tamamlama Yanıtı;


Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1685539637584,
    "price": 3.20000000,
    "paidPrice": 3.20000000,
    "installment": 1,
    "paymentId": "123456789",
    "fraudStatus": 1,
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0E-8,
    "iyziCommissionRateAmount": 0.12800000,
    "iyziCommissionFee": 0.25000000,
    "cardType": "DEBIT_CARD",
    "cardAssociation": "MASTER_CARD",
    "cardFamilyName": "iyzico DC",
    "binNumber": "535805",
    "lastFourDigits": "0006",
    "basketId": "B67832",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "123456789",
            "transactionStatus": 2,
            "price": 1.10000000,
            "paidPrice": 1.10000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.04400000,
            "iyziCommissionFee": 0.08593750,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0,
            "blockageResolvedDate": "2023-06-08 00:00:00",
            "subMerchantPrice": 0,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0,
            "merchantPayoutAmount": 0.97006250,
            "convertedPayout": {
                "paidPrice": 1.10000000,
                "iyziCommissionRateAmount": 0.04400000,
                "iyziCommissionFee": 0.08593750,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 0.97006250,
                "iyziConversionRate": 0,
                "iyziConversionRateAmount": 0,
                "currency": "TRY"
            }
        },
        {
            "itemId": "BI1012",
            "paymentTransactionId": "123456788",
            "transactionStatus": 2,
            "price": 2.10000000,
            "paidPrice": 2.10000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.08400000,
            "iyziCommissionFee": 0.16406250,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0,
            "blockageResolvedDate": "2023-06-08 00:00:00",
            "subMerchantPrice": 0,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0,
            "merchantPayoutAmount": 1.85193750,
            "convertedPayout": {
                "paidPrice": 2.10000000,
                "iyziCommissionRateAmount": 0.08400000,
                "iyziCommissionFee": 0.16406250,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 1.85193750,
                "iyziConversionRate": 0,
                "iyziConversionRateAmount": 0,
                "currency": "TRY"
            }
        }
    ],
    "authCode": "905307",
    "phase": "AUTH",
    "mdStatus": 1,
    "hostReference": "mock00007iyzihostrfn"
}
NOT : mdStatus parametresi sadece 3DS işlemlerinde görünecektir.

6. Webhook
Webhook’lar 3DS akışımızın son konusudur.

Gerçek zamanlı ödeme bildirimlerinin alınması, genel olarak 3DS deneyiminden yararlanırken bildirimlerin güvenilir kaynaklardan gelmesini sağlar ve hassas verilere olası müdahaleleri veya yetkisiz erişimi önler.

Her ödeme olayı Webhook’ları tetikler;

Her 15 saniyede bir

Sunucunuz 200 yanıtını alana kadar.

Her 10 dakikada bir

Maksimum 3 kere

Örnek Webhook 3DS Yetkilendirmesi
Parametere
Type
Description
iyziEventTime

long

Unix timestamp value of first notification.

iyziEventType

string

Shows the request type. Values: API_AUTH, THREE_DS_AUTH, BKM_AUTH

iyziReferenceCode

string

A unique reference code for the notification

paymentId

long

Unique iyzico reference code of related payment

paymentConversationId

string

Merchant's reference id for the related payment

status

string

Payment status. Values: SUCCESS, FAILURE

Olumlu senaryo status değişkeninin success dönmesiyle gerçekleşir.

Doğrulama

Ödeme işlemlerinin başarılı bir şekilde sonuçlandırılmasında belirli değişkenlerin korelasyonu önemli rol oynar;

paymentId

status

price

Diğer Eşleştirme parametreleri opsiyoneldir.

3DS Tamamlama yanıtı ve Webhook bildiriminin birbirini doğrulaması hayati önem taşımaktadır.

3DS Tamamlama yanıtında bulunan paymentId değişkeni Webhook’tan gelen paymentId değişkeniyle aynı olmalıdır.

Her iki istekten gelen status değişkeni success olmalıdır.

price parametresindeki miktar aynı olmalıdır.

Ve son olarak, Eşleştirme parametreleri de eşit olmalıdır.

Eğer eşitse, tebrikler! 3DS entegrasyonunu bitirdiniz.

İşlem detaylarına panelinizden ulaşabilirsiniz.

Hangi Ürünlerle Birlikte Kullanılabilir?
Online Ödeme
Pazaryeri
Abonelik
iyzico Link
Ödeme Formu (CheckoutForm)
iyzico ile Öde (PWI)
Avantajlar
Daha hızlı entegrasyon

1.X.X veya 2.X.X'i kapsayan tek 3DS yöntemi

Diğer iyzico API'leri ile kullanım kolaylığı



3DS Başlatma
3DS Başlatma API’si müşterinin kart ödemelerinin 3DS ile işlenmesinden sorumludur. 

NON-3DS entegrasyonunda olduğu gibi;

TROY, MASTERCARD, VISA ve AMEX markalı kartlarla yapılan işlemleri destekler.

BONUS, WORLD, MAXIMUM, AXESS, CARDFINANS, PARAF, ADVANTAGE gibi taksit programlarına katılmış olan kartlara 2, 3, 6, 9 ve 12 taksit seçenekleri sunulmaktadır.

Panelde başarılı işlemler yeşil renkte, başarısız işlemler ise kırmızı renkte görüntülenir.

Üye iş yeri, conversationId ve basketId parametrelerini kendi tarafında sipariş numarası olarak kullanabilir.

Bu özellikleri birleştirerek müşterilerinize, işlemlerinin başarısı veya başarısızlığı hakkında gerçek zamanlı geri bildirim sağlayarak kusursuz bir ödeme deneyimi sağlayabilirsiniz.

Initialize 3DS Payment
post

https://api.iyzipay.com
/payment/3dsecure/initialize
3D Secure oturumu başlatır ve 3DS doğrulama için htmlContent değeri döner.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve base64 formatında üretilmiş imzalı hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Content-Type değeri.

Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Varsayılan; tr

Example: tr
Possible values: tren
conversationId
string
İstek/yanıt eşleştirme ID’si.

Example: conversationId
price
decimal
Sepet toplamı.

Example: 1
paidPrice
decimal
Tahsil edilecek nihai tutar.

Example: 1
currency
string · enum
Para birimi. Varsayılan; TRY.

Example: TRY
Possible values: TRYUSDEURGBPNOKCHF
installment
integer · enum
Taksit sayısı (gönderilmezse tek çekim olarak işlem gerçekleşir).

Example: 1
Possible values: 12346912
paymentChannel
string · enum
Ödeme kanalı.

Example: WEB
Possible values: WEBMOBILEMOBILE_WEBMOBILE_IOSMOBILE_ANDROIDMOBILE_WINDOWSMOBILE_TABLETMOBILE_PHONE
basketId
string
Sepet ID.

Example: basketId
paymentGroup
string · enum
Ödeme grubu. Varsayılan; PRODUCT.

Example: PRODUCT
Possible values: PRODUCTLISTINGSUBSCRIPTION
callbackUrl
string
3DS işlem sonrası yönlenecek dönüş URL’si.

Example: https://callbackurl.com

paymentCard
object
Kart Bilgileri.


buyer
object
Alıcı Bilgileri.


shippingAddress
object
Kargo Adresi. Sepetteki ürünlerden en az bir tanesinin, itemType "PHYSICAL" olması durumunda gönderilmesi zorunludur. Tüm ürünler "VIRTUAL" olduğu taktirde gönderilmesi gerekmez.


billingAddress
object
Fatura Adresi.


basketItems
object[]
Sepetteki ürünler.

paymentSource
string
Bu alan, partner firmalar tarafından iletilen ödeme kaynağı bilgisidir. Eğer bir altyapı sağlayıcısıysanız ve iyzico ile entegrasyon/iş birliğiniz bulunuyorsa bu parametreyi gönderebilirsiniz.

Example: Shopify
Responses
200
Başarılı yanıt (3DS başlatıldı)

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/3dsecure/initialize
HTTP

Copy
POST https://api.iyzipay.com/payment/3dsecure/initialize
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "locale": "tr",
  "conversationId": "conversationId",
  "price": 1.0,
  "paidPrice": 1.0,
  "currency": "TRY",
  "installment": 1,
  "paymentChannel": "WEB",
  "basketId": "basketId",
  "paymentGroup": "PRODUCT",
  "callbackUrl": "callbackUrl",
  "paymentCard": {
    "cardHolderName": "John Doe",
    "cardNumber": "5528790000000008",
    "expireYear": "28",
    "expireMonth": "12",
    "cvc": "123",
    "registerCard":0
  },
  "buyer": {
    "id": "1",
    "name": "John",
    "surname": "Doe",
    "identityNumber": "1234512345123125213125213",
    "email": "email@email.com",
    "gsmNumber": "+905350000000",
    "registrationDate": "2013-04-21 15:12:09",
    "lastLoginDate": "2015-10-05 12:43:35",
    "registrationAddress": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "city": "İstanbul",
    "country": "Turkey",
    "zipCode": "34732",
    "ip": "85.34.78.112"
  },
  "shippingAddress": {
    "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "zipCode": "34742",
    "contactName": "Jane Doe",
    "city": "Istanbul",
    "country": "Turkey"
  },
  "billingAddress": {
    "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "zipCode": "34742",
    "contactName": "Jane Doe",
    "city": "Istanbul",
    "country": "Turkey"
  },
  "basketItems": [
    { "id": "BI101", "price": 0.4, "name": "Binocular", "category1": "Collectibles", "category2": "Accessories", "itemType": "PHYSICAL" },
    { "id": "BI102", "price": 0.3, "name": "Game code", "category1": "Game", "category2": "Online Game Items", "itemType": "VIRTUAL" },
    { "id": "BI103", "price": 0.3, "name": "Usb", "category1": "Electronics", "category2": "Usb / Cable", "itemType": "PHYSICAL" }
  ],
  "paymentSource": "Test"
}

200
Başarılı yanıt (3DS başlatıldı)



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1755197726218,
  "conversationId": "conversationId",
  "threeDSHtmlContent": "PCFkb2N0eXBlIGh0bWw+...",
  "paymentId": "25149157",
  "signature": "c8964a1878f9dae20741209dea6749d16bac4a8760775ae69b0b2420d9dc024b"
}
Örnek Kodlar
PHP

Java

.NET

Node.Js

Python

Son olarak aşağıdaki başlıkları analiz ederek, ödeme sorgusunun sonucunu etkili bir şekilde yönetebilir ve yanıtlayabilirsiniz, böylece müşterileriniz için sorunsuz ve güvenilir bir ödeme süreci sağlayabilirsiniz.

status parametresi işlemin durumu hakkında bilgi sağlar. success, işlemin başarıyla tamamlandığını ve ödemenin işlendiğini gösterir. failure, işlemin başarısız olduğunu belirtir ve başarısızlığın nedenine ilişkin bir hata mesajı verilir.

Bu hizmet için paymentStatus parametresi boştur.

paymentId ve paymentTransactionId değerleri, ileride referans noktası olarak kullanılabileceği için saklanmalıdır.

Başarısız bir işlem durumunda (failure durumu), errorCode, errorMessage ve errorGroup parametreleri, hatayla ilgili ayrıntıları sağlayarak ilgili değerlerle birlikte döndürülür.



3DS Tamamlama
xiyzico'da kayıtlı bir işlemin detayına ulaşmak için ödeme sorgulama hizmetini kullanabilirsiniz.

Servise gönderilmesi gereken parametreler aşağıdaki gibidir:

Create 3DS Payment
post

https://api.iyzipay.com
/payment/3dsecure/auth
3DS doğrulaması sonrasında, ödeme işleminin sonlandırılması için bu endpoint’e istek yapılmalıdır. Bu servis, doğrulama adımından sonra alınan bilgilerle çalıştırılır ve işlemi başarılı ya da başarısız olarak sonuçlandırır.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve base64 formatında üretilmiş imzalı hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Content-Type değeri.

Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Varsayılan; tr

Example: tr
Possible values: tren
paymentId
string
Initialize çağrısından dönen ödeme ID’si.

Example: 25149157
conversationId
string
İstek/yanıt eşleştirme ID’si.

Example: conversationId
conversationData
string
3DS sonucunda post edilen data. Dolu dönerse gönderilmesi zorunludur.

Responses
200
Başarılı yanıt (ödeme tamamlandı)

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/3dsecure/auth
HTTP

Copy
POST https://api.iyzipay.com/payment/3dsecure/auth
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "locale": "tr",
  "paymentId": "25149157",
  "conversationId": "conversationId",
  "conversationData": ""
}

200
Başarılı yanıt (ödeme tamamlandı)



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1755198001941,
  "conversationId": "conversationId",
  "price": 1,
  "paidPrice": 1,
  "installment": 1,
  "paymentId": "25149157",
  "fraudStatus": 1,
  "merchantCommissionRate": 0,
  "merchantCommissionRateAmount": 0,
  "iyziCommissionRateAmount": 0.0349,
  "iyziCommissionFee": 0.25,
  "cardType": "CREDIT_CARD",
  "cardAssociation": "MASTER_CARD",
  "cardFamily": "Paraf",
  "binNumber": "552879",
  "lastFourDigits": "0008",
  "basketId": "basketId",
  "currency": "TRY",
  "itemTransactions": [
    {
      "itemId": "BI101",
      "paymentTransactionId": "27138714",
      "transactionStatus": 2,
      "price": 0.4,
      "paidPrice": 0.4,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.01396,
      "iyziCommissionFee": 0.1,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-08-22 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 0.28604,
      "convertedPayout": {
        "paidPrice": 0.4,
        "iyziCommissionRateAmount": 0.01396,
        "iyziCommissionFee": 0.1,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 0.28604,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    },
    {
      "itemId": "BI102",
      "paymentTransactionId": "27138715",
      "transactionStatus": 2,
      "price": 0.3,
      "paidPrice": 0.3,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.01047,
      "iyziCommissionFee": 0.075,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-08-22 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 0.21453,
      "convertedPayout": {
        "paidPrice": 0.3,
        "iyziCommissionRateAmount": 0.01047,
        "iyziCommissionFee": 0.075,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 0.21453,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    },
    {
      "itemId": "BI103",
      "paymentTransactionId": "27138716",
      "transactionStatus": 2,
      "price": 0.3,
      "paidPrice": 0.3,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.01047,
      "iyziCommissionFee": 0.075,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-08-22 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 0.21453,
      "convertedPayout": {
        "paidPrice": 0.3,
        "iyziCommissionRateAmount": 0.01047,
        "iyziCommissionFee": 0.075,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 0.21453,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    }
  ],
  "authCode": "214525",
  "phase": "AUTH",
  "mdStatus": 1,
  "hostReference": "mock00001iyzihostrfn",
  "signature": "5f510cd92b4b9c50a39b617cda228f4159f290860a4c20a965c55b119c9e9052"
}
Örnek Kodlar
PHP

Java

.NET

Node.Js

Python

Postman

3DS Tamamlama v2 - Geliştirilmiş Ödeme Güvenliği
iyzico'da, yakın zamanda gerçekleştirilen HMACSHA256 güncellemesinin ardından, mevcut payment/v2/3dsecure/auth endpoint’ine ek olarak payment/3dsecure/auth endpoint'ini devreye aldık. Bu endpoint, kayıtlı 3D ödemelerini tamamlamak ve müşterinin kartından çekilen nihai tutar, ilgili ödemenin conversationId ve paymentId bilgilerini içeren detayları elde etmek için kullanılır.

Bununla birlikte, ilgili ödemenin tamamlanması için daha güvenilir doğrulama teknikleri kullanılabilir.  İmza Yanıtının Doğrulanması'nda belirtildiği gibi, ödeme isteği sonucunda döndürülen ve istek tablosunda listelenen değişkenler bu süreçte önemli bir rol oynar.

İmza Yanıtının Doğrulanması'nda gösterildiği gibi, şifrelenmiş payload için her iki tarafta imza üretildiğinde ve bu imzalar eşit olduğunda, ilgili ödeme başarıyla tamamlanır.

Create 3DS v2 Payment
post

https://api.iyzipay.com
/payment/v2/3dsecure/auth
Doğrulama sonrası ödeme sonucunun alınması için hem v1 hem de yeni nesil v2 endpoint’i kullanılabilir. Daha güncel teknolojilere uyum sağlamak adına v2 endpoint’inin kullanılmasını öneririz.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve base64 formatında üretilmiş imzalı hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Content-Type değeri.

Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Varsayılan; tr

Example: tr
Possible values: tren
paymentId
string
3DS başlatma sonrasında dönen ödeme ID’si.

Example: 25146302
conversationId
string
İstek/yanıt eşleştirme ID’si.

Example: conversationId
paidPrice
decimal
3DS v2 tamamlamada kullanılacak tahsilat tutarı. INIT 3DS aşamasında gönderilen paidPrice değeri ile uyumlu olmalı.

Example: 1
basketId
string
Sepet ID’si (INIT 3DS basketId ile eşleşmelidir).

Example: basketId
currency
string · enum
Para birimi. Varsayılan; TRY (INIT 3DS'de gönderilen değer ile eşleşmelidir.)

Example: TRY
Possible values: TRYUSDEURGBPNOKCHF
Responses
200
Başarılı yanıt (ödeme tamamlandı)

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/v2/3dsecure/auth
HTTP

Copy
POST https://api.iyzipay.com/payment/v2/3dsecure/auth
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "locale": "tr",
  "paymentId": "25146302",
  "conversationId": "conversationId",
  "paidPrice": 1.0,
  "basketId": "basketId",
  "currency": "TRY"
}

200
Başarılı yanıt (ödeme tamamlandı)



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1755203584577,
  "conversationId": "conversationId",
  "price": 1,
  "paidPrice": 1,
  "installment": 1,
  "paymentId": "25149538",
  "fraudStatus": 1,
  "merchantCommissionRate": 0,
  "merchantCommissionRateAmount": 0,
  "iyziCommissionRateAmount": 0.0349,
  "iyziCommissionFee": 0.25,
  "cardType": "CREDIT_CARD",
  "cardAssociation": "MASTER_CARD",
  "cardFamily": "Paraf",
  "binNumber": "552879",
  "lastFourDigits": "0008",
  "basketId": "basketId",
  "currency": "TRY",
  "paymentChannel": "WEB",
  "itemTransactions": [
    {
      "itemId": "BI101",
      "paymentTransactionId": "27139066",
      "transactionStatus": 2,
      "price": 0.4,
      "paidPrice": 0.4,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.01396,
      "iyziCommissionFee": 0.1,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-08-22 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 0.28604,
      "convertedPayout": {
        "paidPrice": 0.4,
        "iyziCommissionRateAmount": 0.01396,
        "iyziCommissionFee": 0.1,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 0.28604,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    }
  ],
  "authCode": "847162",
  "phase": "AUTH",
  "mdStatus": 1,
  "hostReference": "mock00001iyzihostrfn",
  "signature": "f95c9246235c30cad41169bb1df7381b7ffe42bf1ea1226c2dd211e83dfe40f7"
}
Örnek Kodlar
Java

Json

Auth 3DS vs Auth v2 3DS
Daha önce geliştirilmiş olan payment/3dsecure/auth endpoint’i, standart 3D Secure 1.0 protokolünü kullanır ve daha basit bir yapı sunarak eski sistemlerin entegrasyonunu kolaylaştırır. Buna karşılık, payment/v2/3dsecure/auth endpointendpoint’i, daha gelişmiş 3D Secure 2.0 protokolü üzerine inşa edilmiştir. Bu yeni protokol, risk analizi için daha zengin veri noktaları sunarak güvenliği artırır ve modern sistemlerle daha akıcı bir entegrasyon sağlar. payment/3dsecure/auth istemel işlemler için güvenilir bir seçenek olsa da, payment/v2/3dsecure/auth daha üstün güvenlik, geliştirilmiş kullanıcı deneyimi ve gelişen ödeme düzenlemeleriyle daha iyi uyumluluk sunar. Bu avantajlar için payment/v2/3dsecure/auth geçiş yapmanızı öneririz.



CF Başlatma
Bu, ödemelerinizi tamamlamanın en hızlı ve en kolay yoludur. Kart ön tarafı kontrolleri, BIN sorgulamaları, taksit sorgulamaları, 3D Secure kontrolleri veya kart bilgileri kaydetme entegrasyonları gibi ek sorgulara ihtiyaç duymadan sorunsuz bir ödeme süreci sağlar. Bu süreci takip ederek iyzico ile sorunsuz ve verimli bir entegrasyon sağlayabilir, müşterilerinize kolaylaştırılmış bir ödeme deneyimi sunabilirsiniz.

Ödeme Formu (CF) Başlatma
post

https://api.iyzipay.com
/payment/iyzipos/checkoutform/initialize/auth/ecom
Ödeme formu (Checkout Form) oturumu başlatır ve ödeme sayfasını göstermek için checkoutFormContent / paymentPageUrl ve işleme ait token döner.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve base64 formatında üretilmiş imzalı hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Content-Type değeri.

Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Varsayılan; tr. Ödeme formunun İngilizce oluşturulması için "en" gönderilmelidir.

Example: tr
Possible values: tren
conversationId
string
İstek/yanıt eşleştirme ID’si. İstekte gönderilen değer, response'da aynen geri döner.

Example: conversationId
price
decimal
Sepet toplamı.

Example: 6
paidPrice
decimal
Tahsil edilecek toplam tutar.

Example: 6
currency
string · enum
Para birimi. Varsayılan; TRY.

Example: TRY
Possible values: TRYUSDEURGBPNOKCHF
basketId
string
Sepet ID’si.

Example: basketId
paymentGroup
string · enum
Ödeme grubu. Varsayılan; PRODUCT.

Example: PRODUCT
Possible values: PRODUCTLISTINGSUBSCRIPTION
callbackUrl
string
Ödeme akışında üye işyerine başarılı ve hatalı sonucu bildirmek üzere alınan URL adresi. Geçerli bir ssl sertifikasına sahip olmalıdır.

Example: https://callback.com/test
enabledInstallments
integer[]
Kullanılabilir taksit seçenekleri.

Example: [1,2,3,4,6,9,12]

buyer
object
Alıcı Bilgileri


shippingAddress
object
Teslimat Adresi. Sepetteki ürünlerden en az bir tanesi PHYSICAL ise zorunludur. Tüm ürünler VIRTUAL ise gönderilmesi gerekmez.


billingAddress
object
Fatura Adresi


basketItems
object[]
Sepetteki ürünler.

paymentSource
string
Bu alan, partner firmalar tarafından iletilen ödeme kaynağı bilgisidir. Eğer bir altyapı sağlayıcısıysanız ve iyzico ile entegrasyon/iş birliğiniz bulunuyorsa bu parametreyi gönderebilirsiniz.

Example: Shopify
Responses
200
Başarılı yanıt (CF başlatıldı)

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/iyzipos/checkoutform/initialize/auth/ecom

HTTP

HTTP

Copy
POST https://api.iyzipay.com/payment/iyzipos/checkoutform/initialize/auth/ecom
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "locale": "tr",
  "conversationId": "conversationId",
  "price": 6.0,
  "paidPrice": 6.0,
  "currency": "TRY",
  "basketId": "basketId",
  "paymentGroup": "PRODUCT",
  "callbackUrl": "https://callback.com/test",
  "enabledInstallments": [1,2,3,4,6,9,12],
  "paymentSource": "Test",
  "buyer": {
    "id": "BY789",
    "name": "John",
    "surname": "Doe",
    "identityNumber": "11111111111",
    "email": "sandboxtest@email.com",
    "gsmNumber": "+905350000000",
    "registrationDate": "2013-04-21 15:12:09",
    "lastLoginDate": "2015-10-05 12:43:35",
    "registrationAddress": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "city": "Istanbul",
    "country": "Turkey",
    "zipCode": "34732",
    "ip": "85.34.78.112"
  },
  "shippingAddress": {
    "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "zipCode": "34742",
    "contactName": "Jane Doe",
    "city": "Istanbul",
    "country": "Turkey"
  },
  "billingAddress": {
    "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "zipCode": "34742",
    "contactName": "Jane Doe",
    "city": "Istanbul",
    "country": "Turkey"
  },
  "basketItems": [
    {"id": "BI101", "price": 1.0, "name": "Binocular", "category1": "Collectibles", "category2": "Accessories", "itemType": "PHYSICAL"},
    {"id": "BI102", "price": 2.0, "name": "Game code", "category1": "Game", "category2": "Online Game Items", "itemType": "VIRTUAL"},
    {"id": "BI103", "price": 3.0, "name": "Usb", "category1": "Electronics", "category2": "Usb / Cable", "itemType": "PHYSICAL"}
  ]
}

200
Başarılı yanıt (CF başlatıldı)



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1755536500000,
  "conversationId": "conversationId",
  "token": "077aff05-1e9b-44aa-aa11-c268bb8b3826",
  "checkoutFormContent": "<script type=\"text/javascript\">if (typeof iyziInit == 'undefined') {var iyziInit = {currency:\"TRY\",token:\"c6a48036-327e-4808-89d0-d9049b123538\",price:6.00,pwiPrice:6.00,shippingDiscountAmount:null,locale:\"tr\",baseUrl:\"https://sandbox-api.iyzipay.com\", merchantGatewayBaseUrl:\"https://sandbox-merchantgw.iyzipay.com\", consumerGatewayBaseUrl:\"https://sandbox-consumerapigw.iyzipay.com\", registerCardEnabled:false,bkmEnabled:true,bankTransferEnabled:true,bankTransferTimeLimit:{\"value\":5,\"type\":\"day\"},bankTransferRedirectUrl:\"https://callback.com/test\",bankTransferCustomUIProps:{},campaignEnabled:false,campaignMarketingUiDisplay:{},campaignMarketingUiDisplayV2:{\"mobile\":{\"cardTabContent\":\"https://sandbox-static.iyzipay.com/marketing-display/campaign_M_C_v_1754637545492.png\",\"gsmCheckContent\":\"https://sandbox-static.iyzipay.com/marketing-display/campaign_M_G_v_1754637545949.png\",\"pwiTabContent\":\"https://sandbox-static.iyzipay.com/marketing-display/campaign_M_P_v_1754637545797.png\"},\"desktop\":{\"cardTabContent\":\"https://sandbox-static.iyzipay.com/marketing-display/campaign_D_C_v_1754637546014.png\",\"gsmCheckContent\":\"https://sandbox-static.iyzipay.com/marketing-display/campaign_D_G_v_1754637546164.png\",\"pwiTabContent\":\"https://sandbox-static.iyzipay.com/marketing-display/campaign_D_P_v_1754637546098.png\"}},paymentSourceName:\"\",plusInstallmentResponseList:null,payWithIyzicoSingleTab:false,payWithIyzicoSingleTabV2:false,payWithIyzicoOneTab:false,mixPaymentEnabled:true,creditCardEnabled:true,bankTransferAccounts:[{\"iban\":\"TR020006200035600006294884\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Garanti Bankası\",\"bankId\":62,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/62.svg\"},{\"iban\":\"TR080006400000111351092786\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"İş Bankası\",\"bankId\":64,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/64.svg\"},{\"iban\":\"TR340004600786888000080896\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Akbank\",\"bankId\":46,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/46.svg\"},{\"iban\":\"TR910006701000000096073759\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Yapı Kredi Bankası\",\"bankId\":67,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/67.svg\"},{\"iban\":\"TR760001001187768823545001\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Ziraat Bankası\",\"bankId\":10,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/10.svg\"}],userCards:[],fundEnabled:true,memberCheckoutOtpData:{},force3Ds:false,isSandbox:true,storeNewCardEnabled:true,paymentWithNewCardEnabled:true,enabledApmTypes:[\"SOFORT\",\"IDEAL\",\"QIWI\",\"GIROPAY\"],payWithIyzicoUsed:false,payWithIyzicoEnabled:true,payWithIyzicoCustomUI:{},buyerName:\"John\",buyerSurname:\"Doe\",merchantInfo:\"\",merchantName:\"Sandbox Merchant Name - 3404590\",cancelUrl:\"\",buyerProtectionEnabled:true,hide3DS:false,gsmNumber:\"\",email:\"sandboxtest@email.com\",checkConsumerDetail:{},subscriptionPaymentEnabled:false,disabledCardStorageInfoCheckbox:false,ucsEnabled:true,fingerprintEnabled:false,payWithIyzicoFirstTab:false,creditEnabled:false,payWithIyzicoLead:false,zeroAuth:false,goBackUrl:\"\",customMerchantName:\"\",useCurrencySymbol:false,quickPwiEnabled:false,quickPwiNewCardEnabled:false,onlyQuickPwiView:false,consumerCardList:[],isForeignNumber:false,agreementCheckedByDefault:true,metadata : {},createTag:function(){var iyziJSTag = document.createElement('script');iyziJSTag.setAttribute('src','https://cdnsandbox.iyzipay.com/checkoutform/v2/bundle.js?v=1850323636123');document.head.appendChild(iyziJSTag);}};iyziInit.createTag();}</script><script type=\"text/javascript\">if (typeof iyziUcsInit == 'undefined') {var iyziUcsInit = {\"baseUrl\":\"https://sandbox-api.iyzipay.com\", \"ucsToken\":\"1cf43ef6-30ce-402a-a487-1be3f5c8702b\",\"scriptType\":\"BUYER_PROTECTION_CONSENT\",\"buyerProtectedMerchant\":true,\"maskedGsmNumber\":\"\",\"gsmNumber\":\"\",\"merchantName\":\"Sandbox Merchant Name - 3404590\", createTag: function () {var iyziUcsJSTag = document.createElement('script'); iyziUcsJSTag.setAttribute('src', 'https://sandbox-static.iyzipay.com/checkoutform/v2/bundle.js?v=1755539435707'); document.head.appendChild(iyziUcsJSTag);}};if (typeof iyziInit == 'undefined') { iyziUcsInit.createTag(); }}</script>",
  "paymentPageUrl": "https://sandbox-cpp.iyzipay.com?token=c6a48036-327e-4808-89d0-d9049b123538&lang=tr",
  "signature": "66e57d8376c4a15cbee9c8e82c6eb9f47a64bb47c80958c1198847a0049aa5df"
}




CF Sorgulama
Ödeme formunda kart bilgileri girilip "X TL Öde" butonuna basıldığında iyzico, ödeme formunu oluştururken belirttiğiniz callbackUrl adresine yönlendirecektir. Bu adreste iyzico tarafından bir token değeri yayınlanacaktır. Ödeme sonuçlarıyla ilgili ek ayrıntıları görüntülemek için bu token kullanılarak ikinci bir sorgu yapılmalıdır.

Aşağıdaki hizmet, token kullanımını temsil eder;

Ödeme Formu (CF) sorgulama
post

https://api.iyzipay.com
/payment/iyzipos/checkoutform/auth/ecom/detail
CF ödeme formu tamamlandıktan sonra, token ile sonuçları sorgular.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve base64 formatında üretilmiş imzalı hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Content-Type değeri.

Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Varsayılan; tr

Example: tr
Possible values: tren
conversationId
string
İstek/yanıt eşleştirme ID’si. İstekte gönderilen değer, response'da aynen geri döner.

Example: 8152109759
token
string
CF initialize yanıtından dönen token.

Example: 077aff05-1e9b-44aa-aa11-c268bb8b3826
Responses
200
Başarılı yanıt (ödeme tamamlandı)

application/json

Response
object
400
Başarısız yanıt

application/json
post
/payment/iyzipos/checkoutform/auth/ecom/detail

HTTP

HTTP

Copy
POST https://api.iyzipay.com/payment/iyzipos/checkoutform/auth/ecom/detail
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "locale": "tr",
  "conversationId": "8152109759",
  "token": "077aff05-1e9b-44aa-aa11-c268bb8b3826"
}

200
Başarılı yanıt (ödeme tamamlandı)



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1755536577419,
  "conversationId": "8152109759",
  "price": 6,
  "paidPrice": 6,
  "installment": 1,
  "paymentId": "24478123",
  "fraudStatus": 1,
  "merchantCommissionRate": 0,
  "merchantCommissionRateAmount": 0,
  "iyziCommissionRateAmount": 0.2094,
  "iyziCommissionFee": 0.25,
  "cardType": "CREDIT_CARD",
  "cardAssociation": "MASTER_CARD",
  "cardFamily": "Axess",
  "binNumber": "552608",
  "lastFourDigits": "0006",
  "basketId": "basketId",
  "currency": "TRY",
  "itemTransactions": [
    {
      "itemId": "BI101",
      "paymentTransactionId": "26475993",
      "transactionStatus": 2,
      "price": 1,
      "paidPrice": 1,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.0349,
      "iyziCommissionFee": 0.04166667,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-07-20 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 0.92343333,
      "convertedPayout": {
        "paidPrice": 1,
        "iyziCommissionRateAmount": 0.0349,
        "iyziCommissionFee": 0.04166667,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 0.92343333,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    },
    {
      "itemId": "BI103",
      "paymentTransactionId": "26475995",
      "transactionStatus": 2,
      "price": 3,
      "paidPrice": 3,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.1047,
      "iyziCommissionFee": 0.125,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-07-20 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 2.7703,
      "convertedPayout": {
        "paidPrice": 3,
        "iyziCommissionRateAmount": 0.1047,
        "iyziCommissionFee": 0.125,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 2.7703,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    },
    {
      "itemId": "BI102",
      "paymentTransactionId": "26475994",
      "transactionStatus": 2,
      "price": 2,
      "paidPrice": 2,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.0698,
      "iyziCommissionFee": 0.08333333,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-07-20 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 1.84686667,
      "convertedPayout": {
        "paidPrice": 2,
        "iyziCommissionRateAmount": 0.0698,
        "iyziCommissionFee": 0.08333333,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 1.84686667,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    }
  ],
  "authCode": "930115",
  "phase": "AUTH",
  "hostReference": "mock00007iyzihostrfn",
  "signature": "1960256fa0406e6ca0e02a71a9d0b3bd72c2aad4e2677cd315975a4dc8ecfaa5",
  "token": "077aff05-1e9b-44aa-aa11-c268bb8b3826",
  "callbackUrl": "https://callback.com/test",
  "paymentStatus": "SUCCESS"
}



CF Örnek Entegrasyon
Bu dokümanda, Redirect Form ile CF'nin kapsamlı entegrasyon adımlarını derinlemesine inceleyeceğiz ve hızlı, kolay ve güvenli bir entegrasyon için örnek istekler, yanıtlar ve en iyi uygulamalar sağlayacağız.

Ön Gereksinimler
Devam etmeden önce, lütfen aşağıdaki ön koşullara sahip olduğunuzdan emin olunuz.

Sandbox Hesabı

API ve Güvenlik Anahtarı

API çağrılarını yönetmek için bir yazılım aracı; Postman, Insonmina, Github clients

Genel Bakış
CF'nin uygulanması, birbirini izleyen iki POST isteğinin birbiri ardına düzenlenmesini gerektirir.

 Kısacası; 

İlk olarak, bir CF Başlatma POST isteğini göstereceğiz.

Ardından, CF Sorgulama POST isteği ile tamamlayacağız.

Adımlar
CF Başlatma

Token + URL

Yönlendirme

CF Sorgulama

Webhook

Adım 1 - CF Başlatma
CF uygulaması, CF Başlatma POST isteği ile başlar.

Bu adım, bir POST isteği göndermeyi içerir ve istek yapısı; locale, conversationId, price, basketId, paymentGroup, callbackUrl, currency, paidPrice, enabledInstallments, buyer details, shipping address, billing address ve basketItems gibi çeşitli parametreler içerir.

Aşağıdaki nesne, örnek bir CF Başlatma istek gövdesidir.

Örnek CF Başlatma İsteği;

Copy
{
   "locale":"en",
   "conversationId":"sampleConversationId",
   "price":"5.2",
   "basketId":"B67832",
   "paymentGroup":"PRODUCT",
   "buyer":{
      "id":"BY789",
      "name":"Higher",
      "surname":"Faster",
      "identityNumber":"74300864791",
      "email":"stronger@implementation.com",
      "gsmNumber":"+905555434332",
      "registrationAddress":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
      "city":"Istanbul",
      "country":"Turkey",
      "ip":"85.34.78.112"
   },
   "shippingAddress":{
      "address":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
      "contactName":"Jane Doe",
      "city":"Istanbul",
      "country":"Turkey"
   },
   "billingAddress":{
      "address":"Nidakule Göztepe, Merdivenköy Mah. Bora Sok. No:1",
      "contactName":"Jane Doe",
      "city":"Istanbul",
      "country":"Turkey"
   },
   "basketItems":[
      {
         "id":"BI101",
         "price":"5.2",
         "name":"Binocular",
         "category1":"Category 1",
         "itemType":"PHYSICAL"
      }
   ],
   "callbackUrl":"YOUR_CALLBACKURL",
   "currency":"TRY",
   "paidPrice":"5.2",
   "paymentSource":"zooz",
   "enabledInstallments":[
       2,3
   ]
}
Yukarıdaki isteği tetikledikten sonra, çoğunlukla izleyeceğiniz 3 (üç) senaryo vardır. Yanıt paymentPageUrl adlı bir değişken içerir.

Örnek CF Başlatma Yanıtı;


Copy
{
    "status": "success",
    "locale": "en",
    "systemTime": 1687112732811,
    "conversationId": "sampleConversationId",
    "token": "a5b67652-c24a-4347-b61e-6c957bf30f1b",
    "checkoutFormContent": "<script type=\"text/javascript\">if (typeof iyziInit == 'undefined') {var iyziInit = {currency:\"TRY\",token:\"a5b67652-c24a-4347-b61e-6c957bf30f1b\",price:5.20,locale:\"en\",baseUrl:\"https://sandbox-api.iyzipay.com\", merchantGatewayBaseUrl:\"https://sandbox-merchantgw.iyzipay.com\", registerCardEnabled:true,bkmEnabled:true,bankTransferEnabled:true,bankTransferTimeLimit:{\"value\":5,\"type\":\"day\"},bankTransferRedirectUrl:\"YOUR_CALLBACKURL\",bankTransferCustomUIProps:{},campaignEnabled:false,campaignMarketingUiDisplay:null,paymentSourceName:\"zooz\",plusInstallmentResponseList:null,payWithIyzicoSingleTab:true,payWithIyzicoOneTab:false,mixPaymentEnabled:true,creditCardEnabled:true,bankTransferAccounts:[{\"iban\":\"TR020006200035600006294884\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Garanti Bankası\",\"bankId\":62,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/62.svg\"},{\"iban\":\"TR080006400000111351092786\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"İş Bankası\",\"bankId\":64,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/64.svg\"},{\"iban\":\"TR340004600786888000080896\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Akbank\",\"bankId\":46,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/46.svg\"},{\"iban\":\"TR910006701000000096073759\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Yapı Kredi Bankası\",\"bankId\":67,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/67.svg\"},{\"iban\":\"TR760001001187768823545001\",\"legalCompanyTitle\":\"iyzi Ödeme ve Elektronik Para Hizmetleri A.Ş.\",\"currency\":\"TRY\",\"bank\":\"Ziraat Bankası\",\"bankId\":10,\"bankLogoUrl\":\"https://static.iyzipay.com/checkoutform/img/banks/10.svg\"}],userCards:[],fundEnabled:true,memberCheckoutOtpData:{},force3Ds:false,isSandbox:true,storeNewCardEnabled:true,paymentWithNewCardEnabled:true,enabledApmTypes:[\"SOFORT\",\"IDEAL\",\"QIWI\",\"GIROPAY\"],payWithIyzicoUsed:false,payWithIyzicoEnabled:true,payWithIyzicoCustomUI:{},buyerName:\"Higher\",buyerSurname:\"Faster\",merchantInfo:\"\",merchantName:\"Sandbox Merchant Name - 3389550\",cancelUrl:\"\",buyerProtectionEnabled:false,hide3DS:false,gsmNumber:\"+905555434332\",email:\"stronger@implementation.com\",checkConsumerDetail:{},subscriptionPaymentEnabled:false,ucsEnabled:false,fingerprintEnabled:false,payWithIyzicoFirstTab:false,creditEnabled:true,payWithIyzicoLead:false,goBackUrl:\"\",metadata : {},createTag:function(){var iyziJSTag = document.createElement('script');iyziJSTag.setAttribute('src','https://sandbox-static.iyzipay.com/checkoutform/v2/bundle.js?v=1687112732810');document.head.appendChild(iyziJSTag);}};iyziInit.createTag();}</script>",
    "tokenExpireTime": 1800,
    "paymentPageUrl": "https://sandbox-cpp.iyzipay.com?token=a5b67652-c24a-4347-b61e-6c957bf30f1b&lang=en",
    "payWithIyzicoPageUrl": "https://sandbox-ode.iyzico.com/?token=a5b67652-c24a-4347-b61e-6c957bf30f1b&lang=en"
}
Adım 2 - Token + URL
Burada token ve paymentPageUrl, ödeme yolculuğunun geri kalanı için temel düğümlerdir.

Bu adımda, önceki adımda aldığınız yanıttan token ve paymentPageUrl'yi çıkarmanız gerekir. Token daha sonra doğrulama için kaydedilmelidir ve kullanıcıyı ödeme sayfasına yönlendirmek için paymentPageUrl kullanılır.

token; Satıcıların, ödeme yolculuğunun en sonunda ödemeyle yüzleşmek ve doğrulamak için token parametresini kaydetmesi beklenir.

paymentPageUrl; ödeme sayfasının kısaca göründüğü yer. paymentPageUrl'ye yönlendirme, son kullanıcılar için ödeme işlemlerini güvenli bir şekilde gerçekleştirmek için bir arayüz sağlar.

Tarayıcıda paymentPageUrl Arayüz Örneği;

Adım 3 - Yönlendirme
Yönlendirme aşaması, genel olarak CF Başlatma ve CF Sorgulama adımlarını birbirine bağlar.

iyzico, CF ödeme sayfasındaki son kullanıcı etkileşimini takip ederek sayfayı otomatik olarak "callbackUrl" parametresinde verilen adrese yönlendirecektir. Yönlendirme POST'u şunları içerir;

Parametre ismi
Tip
Açıklama
token

String

Her ödeme formu isteği için oluşturulan benzersiz değer. Bu belirteç, ödeme sonucuna erişmek için kullanılır.

Adım 4 - CF Sorgulama
CF Sorgulama, PWI zincirinin son adımıdır. Temel olarak, bir önceki adımda bir ödemeyi henüz kabul ettik. Şimdi bu adımda işlemi yasallaştırma zamanı.

Aşağıdaki örnek, örnek bir CF Sorgulama istek yapısıdır.

Örnek CF Sorgulama İsteği;

Copy
{
    "locale": "en",
    "token": "a5b67652-c24a-4347-b61e-6c957bf30f1b",
    "conversationId": "sampleConversationId"
}
Yukarıdaki isteği tetikledikten sonra, çoğunlukla izleyeceğiniz 2 (iki) senaryo vardır. Yanıt PaymentStatus değişkeninde SUCCESS parametresini içerir.

Örnek CF Sorgulama Yanıtı;

Copy
{
    "status": "success",
    "locale": "en",
    "systemTime": 1687113618054,
    "conversationId": "sampleConversationId",
    "price": 5.20000000,
    "paidPrice": 5.20000000,
    "installment": 1,
    "paymentId": "19831123",
    "fraudStatus": 1,
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0E-8,
    "iyziCommissionRateAmount": 0.20800000,
    "iyziCommissionFee": 0.25000000,
    "cardType": "CREDIT_CARD",
    "cardAssociation": "TROY",
    "cardFamily": "Cardfinans",
    "binNumber": "979203",
    "lastFourDigits": "0000",
    "basketId": "B67832",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "21097896",
            "transactionStatus": 2,
            "price": 5.20000000,
            "paidPrice": 5.20000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.20800000,
            "iyziCommissionFee": 0.25000000,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0E-8,
            "blockageResolvedDate": "2023-06-26 00:00:00",
            "subMerchantPrice": 0E-8,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0E-8,
            "merchantPayoutAmount": 4.74200000,
            "convertedPayout": {
                "paidPrice": 5.20000000,
                "iyziCommissionRateAmount": 0.20800000,
                "iyziCommissionFee": 0.25000000,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 4.74200000,
                "iyziConversionRate": 0E-8,
                "iyziConversionRateAmount": 0E-8,
                "currency": "TRY"
            }
        }
    ],
    "authCode": "104530",
    "phase": "AUTH",
    "mdStatus": 1,
    "hostReference": "mock00037iyzihostrfn",
    "token": "3ee2d355-da4d-47ce-bd3d-13d8c1854128",
    "callbackUrl": "YOUR_CALLBACKURL",
    "paymentStatus": "SUCCESS"
}
mdStatus parametresi sadece 3DS işlemlerinde görünecektir. Lütfen mdStatus ile ilgili daha fazla ayrıntıyı buradan kontrol edin.

Adım 5 - Webhook
Webhook, uygulama düzenimizin en önemli konusudur.

Gerçek zamanlı ödeme bildirimleri almak, genel CF deneyiminden yararlanırken, bildirimlerin güvenilir kaynaklardan gelmesini sağlayarak hassas verilere herhangi bir olası kurcalamayı veya yetkisiz erişimi önler.

Her ödeme olayı, webhook tetikler;

15 saniye içinde gelir.

Sunucunuz 200 yanıtı verene kadar devam eder.

Her 10 dakikada bir tekrarlanır.

En fazla 3 kez tekrarlanır.

Örnek CF Webhook
Parametre ismi
Tip
Açıklama
iyziEventTime

long

Notification oluşturulma zamanının unix timestamp değeridir.

iyziEventType

string

İstek tipini belirtir. Alabileceği değerler CHECKOUTFORM_AUTH, API_AUTH, THREE_DS_AUTH, BALANCE, BKM_AUTH

iyziReferenceCode

string

İstek için üretilen unique iyzico referans kodu

paymentId

long

İlgili ödemenin paymentId bilgisi

paymentConversationId

string

İlgili ödemenin üye işyeri tarafından gönderilmiş referans numarası

status

string

Ödeme durumu. Alabileceği değerler: SUCCESS, FAILURE, CALLBACK_THREEDS

Yanıt, status değişkeninde success parametresini içerir.

Onaylama
Ödeme işlemlerinin başarılı bir şekilde sonuçlandırılması için bazı değişkenlerin korelasyonu önemli rol oynar;

paymentId

status

price

İsteğe bağlı olarak diğer Eşleştirme parametreleri

CF Sorgulama yanıtı ve Webhook bildirimi birbirini doğrulamalıdır.

CF Sorgulama'dan alınan yanıtı ve Webhook bildiriminde alınan verileri çapraz doğrulamak çok önemlidir. İşlemin gerçekliğini ve doğruluğunu sağlamak için ödeme paymentId, status, price ve diğer ilgili parametreleri eşleştiriniz.

CF Sorgulama yanıtındaki ödeme kimliği, Webhook'tan ödeme kimliğine eşit olmalıdır.

Her iki status parametresi de success olmalıdır.

price parametresi tutarları aynı olmalıdır.

Ve son olarak, Eşleştirme parametreleri de aynı olmalıdır.

Sağlanan örnek isteklerin ve yanıtların yalnızca açıklama amaçlı olduğunu ve bunları kendi özel uygulama gereksinimlerinize ve API belgelerinize uyarlamanız gerektiğini lütfen unutmayın.




PWI Entegrasyonu

PWI teknik olarak sırasıyla 2(iki) temel adımdan oluşur;

PWI Başlatma

PWI Sorgulama

PWI - Başlatma, ödeme sürecini başlattığımız yerdir.
PWI - Sorgulama adımı ödeme sonucunun alındığı yerdir.

Adımlar
PWI Başlatma

Token + URL

Yönlendirme

PWI Sorgulama

Webhook

Genel İzlenim

Başlatma; iki adımlı PWI işlemlerini yönetmeye yönelik ilk POST isteği.


Token + URL; Ödeme işlemini başlatmak için tarayıcınızda belirteç ile ilişkili olan payWithIyzicoPageUrl parametresini oluşturması beklenir.


Yönlendirme; iyzico, tüketicilerin ödemelerini takip ederek verilen callbackUrl ile ilişkilendiren IPN'yi (Anında Ödeme Bildirimi) tetikler.


Sorgulama; ödeme işlemini resmileştirmek için adım atın.


Webhook; ilgili ödemenin gerçek zamanlı bildirimi.



PWI Başlatma
Aşağıda belirtilen talebi yaptıktan sonra, müşterilerinizin iyzico ile Ödeme'ye yönlendirileceği benzersiz bir sayfa olan payWithIyzicoPageUrl değerini alacaksınız. Müşterileriniz, ödeme işlemini tamamladıktan sonra iyzico ile Öde başlatma talebinde belirttiğiniz callBackUrl'ye otomatik olarak yönlendirilecektir.

Oluşturulan bağlantıyı ödeme sayfanızda düğme, bağlantı veya div olarak görüntüleyebilirsiniz. Bağlantı ile alınan token bu aşamada veya müşteri ödeme işlemine devam ederse callBackUrl'e gönderildiğinde saklanabilir. Lütfen oluşturulan bağlantı ve token değerlerinin 30 dakika boyunca geçerli olduğunu unutmayın. Bu süre içinde herhangi bir ödeme alınmazsa tokenin süresi dolar.

ÖNEMLİ NOT : callBackUrl adresi mutlaka SSL içermelidir.

Bu özellikleri dahil ederek, işlemlerinin başarısı veya başarısızlığı hakkında gerçek zamanlı geri bildirim ile müşterilerinize sorunsuz bir ödeme deneyimi sağlayabilirsiniz.

iyzico ile Öde (PWI) Başlatma
post

https://api.iyzipay.com
/payment/pay-with-iyzico/initialize
PWI oturumunu başlatır; yönlendirme için token ve sayfa URL’i döner.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve imzalı base64 hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Varsayılan; tr

Example: tr
Possible values: tren
conversationId
string
İstek/yanıt eşleştirme ID’si.

Example: conversationID
price
decimal
Sepet toplamı.

Example: 10
basketId
string
Sepet ID’si.

Example: basketID
paymentGroup
string · enum
Ödeme grubu.

Example: PRODUCT
Possible values: PRODUCTLISTINGSUBSCRIPTION
callbackUrl
string
İşlem sonrası yönlenecek URL.

Example: callbackUrl
currency
string · enum
Para birimi. Varsayılan TRY.

Example: TRY
Possible values: TRYUSDEURGBPNOKCHF
paidPrice
decimal
Tahsil edilecek tutar.

Example: 10
paymentChannel
string · enum
Ödeme kanalı.

Example: WEB
Possible values: WEBMOBILEMOBILE_WEBMOBILE_IOSMOBILE_ANDROIDMOBILE_WINDOWSMOBILE_TABLETMOBILE_PHONE

enabledInstallments
integer · enum[]
Sunulacak taksit seçenekleri.

Example: [1,2,3,6,9,12]

buyer
object
Alıcı Bilgileri


shippingAddress
object
Teslimat Adresi. Sepetteki ürünlerden en az bir tanesi PHYSICAL ise zorunludur. Tüm ürünler VIRTUAL ise gönderilmesi gerekmez.


billingAddress
object
Fatura Adresi


basketItems
object[] · min: 1
Sepetteki ürünler.

Responses
200
Başarılı yanıt (PWI başlatıldı)

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/pay-with-iyzico/initialize

HTTP

HTTP

Copy
POST https://api.iyzipay.com/payment/pay-with-iyzico/initialize
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "locale": "tr",
  "conversationId": "conversationID",
  "price": 10.0,
  "basketId": "basketID",
  "paymentGroup": "PRODUCT",
  "callbackUrl": "callbackUrl",
  "currency": "TRY",
  "paidPrice": 10.0,
  "paymentChannel": "WEB",
  "enabledInstallments": [1,2,3,6,9,12],
  "buyer": {
    "id": "buyerID",
    "name": "buyerName",
    "surname": "buyerSurname",
    "identityNumber": "11111111111",
    "email": "email@email.com",
    "gsmNumber": "+905350000000",
    "registrationAddress": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "city": "Istanbul",
    "country": "Turkey",
    "ip": "85.34.78.112",
    "zipCode": "34732",
    "registrationDate": "2013-04-21 15:12:09",
    "lastLoginDate": "2015-10-05 12:43:35"
  },
  "shippingAddress": {
    "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10 Üsküdar İstanbul",
    "contactName": "Contact Name",
    "city": "Istanbul",
    "country": "Turkey",
    "zipCode": "34742"
  },
  "billingAddress": {
    "address": "Burhaniye Mahallesi Atilla Sokak No:7 Üsküdar",
    "contactName": "Contact Name",
    "city": "Istanbul",
    "country": "Turkey",
    "zipCode": "34700"
  },
  "basketItems": [
    {
      "id": "ItemID",
      "price": 10.0,
      "name": "product Name",
      "category1": "Category Name",
      "itemType": "PHYSICAL"
    }
  ]
}

200
Başarılı yanıt (PWI başlatıldı)



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1755252275214,
  "conversationId": "conversationID",
  "token": "54481021-e605-407e-93d7-776ef481c4d7",
  "tokenExpireTime": 1800,
  "payWithIyzicoPageUrl": "https://sandbox-ode.iyzico.com/?token=54481021-e605-407e-93d7-776ef481c4d7&lang=tr",
  "signature": "a35338903267271c38465924d7d1903b2e10870bebaef1a00923be864e475818"
}
Örnek Kodlar



PWI Sorgulama
Ödeme formunda kart bilgileri girilip "X TL Öde" butonuna basıldığında iyzico, ödeme formunu oluştururken belirttiğiniz callbackUrl adresine yönlendirecektir. Bu adreste iyzico tarafından bir token değeri yayınlanacaktır. Ödeme sonuçlarıyla ilgili ek ayrıntıları görüntülemek için bu token kullanılarak ikinci bir sorgu yapılmalıdır.

Aşağıdaki hizmet, token kullanımını temsil eder;

iyzico ile öde (PWI) Sorgulama
post

https://api.iyzipay.com
/payment/iyzipos/checkoutform/auth/ecom/detail
PWI işlem sonucunu token ile sorgulanır.

Header parameters
Authorization
string
Authorization header, IYZWSv2 ile başlayan ve imzalı base64 hash değeridir.

Example: IYZWSv2 aXBzaWduYXR1cmU...
Content-Type
string
Example: application/json
Body

application/json

application/json
locale
string · enum
Dil kodu. Varsayılan; tr

Example: tr
Possible values: tren
conversationId
string
İstek/yanıt eşleştirme ID’si.

Example: 8152109759
token
string
Sorgulama yapılacak PWI oturumuna ait token değeri.

Example: da7431f4-89fc-4f65-8533-d83a4fede7d9
Responses
200
Başarılı yanıt (ödeme tamamlandı)

application/json

Response
object
400
Hatalı istek / doğrulama hatası

application/json
post
/payment/iyzipos/checkoutform/auth/ecom/detail

HTTP

HTTP

Copy
POST https://api.iyzipay.com/payment/iyzipos/checkoutform/auth/ecom/detail
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "locale": "tr",
  "conversationId": "8152109759",
  "token": "da7431f4-89fc-4f65-8533-d83a4fede7d9"
}

200
Başarılı yanıt (ödeme tamamlandı)



Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1755252706797,
  "conversationId": "8152109759",
  "price": 10,
  "paidPrice": 10,
  "installment": 1,
  "paymentId": "25152948",
  "fraudStatus": 1,
  "merchantCommissionRate": 0,
  "merchantCommissionRateAmount": 0,
  "iyziCommissionRateAmount": 0.349,
  "iyziCommissionFee": 0.25,
  "cardType": "CREDIT_CARD",
  "cardAssociation": "MASTER_CARD",
  "cardFamily": "Axess",
  "binNumber": "552608",
  "lastFourDigits": "0006",
  "basketId": "basketID",
  "currency": "TRY",
  "itemTransactions": [
    {
      "itemId": "ItemID",
      "paymentTransactionId": "27142369",
      "transactionStatus": 2,
      "price": 10,
      "paidPrice": 10,
      "merchantCommissionRate": 0,
      "merchantCommissionRateAmount": 0,
      "iyziCommissionRateAmount": 0.349,
      "iyziCommissionFee": 0.25,
      "blockageRate": 0,
      "blockageRateAmountMerchant": 0,
      "blockageRateAmountSubMerchant": 0,
      "blockageResolvedDate": "2025-08-23 00:00:00",
      "subMerchantPrice": 0,
      "subMerchantPayoutRate": 0,
      "subMerchantPayoutAmount": 0,
      "merchantPayoutAmount": 9.401,
      "convertedPayout": {
        "paidPrice": 10,
        "iyziCommissionRateAmount": 0.349,
        "iyziCommissionFee": 0.25,
        "blockageRateAmountMerchant": 0,
        "blockageRateAmountSubMerchant": 0,
        "subMerchantPayoutAmount": 0,
        "merchantPayoutAmount": 9.401,
        "iyziConversionRate": 0,
        "iyziConversionRateAmount": 0,
        "currency": "TRY"
      }
    }
  ],
  "authCode": "277568",
  "phase": "AUTH",
  "hostReference": "mock00007iyzihostrfn",
  "signature": "57b1be1f094d17da286c748e2b2779e078e550bafe9734d4fd8c092aeee022be",
  "token": "0b7b67d2-fdf0-4c9a-905f-2b0003b1b8c7",
  "callbackUrl": "callbackUrl",
  "paymentStatus": "SUCCESS",
  "memberEmail": "test@gmail.com",
  "memberGsmNumber": "+905555555555"
}



PWI Örnek Entegrasyon
Bu sayfada, hızlı, kolay ve güvenli uygulama açısından örnek istekler, yanıtlar ve en iyi uygulamaları sunarken, PWI'nin entegrasyon adımlarına kapsamlı bir şekilde daha yakından bakacağız.

Ön Gereksinimler
Devam etmeden önce, lütfen aşağıdaki ön koşullara sahip olduğunuzdan emin olunuz.

Sandbox Hesabı

API ve Güvenlik Anahtarı

API çağrılarını yönetmek için bir yazılım aracı; Postman, Insonmina, Github clients

Genel Bakış
Uygulama, birbiri ardına düzenlenen iki POST isteği gerektirir.

Kısacası;

İlk olarak, bir PWI Başlatma POST isteğini göstereceğiz.

Ardından, PWI Sorgulama POST isteği ile tamamlayacağız.

Adımlar
PWI Başlatma

Token + URL

Yönlendirme

PWI Sorgulama

Webhook

Adım 1 - PWI Başlatma
PWI uygulaması, PWI Başlatma POST isteği ile başlar.

Bu adım, PWI ödemesini başlatmak için bir POST isteği göndermeyi içerir. İstek yapısı; locale, conversationId, price, basketId, paymentGroup, callbackUrl, currency, paidPrice, enabledInstallments, buyer details, shipping address, billing address, and basketItems gibi çeşitli parametreler içerir.

Aşağıdaki örnek bir PWI Başlatma isteği sergilenmiştir.


Örnek PWI Başlatma İsteği;


Copy
{
    "locale": "en", //tr
    "conversationId": "conversationID",
    "price": "10.91",
    "basketId": "basketID",
    "paymentGroup": "OTHER",
    "callbackUrl": "YOUR_CALLBACKURL",
    "currency": "TRY",
    "paidPrice": "49.91",
    "enabledInstallments": [
        2,
        3,
        6,
        9,
        12
    ],
    "buyer": {
        "id": "buyerID",
        "name": "buyerName",
        "surname": "buyerSurname",
        "identityNumber": "11111111111",
        "email": "email@email.com",
        "gsmNumber": "+905350000000",
        "registrationAddress": "Burhaniye Mahallesi Atilla Sokak No:7 Üsküdar",
        "city": "Istanbul",
        "country": "Turkey",
        "ip": "85.34.78.112"
    },
    "shippingAddress": {
        "address": "Burhaniye Mahallesi Atilla Sokak No:7 Üsküdar",
        "contactName": "Contact Name",
        "city": "Istanbul",
        "country": "Turkey"
    },
    "billingAddress": {
        "address": "Burhaniye Mahallesi Atilla Sokak No:7 Üsküdar",
        "contactName": "Contact Name",
        "city": "Istanbul",
        "country": "Turkey"
    },
    "basketItems": [
        {
            "id": "ItemID",
            "price": "10.91",
            "name": "product Name",
            "category1": "Category Name",
            "itemType": "PHYSICAL"
        }
    ]
}
Yukarıdaki isteği tetikledikten sonra, çoğunlukla izleyeceğiniz 3 (üç) senaryo vardır. Yanıt payWithIyzicoPageUrl adlı bir değişken içerir.

Örnek PWI Başlatma Yanıtı;


Copy
{
    "status": "success",
    "locale": "en", //tr
    "systemTime": 1619779710035,
    "conversationId": "123456789",
    "token": "a641ab63-0b7b-4a50-bb09-6c7325041acd",
    "tokenExpireTime": 1800,
    "payWithIyzicoPageUrl": "https://sandbox-consumer.iyzico.com/checkout?token=a641ab63-0b7b-4a50-bb09-6c7325041acd&lang=tr"
}
Adım 2 - Token + URL
Burada token ve payWithIyzicoPageUrl, ödeme yolculuğunun geri kalanı için temel düğümlerdir.

Bu adımda, önceki adımda aldığınız yanıttan token ve payWithIyzicoPageUrl'yi çıkarmanız gerekir. Token daha sonra doğrulama için kaydedilmelidir ve kullanıcıyı ödeme sayfasına yönlendirmek için payWithIyzicoPageUrl kullanılır.

token; Satıcıların, ödeme yolculuğunun en sonunda ödemeyle yüzleşmek ve doğrulamak için token parametresini kaydetmesi beklenir.

payWithIyzicoPageUrl; ödeme sayfasının kısaca göründüğü yer. payWithIyzicoPageUrl'ye yönlendirme, son kullanıcılar için ödeme işlemlerini güvenli bir şekilde gerçekleştirmek için bir arayüz sağlar.

Tarayıcıdaki payWithIyzicoPageUrl Arayüz Örneği;

Adım 3 - Yönlendirme
Yönlendirme aşaması, genel olarak PWI Başlatma ve PWI Sorgulama adımlarını birbirine bağlar.

PWI ödeme sayfasında son kullanıcı etkileşimini takip eden iyzico, sayfayı otomatik olarak "callbackUrl" parametresinde verilen adrese yönlendirecektir. Yönlendirme POST'u şunları içerir;

Input Name
Type
Description
status

String

Servis yanıtı sonucu (başarılı / başarısız)

iyziPaymentId

String

Doğrulama başarılı olursa, iyzico bir ödeme kimliği döndürür. Kimlik doğrulama isteğinde ayarlanmalıdır.

merchantId

String

Satıcı kimliğinizin kimliği.

paymentConversationId

Long

Ayarlanırsa, istek ve yanıtla eşleşecek görüşme kimliği.

token

String

Her ödeme formu isteği için oluşturulan benzersiz değer. Bu belirteç, ödeme sonucuna erişmek için kullanılır.

iyziReferenceCode

String

Bildirim için benzersiz bir referans kodu.

iyziEventType

String

İstek türünü gösterir. Beklenen değer: CHECKOUT_FORM_AUTH

mdStatus parametresi sadece 3DS işlemlerinde görünecektir. Lütfen mdStatus ile ilgili daha fazla ayrıntıyı buradan kontrol edin.

Adım 4 - PWI Sorgulama
PWI Sorgulama, PWI zincirinin son adımıdır.

Temel olarak, bir önceki adımda bir ödemeyi henüz kabul ettik. Şimdi bu adımda işlemi yasallaştırma zamanı. Aşağıdaki örnek, örnek bir PWI Sorgulama istek yapısıdır.

Örnek PWI Sorgulama İsteği;


Copy
{
    "locale": "en", //tr
    "conversationId": "YOUR_CONVERSATION_ID",
    "token": "YOUR_TOKEN"
}
Yukarıdaki isteği tetikledikten sonra, çoğunlukla izleyeceğiniz 2 (iki) senaryo vardır. Yanıt PaymentStatus değişkeninde SUCCESS parametresini içerir.

Örnek PWI Sorgulama Yanıtı;


Copy
{
    "status": "success",
    "locale": "en", //tr
    "systemTime": 1,
    "conversationId": "YOUR_CONVERSATION_ID",
    "price": 1,
    "paidPrice": 1,
    "installment": 1,
    "paymentId": "GENERIC_PAYMENT_ID",
    "fraudStatus": 1,
    "merchantCommissionRate": 1,
    "merchantCommissionRateAmount": 1,
    "iyziCommissionRateAmount": 1,
    "iyziCommissionFee": 1,
    "binNumber": "000000",
    "lastFourDigits": "0000",
    "basketId": "basketID",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "ItemID",
            "paymentTransactionId": "GENERIC_PAYMENT_TRANSACTION_ID",
            "transactionStatus": 2,
            "price": 1,
            "paidPrice": 1,
            "merchantCommissionRate": 1,
            "merchantCommissionRateAmount": 1,
            "iyziCommissionRateAmount": 1,
            "iyziCommissionFee": 1,
            "blockageRate": 1,
            "blockageRateAmountMerchant": 1,
            "blockageRateAmountSubMerchant": 1,
            "blockageResolvedDate": "GENERIC_DATE",
            "subMerchantPrice": 1,
            "subMerchantPayoutRate": 1,
            "subMerchantPayoutAmount": 1,
            "merchantPayoutAmount": 1,
            "convertedPayout": {
                "paidPrice": 1,
                "iyziCommissionRateAmount": 1,
                "iyziCommissionFee": 1,
                "blockageRateAmountMerchant": 1,
                "blockageRateAmountSubMerchant": 1,
                "subMerchantPayoutAmount": 1,
                "merchantPayoutAmount": 1,
                "iyziConversionRate": 1,
                "iyziConversionRateAmount": 1,
                "currency": "TRY"
            }
        }
    ],
    "phase": "AUTH",
    "token": "YOUR_TOKEN",
    "callbackUrl": "YOUR_CALLBACK_URL",
    "paymentStatus": "SUCCESS"
}
Adım 5 - Webhook
Webhook, uygulama düzenimizin en önemli konusudur.

Gerçek zamanlı ödeme bildirimleri almak, genel PWI deneyiminden yararlanırken, bildirimlerin güvenilir kaynaklardan gelmesini sağlayarak hassas verilere herhangi bir olası kurcalamayı veya yetkisiz erişimi önler.

Her ödeme olayı, webhook tetikler;

15 saniye içinde gelir.

Sunucunuz 200 yanıtı verene kadar devam eder.

Her 10 dakikada bir tekrarlanır.

En fazla 3 kez tekrarlanır.

Örnek PWI Webhook
Parametre ismi
Tip
Açıklama
iyziEventTime

long

Notification oluşturulma zamanının unix timestamp değeridir.

iyziEventType

string

İstek tipini belirtir. Alabileceği değerler CHECKOUTFORM_AUTH, API_AUTH, THREE_DS_AUTH, BALANCE, BKM_AUTH

iyziReferenceCode

string

İstek için üretilen unique iyzico referans kodu

paymentId

long

İlgili ödemenin paymentId bilgisi

paymentConversationId

string

İlgili ödemenin üye işyeri tarafından gönderilmiş referans numarası

status

string

Ödeme durumu. Alabileceği değerler: SUCCESS, FAILURE, CALLBACK_THREEDS

Yanıt, status değişkeninde success parametresini içerir.

Onaylama
Ödeme işlemlerinin başarılı bir şekilde sonuçlandırılması için bazı değişkenlerin korelasyonu önemli rol oynar;

paymentId

status

price

İsteğe bağlı olarak diğer Eşleştirme parametreleri

PWI Sorgulama yanıtı ve Webhook bildirimi birbirini doğrulamalıdır.

PWI Sorgulama'dan alınan yanıtı ve Webhook bildiriminde alınan verileri çapraz doğrulamak çok önemlidir. İşlemin gerçekliğini ve doğruluğunu sağlamak için ödeme paymentId, status, price ve diğer ilgili parametreleri eşleştiriniz.

PWI Sorgulama yanıtındaki ödeme kimliği, Webhook'tan ödeme kimliğine eşit olmalıdır.

Her iki status parametresi de success olmalıdır.

price parametresi tutarları aynı olmalıdır.

Ve son olarak, Eşleştirme parametreleri de aynı olmalıdır.



Tokenization Entegrasyonu

iyzico tokenization modelinde iyzico ile Öde yöntemiyle entegrasyon gerçekleştirebilirsiniz: 

iyzico ile Öde (Pay with iyzico)


"iyzico ile Öde", kullanıcıların çevrimiçi alışverişlerini hızlı, kolay ve güvenli bir şekilde tamamlamalarını sağlayan bir dijital ödeme yöntemidir. iyzico tarafından sunulan bu hizmet sayesinde kullanıcılar, kart bilgilerini her alışverişte yeniden girmeye gerek kalmadan ödeme işlemini gerçekleştirebilirler. Ayrıca, iyzico'nun sunduğu taksitlendirme gibi ek avantajlardan da faydalanmaya devam edebilirler.

Bu ödeme yöntemi, hem kullanıcılar hem de işletmeler için güvenli bir ödeme altyapısı sunarak alışveriş deneyimini iyileştirmeyi hedefler.

"iyzico ile Öde" ödeme yöntemini başlatarak son kullanıcıyı iyzico hesabına login olması için yönlendirebilirsiniz.

Anahtar Tanımlar

 Member : iyzico ile Öde hizmeti kapsamında, platforma kayıt olan son kullanıcılar "member" olarak adlandırılır. Member'lar, iyzico’nun sunduğu dijital cüzdan ve ödeme çözümlerinden faydalanabilir, güvenli ve hızlı bir şekilde ödeme yapabilirler.


 Ödeme Tipi : Tokenization kapsamında kullanılabilecek iki ödeme tipi bulunmaktadır: Bakiye ve Kart ödemesi.

Bakiye Ödemesi: Kullanıcının iyzico cüzdanında bulunan mevcut bakiyesi ile gerçekleştirdiği ödemelerdir.

Kart Ödemesi: Kullanıcının daha önce kaydettiği veya yeni eklediği kredi/banka kartı ile gerçekleştirdiği ödemelerdir.


Session: Member'ın üye işyerimiz aracılığıyla aynı ödeme tipinde yaptığı ve yapacağı ödeme sürecini ifade eder. Session, unique bir değer olan session token ile ifade edilir.

Entegrasyon Öncesi Hazırlıklar
Üye işyerimizin bu servisi kullanabilmesi için IP adresilerini iyzico'ya whitelist ettirmesi gerekmektedir.

Üye işyerimizin bu servisi kullanabilmesi için hesap ayarlarının düzenlenmesi gerekmektedir.

Entegrasyon Adımları
Servislere iletilecek istekler iyzico kimlik doğrulama yapısı ile iletilmelidir. 

Üye işyeri, member'ın session'ını başlatmak için "iyzico ile Öde (PWI)" servisleri kullanılır. iyzico ile Öde (PWI) ile gerçekleşen başarılı ödemeye istinaden session bilgisi oluşur.

iyzico ile Öde (PWI) ile gerçekleştirilen ödemeye ait oluşan session ve member bilgileri için "Ödeme ve Session Sorgulama" servisi kullanılmaktadır. Session token ve member identifier üye iş yerimiz tarafından saklanmalıdır. Bu değerler access token almak ve ödeme geçirmek için ileride gerekli olacaktır. Oluşturulan sessionToken sınırlı bir süre ile oluşturulur. Bu süre üye iş yerlerine göre değişiklik gösterebilir. 

Session token ve member bilgisi ile accessToken alabilmek için "Access Token Alma" servisi kullanılır. Kullanıcın son ödeme bilgisini almak ve tokenize edilmiş bilgiler ile ödeme alabilmesi için accessToken alınmalıdır. accessToken kısa süreli bir token'dır. 

Session token ve member bilgisi ile member'a ait son ödeme bilgisini alabilmek için "Son Ödeme Bilgisi Alma" servisi kullanılır. accessToken bu aşamada gerekli olan bilgidir.

Üye iş yerinin tokenize edilen son ödeme yöntemini kontrol ederek ödeme alabilmesi için "Single API" üzerinden ödeme yöntemini seçerek ödeme isteğini iletmesi gerekir. 

Her iyzico ile Öde oluşturma işlemi, mevcut session'ı sonlandırarak yeni bir session başlatır. Session süresince ödeme yöntemi değiştirilemez; ödeme yöntemi değiştirebilmek için iyzico ile Öde oluşturulmak zorundadır. Bu işlem, yeni bir session oluşturur ve ödeme süreci bu yeni session üzerinden devam eder.

Örnek Uygulama
Kimlik Doğrulama
Detayları için kimlik doğrulama sayfasını ziyaret edebilirsiniz.

iyzico ile Öde (PWI) Ödemesi ve Session Oluşturma
Aşağıda örnek olarak iyzico ile Öde (PWI) üzerinden yapılan initialize işlemi için request ve response verisi paylaşılmıştır. Member'ın ödeme işlemi gerçekleştirebilmesi için ve session bilgisi oluşabilmesi için iyzico ile Öde (PWI) servisi initialize edilmelidir.

Örnek İstek

Copy
{
    "paidPrice": 1.0,
    "locale": "tr",
    "enabledInstallments": [ 
        1,
        2,
        3,
        6,
        9,
        12
    ],
    "price": 1.0,
    "conversationId": "2224",
    "paymentGroup": "PRODUCT",
    "callbackUrl": "https://merchant-callback.com",
    "currency": "TRY",
    "basketId": "B67832",
    "buyer": {
        "id": "BY789",
        "name": "John",
        "surname": "Doe",
        "identityNumber": "74300864711",
        "email": "sandboxtest0@gmail.com",
        "gsmNumber": "+9055555555",
        "registrationAddress": "Adres",
        "city": "Istanbul",
        "country": "Turkey",
        "ip": "buyer Ip",
        "zipCode": "34580"
    },
    "shippingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "billingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "basketItems": [
        {
            "id": "BI101",
            "price": 1.0,
            "name": "Binocular",
            "category1": "Collectibles",
            "itemType": "PHYSICAL"
        }
    ]
}
Örnek Response

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749027773192,
    "conversationId": "2224",
    "token": "d9d9fc30-8178-4ca9-8f93-1b150f465da6",
    "signature": "a53e433a982bc9f927aed4e0383d083bd48de9cff343490ba7477f9964cfbfb1",
    "payWithIyzicoPageUrl": "https://sandbox-ode.iyzico.com/sdk?token=d9d9fc30-8178-4ca9-8f93-1b150f465da6&lang=tr",
    "tokenExpireTime": 600,
    "tokenExpireDate": 1749028373178
}
Ödeme ve Session Sorgulama Servisi
Member'ın session kapsamında yaptığı ödemelerin detayını ve session bilgilerini döner. 

Örnek İstek

Copy
{
    "checkoutFormToken": "{{checkoutToken}}",
    "locale": "tr",
    "conversationId": "conversationId"
}
Örnek Yanıt

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749032413350,
    "conversationId": "conversationId",
    "token": "e54b957b-a153-410c-8761-79c9bd4ff44f",
    "callbackUrl": "https://merchant-callback.com",
    "paymentStatus": "SUCCESS",
    "price": 1.00000000,
    "paidPrice": 1.00000000,
    "installment": 1,
    "paymentId": "24259238",
    "memberEmail": "sandboxtest@gmail.com",
    "memberGsmNumber": "+905555555555",
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0E-8,
    "iyziCommissionRateAmount": 0.01750000,
    "iyziCommissionFee": 0E-8,
    "cardType": "CREDIT_CARD",
    "cardAssociation": "MASTER_CARD",
    "cardFamily": "Advantage",
    "binNumber": "550472",
    "lastFourDigits": "0003",
    "basketId": "B67832",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "26268394",
            "transactionStatus": 2,
            "price": 1.00000000,
            "paidPrice": 1.00000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.01750000,
            "iyziCommissionFee": 0E-8,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0E-8,
            "blockageResolvedDate": "2025-06-05 00:00:00",
            "subMerchantPrice": 0E-8,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0E-8,
            "merchantPayoutAmount": 0.98250000,
            "convertedPayout": {
                "paidPrice": 1.00000000,
                "iyziCommissionRateAmount": 0.01750000,
                "iyziCommissionFee": 0E-8,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 0.98250000,
                "iyziConversionRate": 0E-8,
                "iyziConversionRateAmount": 0E-8,
                "currency": "TRY"
            }
        }
    ],
    "authCode": "054626",
    "phase": "AUTH",
    "hostReference": "mock00034iyzihostrfn",
    "signature": "a77fac0a954181b9816bac2d0ba55047d2bfb1934d8efaa6de39b93b91bc9d6c",
    "sessionInfo": {
        "sessionToken": "f403ef2f-fb08-4111-afd6-495811ef6b25",
        "sessionStatus": "ACTIVE",
        "memberIdentifier": "f1409923-57cb-468f-8df2-704ea02075e3",
        "paymentType": "CARD_PAYMENT"
    }
}
Access Token Alma Servisi
Ödeme tetiklenebilmesi ve son ödeme bilgilerinin alınabilmesi için gerekli accessToken bilgisi bu servis ile sorgulanır.

Örnek İstek

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "locale": "tr",
    "conversationId": "test"
}
Örnek Yanıt

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749027862133,
    "conversationId": "test",
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiItIiwic2NvcGUiOlsidGhpcmRQYXJ0eVNlc3Npb24iXSwic2Vzc2lvblRva2VuIjoiZDUzZWRiNzItNTNmMy00NmY0LTk5NWQtNDM1NzBhOTdiZDg4IiwiZXhwIjoxNzQ5MDI4MjIyLCJhdXRob3JpdGllcyI6WyJwd2lfdHBfc2Vzc2lvbl9jYXJkX2F1dGgiLCJwd2lfdHBfc2Vzc2lvbl9pbml0M2RzX2F1dGgiLCJwd2lfdHBfc2Vzc2lvbl9sYXN0X3BheW1lbnRfcmV0cmlldmUiLCJwd2lfdHBfc2Vzc2lvbl9mdW5kX2F1dGgiXSwianRpIjoiMTUwODdmNTgtZGE4Yy00OTFhLWFjN2QtYmYyODI2ODNmMGRlIiwiY2xpZW50X2lkIjoidGhpcmRQYXJ0eVNlc3Npb25DbGllbnQifQ.YC5McE1SdXrPeCpljrMU1X3kzc3FV7I8DoZ5G0qcS30"
}
 Son Ödeme ve Session Detayını Sorgulama Servisi
Member'a ait son ödeme bilgisinin detaylarının dönüldüğü servistir. Access Token Alma servisinden elde edilen accessToken ile gelinmelidir.

Örnek Sorgulama İsteği

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "locale": "tr",
    "conversationId": "conversationId"
}
Örnek Sorgulama Yanıtı

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749032543970,
    "conversationId": "conversationId",
    "card": {
        "cardHolderName": "John Doe",
        "cardAssociation": "MASTER_CARD",
        "cardFamily": "Advantage",
        "binNumber": "55047200",
        "lastFourDigits": "0003",
        "cardBankName": "HSBC",
        "cardType": "CREDIT_CARD",
        "expireMonth": "05",
        "expireYear": "2026",
        "expired": false,
        "willExpireSoon": false
    },
    "paymentType": "CARD_PAYMENT",
    "sessionToken": "f403ef2f-fb08-4111-afd6-495811ef6b25",
    "token": "e54b957b-a153-410c-8761-79c9bd4ff44f",
    "paymentId": 24259238
}
Ödeme Tipleri
Dönebilecek Ödeme Tipleri
Parametre
Açıklama
Gönderilebilecek Ödeme Tipleri
Son ödeme bakiye ile yapıldığında, paymentType "FUND" dönmektedir.

FUND

Bakiye ile Ödeme Yapıldığı Anlamına Gelir.

 Bu durumda sonraki ödeme isteğinde paymentType "FUND" gönderilmelidir.

Son ödeme Kart ile yapıldığında, paymentType "CARD_PAYMENT"  olarak dönmektedir.

CARD_PAYMENT

Kart ile ödeme yapıldığı anlamına gelir.

 2D İşlem için, "NON3D" olarak gönderilmelidir. 
3DS İşlem için, "3DS" gönderilmelidir.

Ödeme Servisi
Kullanılan son ödeme tipine göre, ödeme gerçekleştirilmesi için kullanılmaktadır. Örnek uygulamada paymentType "CARD_PAYMENT" olarak döndüğü için, kart ödemesi örneği paylaşılmaktadır.

Örnek İstek

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "conversationId": "conversationId",
    "locale": "tr",
    "paymentType": "3DS",
    "paidPrice": 1.0,
    "price": 1.0,
    "callbackUrl": "callbackUrl",
    "paymentGroup": "PRODUCT",
    "currency": "TRY",
    "basketId": "B67832",
    "buyer": {
        "id": "BY789",
        "name": "John",
        "surname": "Doe",
        "identityNumber": "74300864111",
        "email": "sandboxtest@gmail.com",
        "gsmNumber": "+905555555555",
        "registrationAddress": "Adres",
        "city": "Istanbul",
        "country": "Turkey",
        "ip": "buyer Ip",
        "zipCode": "34580"
    },
    "shippingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "billingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "basketItems": [
        {
            "id": "BI101",
            "price": 1.0,
            "name": "Binocular",
            "category1": "Collectibles",
            "itemType": "PHYSICAL"
        }
    ]
}
Örnek Yanıt

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749027890082,
    "conversationId": "conversationId",
    "sessionToken": "d53edb72-53f3-46f4-995d-43570a97bd88",
    "paymentId": 24258864,
    "threeDSHtmlContent": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8dGl0bGU+aXl6aWNvIE1vY2sgM0QtU2VjdXJlIFByb2Nlc3NpbmcgUGFnZTwvdGl0bGU+CjwvaGVhZD4KPGJvZHk+Cjxmb3JtIGlkPSJpeXppY28tM2RzLWZvcm0iIGFjdGlvbj0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L21vY2svaW5pdDNkcyIgbWV0aG9kPSJwb3N0Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9Im9yZGVySWQiIHZhbHVlPSJtb2NrNDYtODc2NzgxNDM2MDk1ODAxMGl5emlvcmQiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYmluIiB2YWx1ZT0iNTg5MDA0Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN1Y2Nlc3NVcmwiIHZhbHVlPSJodHRwczovL3NhbmRib3gtYXBpLml5emlwYXkuY29tL3BheW1lbnQvaXl6aXBvcy9jaGVja291dGZvcm0vY2FsbGJhY2szZHMvc3VjY2Vzcy8yNyI+CiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJmYWlsdXJlVXJsIiB2YWx1ZT0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L2l5emlwb3MvY2hlY2tvdXRmb3JtL2NhbGxiYWNrM2RzL2ZhaWx1cmUvMjciPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iY29uZmlybWF0aW9uVXJsIiB2YWx1ZT0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L21vY2svY29uZmlybTNkcyI+CiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJQYVJlcSIgdmFsdWU9IjE4ZThlZGVhLTY2ZjgtNDg4NS05OTNkLWIyYTQ5MzFlNTY0MCI+CjwvZm9ybT4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIml5emljby0zZHMtZm9ybSIpLnN1Ym1pdCgpOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+",
    "checkoutToken": "1479d5ba-d52d-4fae-8f1c-9d9c75991f2a",
    "signature": "40c72c0d631861c7f1454baffc8f141e7947699dbe22c14ca40f75bdf775fae6"
}
paymentType alanı 3DS olarak gönderilen ve 3DS gerçekleşmesi gereken işlemlerde, response içerisinde threeDSHtmlContent alanı yer alır. Bu alan, 3D Secure doğrulama adımını başlatmak için gerekli olan HTML içeriğini base64 encode edilmiş şekilde sunar.

Doğrulama sürecinin doğru bir şekilde ilerleyebilmesi için:

threeDSHtmlContent verisi base64 formatında decode edilmelidir.

Decode edilen HTML içeriği, bir web sayfasında (örneğin iframe ya da direkt HTML olarak) kullanıcıya gösterilmelidir.

Bu adım, kullanıcıyı bankanın 3DS doğrulama ekranına yönlendirmek için zorunludur.

paymentType alanında gönderilen değer, NON3D olsa dahi iyzico dinamik 3DS yapısı gereği o işlem 3DS olarak geçmesi gerekiyorsa, dönen response şemasında threeDSHtmlContent verisi dönebilir.

Webhook
Tokenization cüzdan ödemeleri sonrasında iyzico tarafından üye işyerinin webhookUrl adresine gidecek bildirimlerde yer alacak eventType parametresi ödeme tipine göre değişmekte olup, aşağıdaki değerleri alacaktır. Gönderilen webhook bildirimleri, bu parametreler üzerinden ayrıştırılabilir. 
Detayları için webhook sayfamızı ziyaret edebilirsiniz.

Ödeme Tipi
Parametre
Açıklama
FUND

iyziEventType

İstek tipini belirtir. Alabileceği değerler: 

PWI_TKN_FUND

NON3D

iyziEventType

PWI_TKN_AUTH

3DS

iyziEventType

PWI_TKN_THREEDS_AUTH

Last updated 7 months ago



iyzico ile Öde (PWI)
iyzico ile Öde (Pay With Iyzico) yöntemi, son kullanıcıyı iyzico tarafından sunulan iyzico cüzdan hesabına yönlendirerek işlemi tamamlamanızı sağlar.

Bu yöntem, hızlıca entegrasyon yapmak isteyen ve kullanıcı arayüzünü iyzico’ya bırakmak isteyen iş ortakları için idealdir. API-API Pay With iyzico kullanımı için bu servis kullanılmalıdır.

iyzico ile Öde Başlatma
POST https://api.iyzipay.com/v1/pay-with-iyzico/third-party-session/pwi/init

Headers

Name
Value
Content-Type

application/json

Authorization

Authorization

İstek Parametreleri
Parametre
Tip
Zorunluluk
Açıklama
paidPrice

Decimal

Evet

Tahsil edilecek nihai tutar.

enabledInstallments

Integer

Hayır

Taksit bilgisi, tek çekim için 1 gönderilmelidir. Geçerli değerler: 1, 2, 3, 6, 9, 12

locale

String

Hayır

iyzico istek sonucunda dönen metinlerin dilini ayarlamak için kullanılır. Varsayılan değeri tr’dir.

price

Decimal

Evet

Ödeme sepet tutarı. Kırılım tutarlar toplamı, sepet tutarına eşit olmalı.

conversationId

String

Hayır

İstek esnasında gönderip, sonuçta alabileceğiniz bir değer, request/response eşleşmesi yapmak için kullanılabilir.

paymentGroup

String

Hayır

Ödeme grubu, varsayılan PRODUCT. Geçerli değerler enum içinde sunulmaktadır: PRODUCT, LISTING, SUBSCRIPTION

callbackUrl

String

Evet

Ödeme akışında üye işyerine başarılı ve hatalı sonucu bildirmek üzere alınan URL adresi. Geçerli bir ssl sertifikasına sahip olmalıdır.

currency

String

Evet

Para birimi. Default değeri TRY’dir. Kullanılabilen diğer değerler ise USD, EUR, GBP’dir.

basketId

String

Hayır

Üye işyeri sepet id’si.

buyerId

String

Evet

Üye işyeri tarafındaki alıcıya ait id bilgisi.

buyerName

String

Evet

Üye işyeri tarafındaki alıcıya ait ad.

buyerSurname

String

Evet

Üye işyeri tarafındaki alıcıya ait soyadı.

identityNumber

String

Evet

Alıcıya ait TCKN bilgisi.

email

String

Evet

Üye işyeri tarafındaki alıcıya ait e-posta bilgisi. E-posta adresi alıcıya ait geçerli ve erişilebilir bir adres olmalıdır.

gsmNumber

String

Hayır

Üye işyeri tarafındaki alıcıya ait GSM numarası.

registrationAddress

String

Evet

Üye işyeri tarafındaki alıcıya ait kayıt adresi.

city

String

Evet

Üye işyeri tarafındaki alıcıya ait şehir bilgisi.

country

String

Evet

Üye işyeri tarafındaki alıcıya ait ülke bilgisi.

IP

String

Hayır

Üye işyeri tarafındaki alıcıya ait IP adresi.

zipCode

String

Evet

Üye işyeri tarafındaki alıcıya ait posta kodu.

address(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

contactName(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi ad soyad bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

city(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi şehir bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

country(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi ülke bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

zipCode(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi posta kodu.

address(billingAddress)

String

Evet

Alıcıya ait fatura adres bilgisi.

contactName(billingAddress)

String

Evet

Alıcıya ait fatura ad soyad bilgisi.

city(billingAddress)

String

Evet

Alıcıya ait fatura şehir bilgisi.

country(billingAddress)

String

Evet

Alıcıya ait fatura ülke bilgisi.

basketItemId

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait id. Not: Bir ödeme isteğine maksimum 500 basketItem eklenebilir.

basketItemPrice

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait tutar. 0 ve 0’dan küçük olamaz, tutarlar toplamı sepet tutarına (price) eşit olmalıdır.

basketItemName

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait ismi.

basketItemCategory1

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait 1. kategori.

basketItemCategory2

String

Hayır

Üye işyeri tarafındaki sepetteki ürüne ait 2. kategori.

basketItemItemType

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait tip. Geçerli enum değerler: PHYSICAL ve VIRTUAL

PWI Başlatma Örnek İsteği

Copy
{
    "paidPrice": 1.0,
    "locale": "tr",
    "enabledInstallments": [ 
        1,
        2,
        3,
        6,
        9,
        12
    ],
    "price": 1.0,
    "conversationId": "2224",
    "paymentGroup": "PRODUCT",
    "callbackUrl": "https://merchant-callback.com",
    "currency": "TRY",
    "basketId": "B67832",
    "buyer": {
        "id": "BY789",
        "name": "John",
        "surname": "Doe",
        "identityNumber": "74300864711",
        "email": "sandboxtest0@gmail.com",
        "gsmNumber": "+9055555555",
        "registrationAddress": "Adres",
        "city": "Istanbul",
        "country": "Turkey",
        "ip": "buyer Ip",
        "zipCode": "34580"
    },
    "shippingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "billingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "basketItems": [
        {
            "id": "BI101",
            "price": 1.0,
            "name": "Binocular",
            "category1": "Collectibles",
            "itemType": "PHYSICAL"
        }
    ]
}
Örnek Yanıt
200
422

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749027773192,
    "conversationId": "2224",
    "token": "d9d9fc30-8178-4ca9-8f93-1b150f465da6",
    "signature": "a53e433a982bc9f927aed4e0383d083bd48de9cff343490ba7477f9964cfbfb1",
    "payWithIyzicoPageUrl": "https://sandbox-ode.iyzico.com/sdk?token=d9d9fc30-8178-4ca9-8f93-1b150f465da6&lang=tr",
    "tokenExpireTime": 600,
    "tokenExpireDate": 1749028373178
}
Yanıtta Dönebilecek Parametreler
Parametre Adı
Tip
Açıklama
status

String

İstek sonucunu ifade eder. success yada failure değerleri dönebilmektedir.

locale

String

Dönen yanıtın dilini ifade eder.

systemTime

Long

Dönen sonucun o anki unix timestamp değeridir.

conversationId

String

İstek esnasında gönderilen değer dönmektedir.

token

String

Her ödeme formu isteği için oluşturulan unique değerdir.

payWithIyzicoPageUrl

String

Son kullanıcının yönlendireleceği pay with iyzico sayfa urlidir.

tokenExpireTime

Long

Token'ın sona erme süresidir.

tokenExpireDate

Long

Epoch zaman diliminde token'ın expire olacağı tarih bilgisi.

errorCode

String

İşlem hatalıysa, bu hataya dair belirtilen koddur.

errorMessage

String

İşlem hatalıysa, bu hataya dair detay belirtilen mesajdır, locale parametresine göre dil desteği sunar.



Ödeme ve Session Sorgulama
Member'ın session kapsamında yaptığı ödemelerin detayını döner. iyzico ile Öde (PWI) ile session başlatan ödeme bu kapsamdadır.

Ödeme ve Session Sorgulama
POST https://api.iyzipay.com/v1/pay-with-iyzico/third-party-session/retrieve/payment

Headers
Name
Value
Content-Type

application/json

Authorization

Authorization

İstek Parametreleri
Paremetre
Tip
Zorunluluk
Açıklama
checkoutFormToken

string

Evet

Yapılan işleme ait token değeri.

locale

string

Hayır

İstek için gönderilen dil değeri. EN ve TR değerini alabilir.

conversationId

string

Hayır

İstek esnasında gönderip, sonuçta alabileceğiniz bir değer, request/response eşleşmesi yapmak için kullanılabilir.

Örnek İstek

Copy
{
    "checkoutFormToken": "{{checkoutToken}}",
    "locale": "tr",
    "conversationId": "conversationId"
}
Örnek Yanıt
200
400

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749032413350,
    "conversationId": "conversationId",
    "token": "e54b957b-a153-410c-8761-79c9bd4ff44f",
    "callbackUrl": "https://merchant-callback.com",
    "paymentStatus": "SUCCESS",
    "price": 1.00000000,
    "paidPrice": 1.00000000,
    "installment": 1,
    "paymentId": "24259238",
    "memberEmail": "sandboxtest@gmail.com",
    "memberGsmNumber": "+905555555555",
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0E-8,
    "iyziCommissionRateAmount": 0.01750000,
    "iyziCommissionFee": 0E-8,
    "cardType": "CREDIT_CARD",
    "cardAssociation": "MASTER_CARD",
    "cardFamily": "Advantage",
    "binNumber": "550472",
    "lastFourDigits": "0003",
    "basketId": "B67832",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "26268394",
            "transactionStatus": 2,
            "price": 1.00000000,
            "paidPrice": 1.00000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.01750000,
            "iyziCommissionFee": 0E-8,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0E-8,
            "blockageResolvedDate": "2025-06-05 00:00:00",
            "subMerchantPrice": 0E-8,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0E-8,
            "merchantPayoutAmount": 0.98250000,
            "convertedPayout": {
                "paidPrice": 1.00000000,
                "iyziCommissionRateAmount": 0.01750000,
                "iyziCommissionFee": 0E-8,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 0.98250000,
                "iyziConversionRate": 0E-8,
                "iyziConversionRateAmount": 0E-8,
                "currency": "TRY"
            }
        }
    ],
    "authCode": "054626",
    "phase": "AUTH",
    "hostReference": "mock00034iyzihostrfn",
    "signature": "a77fac0a954181b9816bac2d0ba55047d2bfb1934d8efaa6de39b93b91bc9d6c",
    "sessionInfo": {
        "sessionToken": "f403ef2f-fb08-4111-afd6-495811ef6b25",
        "sessionStatus": "ACTIVE",
        "memberIdentifier": "f1409923-57cb-468f-8df2-704ea02075e3",
        "paymentType": "CARD_PAYMENT"
    }
}
Yanıt Parametreleri
Parametre İsmi
Tip
Açıklama
status

String

Yapılan isteğin sonucunu bildirir. Başarılı ise success, hatalı ise failure döner.

locale

String

İstekte belirtilen locale değeri geri dönülür, varsayılan değeri tr’dir.

systemTime

Long

Dönen sonucun o anki unix timestamp değeridir.

conversationId

String

İstek esnasında gönderilmişse, sonuçta aynen geri iletilir.

token

String

Checkout form için oluşturulan tekil değer. Her istek için özel üretilir ve işyerine dönülür. Ödemenin sonucunu öğrenmek için zorunlu bir alandır.

paymentStatus

String

Ödeme isteğinin durumunu gösterir. Success ise karttan ilgili tutar çekilmiştir. SUCCESS, FAILURE 

memberEmail

String

İşlem yapan member'ın email bilgisi

memberGsmNumber

String

İşlem yapan member'ın gsm number bilgisi

price

Decimal

Ödeme sepet tutarı. Kırılım tutarlar toplamı sepet tutarına eşit olmalı.

paidPrice

Decimal

İndirim vade farkı vs. hesaplanmış POS’tan geçen, tahsil edilen, nihai tutar.

installment

Integer

Ödemenin taksit bilgisi, tek çekim için 1 döner. Geçerli değerler: 1, 2, 3, 6, 9, 12

paymentId

String

Ödemeye ait id, üye işyeri tarafından mutlaka saklanmalıdır. Ödemenin iptali ve iyzico ile iletişimde kullanılır.

merchantCommissionRate

Decimal

Üye işyerinin uyguladığı vade/komisyon oranı. Örneğin price=100, paidPrice=110 ise üye işyeri vade/komisyon oranı %10’dur. Bilgi amaçlıdır.

merchantCommissionRateAmount

Decimal

Üye işyerinin uyguladığı vade/komisyon tutarı. Örneğin price=100, paidPrice=110 ise üye işyeri vade/komisyon tutarı 10’dur. Bilgi amaçlıdır.

iyziCommissionRateAmount

Decimal

Ödemeye ait iyzico işlem komisyon tutarı.

iyziCommissionFee

Decimal

Ödemeye ait iyzico işlem ücreti .

basketId

String

Üye işyeri tarafından gönderilen sepet id’si.

errorCode

String

İşlem hatalıysa, bu hataya dair belirtilen koddur.

errorMessage

String

İşlem hatalıysa, bu hataya dair belirtilen mesajdır, locale parametresine göre dil desteği sunar.

errorGroup

String

İşlem hatalıysa, bu hataya dair belirtilen gruptur.

currency

String

Ödemenin alındığı para birimi.

itemId (ItemTransactions)

String

Üye işyeri tarafından iletilen, sepetteki ürüne ait id.

transactionStatus (ItemTransactions)

Integer

Ödeme kırılımının durumu. Ödeme fraud kontrolünde ise 0 değeri döner, bu durumda fraudStatus değeri de 0’dır. Ödeme, fraud kontrolünden sonra reddedilirse -1 döner. Pazaryeri modelinde ürüne onay verilene dek bu değer 1 olarak döner. Pazaryeri modelinde ürüne onay verilmişse bu değer 2 olur. Geçerli değerler: 0, -1, 1, 2.

paymentTransactionId (ItemTransactions)

String

Ödeme kırılımına ait id, üye işyeri tarafından mutlaka saklanmalıdır. Ödeme kırılımının iadesi, onayı, onay geri çekmesi ve iyzico ile iletişimde kullanılır. Tercihen itemId ile ilişkili bir şekilde tutulmalıdır.

price (ItemTransactions)

Decimal

Üye işyeri tarafındaki sepetteki ürüne ait tutar.

paidPrice (ItemTransactions)

Decimal

Tahsilat tutarının kırılım bazındaki dağılımı. Üye işyeri tarafından mutlaka saklanmalıdır.

merchantCommissionRate (ItemTransactions)

Decimal

Üye işyerinin uyguladığı vade/komisyon oranının kırılım bazında dağılmış oranı.

merchantCommissionRateAmount (ItemTransactions)

Decimal

Üye işyerinin uyguladığı vade/komisyon tutarıın, kırılım bazında dağılmış tutarı.

iyziCommissionRateAmount (ItemTransactions)

Decimal

iyzico işlem komisyon tutarının kırılım bazında dağılmış tutarı.

iyziCommissionFee (ItemTransactions)

Decimal

iyzico işlem ücretinin kırılım bazında dağılmış tutarı.

blockageRate (ItemTransactions)

Decimal

Kırılım bazında üye işyeri blokaj oranı. iyzico – üye işyeri anlaşmasına göre, üye işyerine işlem bazında blokaj uygulayabilir. Bu blokaj üye işyeri fraud riskini önlemek içindir, blokaj süresi boyunca para iyzico’da tutulur, bu süre sonrasında üye işyerine gönderilir.

blockageRateAmountMerchant (ItemTransactions)

Decimal

Kırılım bazında üye işyeri blokaj tutarının, üye işyerine yansıyan rakamı. Blokaj tutarı mümkün olduğunca üye işyerine yansıtılır. Eğer blokaj tutarı, üye işyeri tutarından daha büyükse bu durumda alt üye işyerine de yansıtılır.

blockageResolvedDate (ItemTransactions)

String

İşlem bazında blokaj çözülme tarihi. yyyy-MM-dd HH:mm:ss formatındadır, örneğin 2015-10-19 14:36:52.

merchantPayoutAmount (ItemTransactions)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

paidPrice(convertedPayout)

Decimal

Tahsilat tutarının kırılım bazındaki dağılımı. Üye işyeri tarafından mutlaka saklanmalıdır.

iyziCommissionRateAmount (convertedPayout)

Decimal

iyzico işlem komisyon tutarının kırılım bazında dağılmış tutarı.

iyziCommissionFee (convertedPayout)

Decimal

iyzico işlem ücretinin kırılım bazında dağılmış tutarı.

blockageRateAmountMerchant (convertedPayout)

Decimal

Kırılım bazında üye işyeri blokaj tutarının, üye işyerine yansıyan rakamı. Blokaj tutarı mümkün olduğunca üye işyerine yansıtılır. Eğer blokaj tutarı, üye işyeri tutarından daha büyükse bu durumda alt üye işyerine de yansıtılır.

merchantPayoutAmount (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

iyziConversationRate (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

iyziConversationRateAmount (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

currency (convertedPayout)

String

Ödemenin alındığı para birimi.

mdStatus

String

Bankadan dönen değerdir. Sadece ödeme başarısız ise ve işlem 3ds ile yapılmışsa bu değer döner. 0,2,3,4,5,6,7 değerlerini alabilir.
3D İşlemi Başarılı ise 1 değerini alır.

authCode

String

iyzico tarafından üretilen uniq değer.

phase

String

Ödeme fazı bilgisi. AUTH değerini alır.

signature

String

İmza doğrulaması için kullanılabilecek signature değeridir.

cardType

String

Sadece kartlı ödemelerde döner. Eğer ödeme yapılan kart yerel bir kart ise, kart tipi bilgisini döner. DEBIT_CARD ve CREDIT_CARD değerlerini alır.

cardAssociation

String

Sadece kartlı ödemelerde döner. 
Eğer ödeme yapılan kart yerel bir kart ise, kartın ait olduğu kuruluş. Geçerli değerler: VISA, MASTER_CARD, AMERICAN_EXPRESS, TROY

cardFamily

String

Sadece kartlı ödemelerde döner. 
Eğer ödeme yapılan kart yerel bir kart ise, kartın ait olduğu aile. Geçerli değerler: Bonus, Axess, World, Maximum, Paraf, CardFinans, Advantage

binNumber

String

Ödeme yapılan kartın ilk 6 hanesi.

lastFourDigits

String

Ödeme yapılan kartın son 4 hanesi.

sessionToken(sessionInfo)

String

Member'ın aynı ödeme tipinde yaptığı ödeme işlemine ait session key bilgisidir.

sessionStatus(sessionInfo)

String

Kullanıcıya ait session durumudur. ACTIVE veya PASSIVE değerlerini alır.

memberIdentifier(sessionInfo)

String

Member unique key bilgisidir. Bu key, ödeme işlemlerinde member bilgisi için kullanılır.

paymentType(sessionInfo)

String

Ödeme tipini belirtir. FUND veya CARD_PAYMENT değerlerini dönebilir.
FUND: Bakiye Ödemesi
CARD_PAYMENT: Kart Ödemesi

callbackUrl

String

İstekte belirtilen ve işlem sonucunda yönlendirilen URL adres bilgisidir.

Last updated 8 months ago



Access Token Alma
Tokenization ödeme tetiklenebilmesi ve son ödeme bilgilerinin alınabilmesi için accessToken ihtiyaç bulunmaktadır. Bu servise yapılacak sorgu ile accessToken bilgisine ulaşılmaktadır.

Oluşturulan accessToken'ın 5 dakikalık süresi bulunmaktadır. Bu süre aşıldığı taktirde yeni token oluşturulmalıdır.

Access Token Alma
POST https://api.iyzipay.com/v1/pay-with-iyzico/third-party-session/retrieve/access-token

Headers

Name
Value
Content-Type

application/json

Authorization

Authorization

İstek Parametreleri
Parametre
Tip
Açıklama
sessionToken

String

Member'ın aynı ödeme tipinde ödeme yaptığı session key bilgisidir.

memberIdentifier

String

Member unique key bilgisidir. Bu key, ödeme işlemlerinde member bilgisi için kullanılır.

locale

String

iyzico istek sonucunda dönen metinlerin dilini ayarlamak için kullanılır. Varsayılan değeri tr’dir. en olarak kullanılabilir.

conversationId

String

İstek esnasında gönderip, sonuçta alabileceğiniz bir değer, request/response eşleşmesi yapmak için kullanılabilir. En yaygın kullanış biçimi üye iş yerinin sipariş numarasıdır.

Örnek İstek

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "locale": "tr",
    "conversationId": "test"
}
Örnek Yanıt
200
400

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749027862133,
    "conversationId": "test",
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiItIiwic2NvcGUiOlsidGhpcmRQYXJ0eVNlc3Npb24iXSwic2Vzc2lvblRva2VuIjoiZDUzZWRiNzItNTNmMy00NmY0LTk5NWQtNDM1NzBhOTdiZDg4IiwiZXhwIjoxNzQ5MDI4MjIyLCJhdXRob3JpdGllcyI6WyJwd2lfdHBfc2Vzc2lvbl9jYXJkX2F1dGgiLCJwd2lfdHBfc2Vzc2lvbl9pbml0M2RzX2F1dGgiLCJwd2lfdHBfc2Vzc2lvbl9sYXN0X3BheW1lbnRfcmV0cmlldmUiLCJwd2lfdHBfc2Vzc2lvbl9mdW5kX2F1dGgiXSwianRpIjoiMTUwODdmNTgtZGE4Yy00OTFhLWFjN2QtYmYyODI2ODNmMGRlIiwiY2xpZW50X2lkIjoidGhpcmRQYXJ0eVNlc3Npb25DbGllbnQifQ.YC5McE1SdXrPeCpljrMU1X3kzc3FV7I8DoZ5G0qcS30"
}
Yanıt Parametreleri
status

String

İstek sonucunu ifade eder. success yada failure değerleri dönebilmektedir.

locale

String

Dönen yanıtın dilini ifade eder.

systemTime

Long

Dönen sonucun o anki unix timestamp değeridir.

conversationId

String

İstek esnasında gönderilen değer dönmektedir.

accessToken

String

Member için servisler aracılığıyla ödeme tetikleyebileceği bearer token bilgisidir.

errorCode

String

İşlem hatalıysa, bu hataya dair belirtilen koddur.

errorMessage

String

İşlem hatalıysa, bu hataya dair detay belirtilen mesajdır, locale parametresine göre dil desteği sunar.

Last updated 8 months ago


Son Ödeme Bilgisi Alma
Member'a ait son ödeme bilgisinin detaylarının dönüldüğü servistir.  Access Token Sorgulama Servisinden den elde edilen accessToken ile gelinmelidir.

Retrieve Last Payment Info
POST https://api.iyzipay.com/v1/pay-with-iyzico/third-party-session/retrieve/last-payment-info

Headers

Name
Value
Content-Type

application/json

Authorization

Authorization

access-token

{{accessToken}}

İstek Parametreleri
Parametre
Tip
Açıklama
sessionToken

String

Member'ın aynı ödeme tipinde ödeme yaptığı session key bilgisidir.

memberIdentifier

String

Member unique key bilgisidir. Bu key, ödeme işlemlerinde member bilgisi için kullanılır.

locale

String

iyzico istek sonucunda dönen metinlerin dilini ayarlamak için kullanılır. Varsayılan değeri tr’dir. en olarak kullanılabilir.

conversationId

String

İstek esnasında gönderip, sonuçta alabileceğiniz bir değer, request/response eşleşmesi yapmak için kullanılabilir. En yaygın kullanış biçimi üye iş yerinin sipariş numarasıdır.

Örnek İstek

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "locale": "tr",
    "conversationId": "conversationId"
}
Örnek Yanıt
200
400

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749032543970,
    "conversationId": "conversationId",
    "card": {
        "cardHolderName": "John Doe",
        "cardAssociation": "MASTER_CARD",
        "cardFamily": "Advantage",
        "binNumber": "55047200",
        "lastFourDigits": "0003",
        "cardBankName": "HSBC",
        "cardType": "CREDIT_CARD",
        "expireMonth": "05",
        "expireYear": "2026",
        "expired": false,
        "willExpireSoon": false
    },
    "paymentType": "CARD_PAYMENT",
    "sessionToken": "f403ef2f-fb08-4111-afd6-495811ef6b25",
    "token": "e54b957b-a153-410c-8761-79c9bd4ff44f",
    "paymentId": 24259238
}
Yanıt Parametreleri
Parametre
Tip
Açıklama
status

String

İstek sonucunu ifade eder. success yada failure değerleri dönebilmektedir.

locale

String

Dönen yanıtın dilini ifade eder.

systemTime

Long

Dönen sonucun o anki unix timestamp değeridir.

conversationId

String

İstek esnasında gönderilen değer dönmektedir.

cardHolderName

String

Kart Sahibinin Adı Soyadı Bilgisidir.
Kart ile ödeme yapıldığında döner.

cardAssociation

String

Kart ile ödeme yapıldığında döner.
Geçerli değerler VISA, MASTER_CARD, AMERICAN_EXPRESS, TROY'dur

errorCode

String

İşlem hatalıysa, bu hataya dair belirtilen koddur.

errorMessage

String

İşlem hatalıysa, bu hataya dair detay belirtilen mesajdır, locale parametresine göre dil desteği sunar.

cardFamily

String

Kart ile ödeme yapıldığında döner.
Kart ailesi bilgisini döner. 
Geçerli değerler Bonus, Axess, World, Maximum, Paraf, CardFinans, Advantage

binNumber

String

Kart ile ödeme yapıldığında döner.
Kartın ilk 8 hanesi.

lastFourDigits

String

Kart ile ödeme yapıldığında döner.
Kartın son 4 hanesi.

cardBankName

String

Kart ile ödeme yapıldığında döner.
Kart Bankası Adı.

cardType

String

Kart ile ödeme yapıldığında döner.
Eğer ödeme yapılan kart yerel bir kart ise, kart tipi bilgisini döner. DEBIT_CARD ve CREDIT_CARD değerlerini alır.

expireMonth

String

Kart ile ödeme yapıldığında döner.
Son geçerlilik tarihi ay bazında döner.

expireYear

String

Kart ile ödeme yapıldığında döner.
Son geçerlilik tarihi yıl bazında döner.

expired

boolean

Kart ile ödeme yapıldığında döner.
Kartın expire bilgisi
true ve false değerlerini alır.
Kartın expire olmuşsa true döner.

willExpireSoon

boolean

Kart ile ödeme yapıldığında döner.
Kartın bu ay içerisinde expire olma bilgisidir. 
true ve false değerlerini alır.
Eğer bu ay içerisinde expire olacaksa true gelir.

paymentType

String

Ödeme tipini belirtir. FUND veya CARD_PAYMENT değerlerini dönebilir.
FUND: Bakiye Ödemesi
CARD_PAYMENT: Kart Ödemesi

sessionToken

String

Member'ın aynı ödeme tipinde ödeme yaptığı session key bilgisidir.

token

String

Checkout form için oluşturulan tekil değer. Her işlem için özel üretilir ve işyerine dönülür.

paymentId

Stirng

Ödemeye ait id, üye işyeri tarafından mutlaka saklanmalıdır. Ödemenin iptali ve iyzico ile iletişimde kullanılır.

Last updated 8 months ago



Son Ödeme Bilgisi ile Ödeme Başlatma
Elde edilen session bilgisi ile yapılan son ödeme türüne göre, aşağıdaki gibi iki farklı şekilde ödeme işlemi gerçekleştirilebilir.

Bakiye Ödemesi

Kart Ödemesi

Dönebilecek Ödeme Tipleri
Parametre
Açıklama
Gönderilecek Ödeme Tipleri
Son ödeme bakiye ile yapıldığında, paymentType "FUND" dönmektedir.

FUND

Bakiye ile Ödeme Yapıldığı Anlamına Gelir.

 Bu durumda sonraki ödeme isteğinde paymentType "FUND" gönderilmelidir.

Son ödeme Kart ile yapıldığında, paymentType "CARD_PAYMENT"  olarak dönmektedir.

NON3D

3DS Olmayan Ödeme Yöntemi

 2D İşlem için, "NON3D" olarak gönderilmelidir. 

Son ödeme Kart ile yapıldığında, paymentType "CARD_PAYMENT"  olarak dönmektedir.

3DS

3DS Ödeme Yöntemi

3DS İşlem için, "3DS" gönderilmelidir. Debit kartlarda 3DS olarak gönderilmelidir.

Last updated 8 months ago


Bakiye Ödeme Servisi
API-API bakiye ödemesi gerçekleştirmek için bu servis kullanılır. "Son Ödeme Bilgisi Alma" servisinden dönen paymentType verisi "FUND" ise bu servis kullanılır.

Fund Payment
POST https://api.iyzipay.com/v1/pay-with-iyzico/third-party-session/checkout/auth

Headers

Name
Value
Content-Type

application/json

Authorization

Authorization

access-token

{{accessToken}}

İstek Parametreleri
Parametre
Tip
Zorunluluk
Açıklama
conversationId

String

Hayır

İstek esnasında gönderip, sonuçta alabileceğiniz bir değer, request/response eşleşmesi yapmak için kullanılabilir.

locale

String

Hayır

iyzico istek sonucunda dönen metinlerin dilini ayarlamak için kullanılır. Varsayılan değeri tr’dir.

paymentType

String

Evet

Ödeme tipini belirtir. Bakiye Ödemesinde "FUND" olarak gönderilmelidir.

paidPrice

Decimal

Evet

Tahsil edilecek nihai tutar.

price

Decimal

Evet

Ödeme sepet tutarı. Kırılım tutarlar toplamı, sepet tutarına eşit olmalı.

callbackUrl

String

Evet

Ödeme akışında üye işyerine başarılı ve hatalı sonucu bildirmek üzere alınan URL adresi. Geçerli bir ssl sertifikasına sahip olmalıdır.

paymentGroup

String

Hayır

Ödeme grubu, varsayılan PRODUCT. Geçerli değerler enum içinde sunulmaktadır: PRODUCT, LISTING, SUBSCRIPTION

currency

String

Evet

Para birimi. Default değeri TRY’dir. Kullanılabilen diğer değerler ise USD, EUR, GBP’dir.

basketId

String

Hayır

Üye işyeri sepet id’si.

buyerId

String

Evet

Üye işyeri tarafındaki alıcıya ait id bilgisi.

buyerName

String

Evet

Üye işyeri tarafındaki alıcıya ait ad.

buyerSurname

String

Evet

Üye işyeri tarafındaki alıcıya ait soyadı.

identityNumber

String

Evet

Alıcıya ait TCKN bilgisi.

email

String

Evet

Üye işyeri tarafındaki alıcıya ait e-posta bilgisi. E-posta adresi alıcıya ait geçerli ve erişilebilir bir adres olmalıdır.

gsmNumber

String

Hayır

Üye işyeri tarafındaki alıcıya ait GSM numarası.

registrationAddress

String

Evet

Üye işyeri tarafındaki alıcıya ait kayıt adresi.

city

String

Evet

Üye işyeri tarafındaki alıcıya ait şehir bilgisi.

country

String

Evet

Üye işyeri tarafındaki alıcıya ait ülke bilgisi.

IP

String

Hayır

Üye işyeri tarafındaki alıcıya ait IP adresi.

zipCode

String

Evet

Üye işyeri tarafındaki alıcıya ait posta kodu.

address(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

contactName(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi ad soyad bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

city(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi şehir bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

country(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi ülke bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

zipCode(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi posta kodu.

address(billingAddress)

String

Evet

Alıcıya ait fatura adres bilgisi.

contactName(billingAddress)

String

Evet

Alıcıya ait fatura ad soyad bilgisi.

city(billingAddress)

String

Evet

Alıcıya ait fatura şehir bilgisi.

country(billingAddress)

String

Evet

Alıcıya ait fatura ülke bilgisi.

basketItemId

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait id. Not: Bir ödeme isteğine maksimum 500 basketItem eklenebilir.

basketItemPrice

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait tutar. 0 ve 0’dan küçük olamaz, tutarlar toplamı sepet tutarına (price) eşit olmalıdır.

basketItemName

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait ismi.

basketItemCategory1

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait 1. kategori.

basketItemCategory2

String

Hayır

Üye işyeri tarafındaki sepetteki ürüne ait 2. kategori.

basketItemItemType

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait tip. Geçerli enum değerler: PHYSICAL ve VIRTUAL

Örnek İstek

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "conversationId": "conversationId",
    "locale": "tr",
    "paymentType": "FUND",
    "paidPrice": 1.0,
    "price": 1.0,
    "callbackUrl": "callbackUrl",
    "paymentGroup": "PRODUCT",
    "currency": "TRY",
    "basketId": "B67832",
    "buyer": {
        "id": "BY789",
        "name": "John",
        "surname": "Doe",
        "identityNumber": "74300864111",
        "email": "sandboxtest0@gmail.com",
        "gsmNumber": "+905555555555",
        "registrationAddress": "Adres",
        "city": "Istanbul",
        "country": "Turkey",
        "ip": "buyer Ip",
        "zipCode": "34580"
    },
    "shippingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "billingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "basketItems": [
        {
            "id": "BI101",
            "price": 1.0,
            "name": "Binocular",
            "category1": "Collectibles",
            "itemType": "PHYSICAL"
        }
    ]
}
Örnek Yanıt
200
400

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1748553300302,
    "conversationId": "conversationId",
    "sessionToken": "16f60166-74ba-4e5c-ac52-31b5762652d4",
    "paymentId": 24233528,
    "paymentStatus": "SUCCESS",
    "checkoutToken": "7ce32610-9851-4b16-939a-5d4beae75475",
    "price": 1.00000000,
    "paidPrice": 1.00000000,
    "installment": 1,
    "fraudStatus": 1,
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0E-8,
    "iyziCommissionRateAmount": 0.01750000,
    "iyziCommissionFee": 0E-8,
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "26241258",
            "transactionStatus": 2,
            "price": 1.00000000,
            "paidPrice": 1.00000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.01750000,
            "iyziCommissionFee": 0E-8,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0,
            "blockageResolvedDate": "2025-05-31 00:00:00",
            "subMerchantPrice": 0,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0,
            "merchantPayoutAmount": 0.98250000,
            "convertedPayout": {
                "paidPrice": 1.00000000,
                "iyziCommissionRateAmount": 0.01750000,
                "iyziCommissionFee": 0E-8,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 0.98250000,
                "iyziConversionRate": 0,
                "iyziConversionRateAmount": 0,
                "currency": "TRY"
            }
        }
    ],
    "phase": "AUTH",
    "signature": "096cf80a59d611f1702803b91bc073300e9a57a5ab47e4a839e598fc13af3d5b"
}
Yanıt Parametreleri
Parametre İsmi
Tip
Açıklama
status

String

Yapılan isteğin sonucunu bildirir. Başarılı ise success, hatalı ise failure döner.

locale

String

İstekte belirtilen locale değeri geri dönülür, varsayılan değeri tr’dir.

systemTime

Long

Dönen sonucun o anki unix timestamp değeridir.

conversationId

String

İstek esnasında gönderilmişse, sonuçta aynen geri iletilir.

sessionToken

String

Member'ın aynı ödeme tipinde  yaptığı ödeme işlemine ait session key bilgisidir.

paymentId

String

Ödemeye ait id, üye işyeri tarafından mutlaka saklanmalıdır. Ödemenin iptali ve iyzico ile iletişimde kullanılır.

paymentStatus

String

Ödeme isteğinin durumunu gösterir. Success ise karttan ilgili tutar çekilmiştir. SUCCESS, FAILURE

checkoutToken

String

Checkout form için oluşturulan tekil değer. Her istek için özel üretilir ve işyerine dönülür. Ödemenin sonucunu öğrenmek için zorunlu bir alandır.

price

Decimal

Ödeme sepet tutarı. Kırılım tutarlar toplamı sepet tutarına eşit olmalı.

paidPrice

Decimal

İndirim vade farkı vs. hesaplanmış POS’tan geçen, tahsil edilen, nihai tutar.

installment

Integer

Ödemenin taksit bilgisi, tek çekim için 1 döner. Geçerli değerler: 1, 2, 3, 6, 9, 12

fraudStatus

String

Ödeme işleminin fraud filtrelerine göre durumu. Eğer ödemenin fraud risk skoru düşük ise ödemeye anında onay verilir bu durumda 1 değeri döner. Eğer fraud risk skoru yüksek ise ödeme işlemi reddedilir ve -1 döner. Eğer ödeme işlemi daha sonradan incelenip karar verilecekse 0 döner. Geçerli değerler: 0, -1 ve 1. Üye işyeri sadece 1 olan işlemlerde ürünü kargoya vermelidir, 0 olan işlemler için bilgilendirme beklemelidir.

merchantCommissionRate

Decimal

Üye işyerinin uyguladığı vade/komisyon oranı. Örneğin price=100, paidPrice=110 ise üye işyeri vade/komisyon oranı %10’dur. Bilgi amaçlıdır.

merchantCommissionRateAmount

Decimal

Üye işyerinin uyguladığı vade/komisyon tutarı. Örneğin price=100, paidPrice=110 ise üye işyeri vade/komisyon tutarı 10’dur. Bilgi amaçlıdır.

iyziCommissionRateAmount

Decimal

Ödemeye ait iyzico işlem komisyon tutarı.

iyziCommissionFee

Decimal

Ödemeye ait iyzico işlem ücreti .

currency

String

Ödemenin yapıldığı para birimi.

errorCode

String

İşlem hatalıysa, bu hataya dair belirtilen koddur.

errorMessage

String

İşlem hatalıysa, bu hataya dair belirtilen mesajdır, locale parametresine göre dil desteği sunar.

errorGroup

String

İşlem hatalıysa, bu hataya dair belirtilen gruptur.

itemId (ItemTransactions)

String

Üye işyeri tarafından iletilen, sepetteki ürüne ait id.

paymentTransactionId (ItemTransactions)

String

Ödeme kırılımına ait id, üye işyeri tarafından mutlaka saklanmalıdır. Ödeme kırılımının iadesi, onayı, onay geri çekmesi ve iyzico ile iletişimde kullanılır. Tercihen itemId ile ilişkili bir şekilde tutulmalıdır.

transactionStatus (ItemTransactions)

Integer

Ödeme kırılımının durumu. Ödeme fraud kontrolünde ise 0 değeri döner, bu durumda fraudStatus değeri de 0’dır. Ödeme, fraud kontrolünden sonra reddedilirse -1 döner. Pazaryeri modelinde ürüne onay verilene dek bu değer 1 olarak döner. Pazaryeri modelinde ürüne onay verilmişse bu değer 2 olur. Geçerli değerler: 0, -1, 1, 2.

price (ItemTransactions)

Decimal

Üye işyeri tarafındaki sepetteki ürüne ait tutar.

paidPrice(ItemTransactions)

Decimal

Tahsilat tutarının kırılım bazındaki dağılımı. Üye işyeri tarafından mutlaka saklanmalıdır.

merchantCommissionRate (ItemTransactions)

Decimal

Üye işyerinin uyguladığı vade/komisyon oranının kırılım bazında dağılmış oranı.

merchantCommissionRateAmount (ItemTransactions)

Decimal

Üye işyerinin uyguladığı vade/komisyon tutarıın, kırılım bazında dağılmış tutarı.

iyziCommissionRateAmount (ItemTransactions)

Decimal

iyzico işlem komisyon tutarının kırılım bazında dağılmış tutarı.

iyziCommissionFee (ItemTransactions)

Decimal

iyzico işlem ücretinin kırılım bazında dağılmış tutarı.

blockageRate (ItemTransactions)

Decimal

Kırılım bazında üye işyeri blokaj oranı. iyzico – üye işyeri anlaşmasına göre, üye işyerine işlem bazında blokaj uygulayabilir. Bu blokaj üye işyeri fraud riskini önlemek içindir, blokaj süresi boyunca para iyzico’da tutulur, bu süre sonrasında üye işyerine gönderilir.

blockageRateAmountMerchant (ItemTransactions)

Decimal

Kırılım bazında üye işyeri blokaj tutarının, üye işyerine yansıyan rakamı. Blokaj tutarı mümkün olduğunca üye işyerine yansıtılır. Eğer blokaj tutarı, üye işyeri tutarından daha büyükse bu durumda alt üye işyerine de yansıtılır.

blockageResolvedDate (ItemTransactions)

String

İşlem bazında blokaj çözülme tarihi. yyyy-MM-dd HH:mm:ss formatındadır, örneğin 2015-10-19 14:36:52.

merchantPayoutAmount (ItemTransactions)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

paidPrice(convertedPayout)

Decimal

Tahsilat tutarının kırılım bazındaki dağılımı. Üye işyeri tarafından mutlaka saklanmalıdır.

iyziCommissionRateAmount (convertedPayout)

Decimal

iyzico işlem komisyon tutarının kırılım bazında dağılmış tutarı.

iyziCommissionFee (convertedPayout)

Decimal

iyzico işlem ücretinin kırılım bazında dağılmış tutarı.

blockageRateAmountMerchant (convertedPayout)

Decimal

Kırılım bazında üye işyeri blokaj tutarının, üye işyerine yansıyan rakamı. Blokaj tutarı mümkün olduğunca üye işyerine yansıtılır. Eğer blokaj tutarı, üye işyeri tutarından daha büyükse bu durumda alt üye işyerine de yansıtılır.

merchantPayoutAmount (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

iyziConversationRate (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

iyziConversationRateAmount (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

currency(convertedPayout)

String

Ödemenin alındığı para birimi.

phase

String

Ödeme fazı bilgisi. AUTH değerini alır.

signature

String

İmza doğrulaması için kullanılabilecek signature değeridir.



Kart Ödeme Servisi
Tokenization ödeme yöntemi ile kart ödemesi gerçekleştirmek için bu servis kullanılır. "Son Ödeme Bilgisi Alma" servisinden dönen paymentType "CARD_PAYMENT" ise bu ödeme servisi tetiklenmelidir.

paymentType alanında gönderilen değer, NON3D olsa dahi iyzico dinamik 3DS yapısı gereği o işlem 3DS olarak geçmesi gerekiyorsa, dönen response şemasında threeDSHtmlContent verisi dönebilir.

Card Payment Service
POST https://api.iyzipay.com/v1/pay-with-iyzico/third-party-session/checkout/auth

Headers

Name
Value
Content-Type

application/json

Authorization

Authorization

access-token

{{accessToken}}

İstek Parametreleri
Parametre
Tip
Zorunluluk
Açıklama
sessionToken

String

Evet

Member'ın aynı ödeme tipinde ödeme yaptığı session key bilgisidir.

memberIdentifier

String

Evet

Member unique key bilgisidir. Bu key, ödeme işlemlerinde member bilgisi için kullanılır.

conversationId

String

Hayır

İstek esnasında gönderip, sonuçta alabileceğiniz bir değer, request/response eşleşmesi yapmak için kullanılabilir.

locale

String

Hayır

iyzico istek sonucunda dönen metinlerin dilini ayarlamak için kullanılır. Varsayılan değeri tr’dir.

paymentType

String

Evet

Ödemenin yapılacağı türü belirtir. Kart Ödemelerinde "3DS" veya "NON3D" olarak gönderilmelidir.

paidPrice

Decimal

Evet

Tahsil edilecek nihai tutar.

price

Decimal

Evet

Ödeme sepet tutarı. Kırılım tutarlar toplamı, sepet tutarına eşit olmalı.

callbackUrl

String

Evet

Ödeme akışında üye işyerine başarılı ve hatalı sonucu bildirmek üzere alınan URL adresi. Geçerli bir ssl sertifikasına sahip olmalıdır.

paymentGroup

String

Hayır

Ödeme grubu, varsayılan PRODUCT. Geçerli değerler enum içinde sunulmaktadır: PRODUCT, LISTING, SUBSCRIPTION

currency

String

Evet

Para birimi. Default değeri TRY’dir. Kullanılabilen diğer değerler ise USD, EUR, GBP’dir.

basketId

String

Hayır

Üye işyeri sepet id’si.

buyerId

String

Evet

Üye işyeri tarafındaki alıcıya ait id bilgisi.

buyerName

String

Evet

Üye işyeri tarafındaki alıcıya ait ad.

buyerSurname

String

Evet

Üye işyeri tarafındaki alıcıya ait soyadı.

identityNumber

String

Evet

Alıcıya ait TCKN bilgisi.

email

String

Evet

Üye işyeri tarafındaki alıcıya ait e-posta bilgisi. E-posta adresi alıcıya ait geçerli ve erişilebilir bir adres olmalıdır.

gsmNumber

String

Hayır

Üye işyeri tarafındaki alıcıya ait GSM numarası.

registrationAddress

String

Evet

Üye işyeri tarafındaki alıcıya ait kayıt adresi.

city

String

Evet

Üye işyeri tarafındaki alıcıya ait şehir bilgisi.

country

String

Evet

Üye işyeri tarafındaki alıcıya ait ülke bilgisi.

IP

String

Hayır

Üye işyeri tarafındaki alıcıya ait IP adresi.

zipCode

String

Evet

Üye işyeri tarafındaki alıcıya ait posta kodu.

address(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

contactName(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi ad soyad bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

city(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi şehir bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

country(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi ülke bilgisi. Sepetteki ürünlerden en az 1 tanesi fiziksel ürün (itemType=PHYSICAL) ise zorunludur.

zipCode(shippingAddress)

String

Evet

Üye işyeri tarafındaki teslimat adresi posta kodu.

address(billingAddress)

String

Evet

Alıcıya ait fatura adres bilgisi.

contactName(billingAddress)

String

Evet

Alıcıya ait fatura ad soyad bilgisi.

city(billingAddress)

String

Evet

Alıcıya ait fatura şehir bilgisi.

country(billingAddress)

String

Evet

Alıcıya ait fatura ülke bilgisi.

basketItemId

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait id. Not: Bir ödeme isteğine maksimum 500 basketItem eklenebilir.

basketItemPrice

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait tutar. 0 ve 0’dan küçük olamaz, tutarlar toplamı sepet tutarına (price) eşit olmalıdır.

basketItemName

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait ismi.

basketItemCategory1

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait 1. kategori.

basketItemCategory2

String

Hayır

Üye işyeri tarafındaki sepetteki ürüne ait 2. kategori.

basketItemItemType

String

Evet

Üye işyeri tarafındaki sepetteki ürüne ait tip. Geçerli enum değerler: PHYSICAL ve VIRTUAL

Örnek 3DS İsteği

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "conversationId": "conversationId",
    "locale": "tr",
    "paymentType": "3DS",
    "paidPrice": 1.0,
    "price": 1.0,
    "callbackUrl": "callbackUrl",
    "paymentGroup": "PRODUCT",
    "currency": "TRY",
    "basketId": "B67832",
    "buyer": {
        "id": "BY789",
        "name": "John",
        "surname": "Doe",
        "identityNumber": "74300864111",
        "email": "sandboxtest@gmail.com",
        "gsmNumber": "+905555555555",
        "registrationAddress": "Adres",
        "city": "Istanbul",
        "country": "Turkey",
        "ip": "buyer Ip",
        "zipCode": "34580"
    },
    "shippingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "billingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "basketItems": [
        {
            "id": "BI101",
            "price": 1.0,
            "name": "Binocular",
            "category1": "Collectibles",
            "itemType": "PHYSICAL"
        }
    ]
}
Örnek 3DS Yanıtı

200
400

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1749027890082,
    "conversationId": "conversationId",
    "sessionToken": "d53edb72-53f3-46f4-995d-43570a97bd88",
    "paymentId": 24258864,
    "threeDSHtmlContent": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8dGl0bGU+aXl6aWNvIE1vY2sgM0QtU2VjdXJlIFByb2Nlc3NpbmcgUGFnZTwvdGl0bGU+CjwvaGVhZD4KPGJvZHk+Cjxmb3JtIGlkPSJpeXppY28tM2RzLWZvcm0iIGFjdGlvbj0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L21vY2svaW5pdDNkcyIgbWV0aG9kPSJwb3N0Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9Im9yZGVySWQiIHZhbHVlPSJtb2NrNDYtODc2NzgxNDM2MDk1ODAxMGl5emlvcmQiPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iYmluIiB2YWx1ZT0iNTg5MDA0Ij4KICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InN1Y2Nlc3NVcmwiIHZhbHVlPSJodHRwczovL3NhbmRib3gtYXBpLml5emlwYXkuY29tL3BheW1lbnQvaXl6aXBvcy9jaGVja291dGZvcm0vY2FsbGJhY2szZHMvc3VjY2Vzcy8yNyI+CiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJmYWlsdXJlVXJsIiB2YWx1ZT0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L2l5emlwb3MvY2hlY2tvdXRmb3JtL2NhbGxiYWNrM2RzL2ZhaWx1cmUvMjciPgogICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iY29uZmlybWF0aW9uVXJsIiB2YWx1ZT0iaHR0cHM6Ly9zYW5kYm94LWFwaS5peXppcGF5LmNvbS9wYXltZW50L21vY2svY29uZmlybTNkcyI+CiAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJQYVJlcSIgdmFsdWU9IjE4ZThlZGVhLTY2ZjgtNDg4NS05OTNkLWIyYTQ5MzFlNTY0MCI+CjwvZm9ybT4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIml5emljby0zZHMtZm9ybSIpLnN1Ym1pdCgpOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+",
    "checkoutToken": "1479d5ba-d52d-4fae-8f1c-9d9c75991f2a",
    "signature": "40c72c0d631861c7f1454baffc8f141e7947699dbe22c14ca40f75bdf775fae6"
}
threeDSHtmlContent, iyzico’nun kartlı ödemelerde 3D Secure doğrulama akışını başlatmak için döndüğü, HTML içerikli bir form bilgisidir. Bu içerik, kullanıcıyı kart bankasının 3D doğrulama ekranına yönlendirmek için kullanılır. Bu durumda kullanıcı 3D doğrulama sürecine yönlendirilmelidir.

3DS Yanıt Parametreleri
Parametre
Tip
Açıklama
status

String

İstek sonucunu döner. success ya da failure değerlerini dönebilir.

locale

String

İstek gönderilen, dilde yanıt dönmektedir.

systemTime

Long

İstek anındaki unix zaman değerini ifade eder.

conversationId

String

İstek esnasında gönderilen değer aynen geri iletilir.

sessionToken

String

Member'ın aynı ödeme tipinde ödeme yaptığı session key bilgisidir.

paymentId

Long

iyzico tarafından üretilen uniq ödeme numarası bilgisidir.

paymentStatus

String

Ödeme durum bilgisidir. SUCCESS ve FAILURE değerini alabilir.

threeDSHtmlContent

String

Banka doğrulama ekranının yer aldığı html sayfasını dönmektedir.

checkoutFormToken

String

İşleme ait checkoutform token değeridir.

signature

String

İmza doğrulaması yapılabilecek signature değeridir.

Örnek NON3D İsteği

Copy
{
    "sessionToken": "{{sessionToken}}",
    "memberIdentifier": "{{memberIdentifier}}",
    "conversationId": "conversationId",
    "locale": "tr",
    "paymentType": "NON3D",
    "paidPrice": 1.0,
    "price": 1.0,
    "callbackUrl": "callbackUrl",
    "paymentGroup": "PRODUCT",
    "currency": "TRY",
    "basketId": "B67832",
    "buyer": {
        "id": "BY789",
        "name": "John",
        "surname": "Doe",
        "identityNumber": "74300864111",
        "email": "sandboxtest@gmail.com",
        "gsmNumber": "+905555555555",
        "registrationAddress": "Adres",
        "city": "Istanbul",
        "country": "Turkey",
        "ip": "buyer Ip",
        "zipCode": "34580"
    },
    "shippingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "billingAddress": {
        "address": "Altunizade Mah. İnci Çıkmazı Sokak No: 3 İç Kapı No: 10",
        "contactName": "Jane Doe",
        "city": "Istanbul",
        "country": "Turkey",
        "zipCode": "34580"
    },
    "basketItems": [
        {
            "id": "BI101",
            "price": 1.0,
            "name": "Binocular",
            "category1": "Collectibles",
            "itemType": "PHYSICAL"
        }
    ]
}
NON3D Yanıtı
200
400

Copy
{
    "status": "success",
    "locale": "tr",
    "systemTime": 1748586032474,
    "conversationId": "conversationId",
    "sessionToken": "4b34eadc-050e-4767-b4b8-d12199962ee3",
    "paymentId": 24235314,
    "paymentStatus": "success",
    "callbackUrl": "callbackUrl",
    "checkoutToken": "b1553768-bc13-495d-9b7a-d1b0663561c2",
    "price": 1.00000000,
    "paidPrice": 1.00,
    "installment": 1,
    "fraudStatus": 1,
    "merchantCommissionRate": 0E-8,
    "merchantCommissionRateAmount": 0E-8,
    "iyziCommissionRateAmount": 0.01750000,
    "iyziCommissionFee": 0E-8,
    "cardAssociation": "MASTER_CARD",
    "cardFamily": "Axess",
    "cardType": "CREDIT_CARD",
    "binNumber": "552608",
    "lastFourDigits": "0006",
    "currency": "TRY",
    "itemTransactions": [
        {
            "itemId": "BI101",
            "paymentTransactionId": "26243042",
            "transactionStatus": 2,
            "price": 1.00000000,
            "paidPrice": 1.00000000,
            "merchantCommissionRate": 0E-8,
            "merchantCommissionRateAmount": 0E-8,
            "iyziCommissionRateAmount": 0.01750000,
            "iyziCommissionFee": 0E-8,
            "blockageRate": 0E-8,
            "blockageRateAmountMerchant": 0E-8,
            "blockageRateAmountSubMerchant": 0,
            "blockageResolvedDate": "2025-05-31 00:00:00",
            "subMerchantPrice": 0,
            "subMerchantPayoutRate": 0E-8,
            "subMerchantPayoutAmount": 0,
            "merchantPayoutAmount": 0.98250000,
            "convertedPayout": {
                "paidPrice": 1.00000000,
                "iyziCommissionRateAmount": 0.01750000,
                "iyziCommissionFee": 0E-8,
                "blockageRateAmountMerchant": 0E-8,
                "blockageRateAmountSubMerchant": 0E-8,
                "subMerchantPayoutAmount": 0E-8,
                "merchantPayoutAmount": 0.98250000,
                "iyziConversionRate": 0,
                "iyziConversionRateAmount": 0,
                "currency": "TRY"
            }
        }
    ],
    "authCode": "688736",
    "phase": "AUTH",
    "hostReference": "mock00007iyzihostrfn",
    "signature": "312bb9c20466a0758c77184c0e32fc9ca2fbbfdfad60ab85d9d38da1afa63824"
}
NON3D Yanıt Parametreleri
Parametre İsmi
Tip
Açıklama
status

String

Yapılan isteğin sonucunu bildirir. Başarılı ise success, hatalı ise failure döner.

locale

String

İstekte belirtilen locale değeri geri dönülür, varsayılan değeri tr’dir.

systemTime

Long

Dönen sonucun o anki unix timestamp değeridir.

conversationId

String

İstek esnasında gönderilmişse, sonuçta aynen geri iletilir.

sessionToken

String

Member'ın aynı ödeme tipinde  yaptığı ödeme işlemine ait session key bilgisidir.

paymentId

String

Ödemeye ait id, üye işyeri tarafından mutlaka saklanmalıdır. Ödemenin iptali ve iyzico ile iletişimde kullanılır.

paymentStatus

String

Ödeme isteğinin durumunu gösterir. Success ise karttan ilgili tutar çekilmiştir. SUCCESS, FAILURE

callbackUrl

String

İstekte belirtilen ve işlem sonucunda yönlendirilen URL adres bilgisidir.

checkoutToken

String

Checkout form için oluşturulan tekil değer. Her istek için özel üretilir ve işyerine dönülür. Ödemenin sonucunu öğrenmek için zorunlu bir alandır.

price

Decimal

Ödeme sepet tutarı. Kırılım tutarlar toplamı sepet tutarına eşit olmalı.

paidPrice

Decimal

İndirim vade farkı vs. hesaplanmış POS’tan geçen, tahsil edilen, nihai tutar.

installment

Integer

Ödemenin taksit bilgisi, tek çekim için 1 döner. Geçerli değerler: 1, 2, 3, 6, 9, 12

fraudStatus

Integer

Ödeme işleminin fraud filtrelerine göre durumu. Eğer ödemenin fraud risk skoru düşük ise ödemeye anında onay verilir, bu durumda 1 değeri döner. Eğer fraud risk skoru yüksek ise ödeme işlemi reddedilir ve -1 döner. Eğer ödeme işlemi daha sonradan incelenip karar verilecekse 0 döner. Geçerli değerler: 0, -1 ve 1. Üye işyeri sadece 1 olan işlemlerde ürünü kargoya vermelidir, 0 olan işlemler için bilgilendirme beklemelidir.

merchantCommissionRate

Decimal

Üye işyerinin uyguladığı vade/komisyon oranı. Örneğin price=100, paidPrice=110 ise üye işyeri vade/komisyon oranı %10’dur. Bilgi amaçlıdır.

merchantCommissionRateAmount

Decimal

Üye işyerinin uyguladığı vade/komisyon tutarı. Örneğin price=100, paidPrice=110 ise üye işyeri vade/komisyon tutarı 10’dur. Bilgi amaçlıdır.

iyziCommissionRateAmount

Decimal

Ödemeye ait iyzico işlem komisyon tutarı.

iyziCommissionFee

Decimal

Ödemeye ait iyzico işlem ücreti .

basketId

String

Üye işyeri tarafından gönderilen sepet id’si.

currency

String

Ödemenin yapıldığı para birimi.

errorCode

String

İşlem hatalıysa, bu hataya dair belirtilen koddur.

errorMessage

String

İşlem hatalıysa, bu hataya dair belirtilen mesajdır, locale parametresine göre dil desteği sunar.

errorGroup

String

İşlem hatalıysa, bu hataya dair belirtilen gruptur.

currency

String

Ödemenin alındığı para birimi.

itemId (ItemTransactions)

String

Üye işyeri tarafından iletilen, sepetteki ürüne ait id.

transactionStatus (ItemTransactions)

Integer

Ödeme kırılımının durumu. Ödeme fraud kontrolünde ise 0 değeri döner, bu durumda fraudStatus değeri de 0’dır. Ödeme, fraud kontrolünden sonra reddedilirse -1 döner. Pazaryeri modelinde ürüne onay verilene dek bu değer 1 olarak döner. Pazaryeri modelinde ürüne onay verilmişse bu değer 2 olur. Geçerli değerler: 0, -1, 1, 2.

paymentTransactionId (ItemTransactions)

String

Ödeme kırılımına ait id, üye işyeri tarafından mutlaka saklanmalıdır. Ödeme kırılımının iadesi, onayı, onay geri çekmesi ve iyzico ile iletişimde kullanılır. Tercihen itemId ile ilişkili bir şekilde tutulmalıdır.

price (ItemTransactions)

Decimal

Üye işyeri tarafındaki sepetteki ürüne ait tutar.

paidPrice (ItemTransactions)

Decimal

Tahsilat tutarının kırılım bazındaki dağılımı. Üye işyeri tarafından mutlaka saklanmalıdır.

merchantCommissionRate (ItemTransactions)

Decimal

Üye işyerinin uyguladığı vade/komisyon oranının kırılım bazında dağılmış oranı.

merchantCommissionRateAmount (ItemTransactions)

Decimal

Üye işyerinin uyguladığı vade/komisyon tutarıın, kırılım bazında dağılmış tutarı.

iyziCommissionRateAmount (ItemTransactions)

Decimal

iyzico işlem komisyon tutarının kırılım bazında dağılmış tutarı.

iyziCommissionFee (ItemTransactions)

Decimal

iyzico işlem ücretinin kırılım bazında dağılmış tutarı.

blockageRate (ItemTransactions)

Decimal

Kırılım bazında üye işyeri blokaj oranı. iyzico – üye işyeri anlaşmasına göre, üye işyerine işlem bazında blokaj uygulayabilir. Bu blokaj üye işyeri fraud riskini önlemek içindir, blokaj süresi boyunca para iyzico’da tutulur, bu süre sonrasında üye işyerine gönderilir.

blockageRateAmountMerchant (ItemTransactions)

Decimal

Kırılım bazında üye işyeri blokaj tutarının, üye işyerine yansıyan rakamı. Blokaj tutarı mümkün olduğunca üye işyerine yansıtılır. Eğer blokaj tutarı, üye işyeri tutarından daha büyükse bu durumda alt üye işyerine de yansıtılır.

blockageResolvedDate (ItemTransactions)

String

İşlem bazında blokaj çözülme tarihi. yyyy-MM-dd HH:mm:ss formatındadır, örneğin 2015-10-19 14:36:52.

merchantPayoutAmount (ItemTransactions)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

paidPrice(convertedPayout)

Decimal

Tahsilat tutarının kırılım bazındaki dağılımı. Üye işyeri tarafından mutlaka saklanmalıdır.

iyziCommissionRateAmount (convertedPayout)

Decimal

iyzico işlem komisyon tutarının kırılım bazında dağılmış tutarı.

iyziCommissionFee (convertedPayout)

Decimal

iyzico işlem ücretinin kırılım bazında dağılmış tutarı.

blockageRateAmountMerchant (convertedPayout)

Decimal

Kırılım bazında üye işyeri blokaj tutarının, üye işyerine yansıyan rakamı. Blokaj tutarı mümkün olduğunca üye işyerine yansıtılır. Eğer blokaj tutarı, üye işyeri tutarından daha büyükse bu durumda alt üye işyerine de yansıtılır.

merchantPayoutAmount (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

iyziConversationRate (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

iyziConversationRateAmount (convertedPayout)

Decimal

Bu kırılım için, iyzico işlem ücreti, komisyon tutarı ve blokajlar düşüldükten sonra üye işyerine gönderilecek tutar.

currency (convertedPayout)

String

Ödemenin alındığı para birimi.

authCode

String

iyzico tarafından üretilen uniq değer.

phase

String

Ödeme fazı bilgisi. AUTH değerini alır.

signature

String

İmza doğrulaması için kullanılabilecek signature değeridir.

cardType

String

Sadece kartlı ödemelerde döner. Eğer ödeme yapılan kart yerel bir kart ise, kart tipi bilgisini döner. DEBIT_CARD ve CREDIT_CARD değerlerini alır.

cardAssociation

String

Sadece kartlı ödemelerde döner. 
Eğer ödeme yapılan kart yerel bir kart ise, kartın ait olduğu kuruluş. Geçerli değerler: VISA, MASTER_CARD, AMERICAN_EXPRESS, TROY

cardFamily

String

Sadece kartlı ödemelerde döner. 
Eğer ödeme yapılan kart yerel bir kart ise, kartın ait olduğu aile. Geçerli değerler: Bonus, Axess, World, Maximum, Paraf, CardFinans, Advantage

binNumber

String

Ödeme yapılan kartın ilk 6 hanesi.

lastFourDigits

String

Ödeme yapılan kartın son 4 hanesi.



Havale/EFT Sorgulama
Banka Transferi sürecini tamamlayan müşteriler "Alışverişi Tamamla" tuşuna bastığında; Havale/EFT başlatırken belirlediğiniz callbackUrl adresine yönlendirir ve bu adrese bir token değeri post edilir. Bu token değeri ile ikinci bir sorgu yapılabilir. Dönen cevapta paymentStatus değeri kontrol edilmelidir. Ödeme durumunu sistematik olarak kontrol etmek isterseniz, bu isteği belirli aralıklarla tekrarlayabilirsiniz. Bu istek sonucunda işlem sonucuna dair ayrıntılar alınmaktadır. Bu sorguda kullanacağınız token değerini havale/EFT formunu oluşturduğunuz anda ya da callbackUrl adresinize iyzico tarafından post edildiğinde alabilirsiniz. Ödeme eşleşmesi gerçekleştiğinde ayrıca webhookURL adresine bir notification gönderilecektir.

NOT : Müşteriye ürün/hizmet sunumu sadece paymentStatus: SUCCESS durumunda yapılmalıdır. Diğer ödeme durumlarında ödeme başarılı değildir.

Örnek Webhook Bildirimi

Copy
{
  "paymentConversationId": "123456789",
  "merchantId": 3404590,
  "status": "SUCCESS",
  "token": "d0d4723b-2f67-4719-a59a-dc8b3aaa795d",
  "iyziReferenceCode": "ef6a92ca-3b25-45a0-9ecd-7b87e15309ca",
  "iyziEventType": "BANK_TRANSFER_AUTH",
  "iyziEventTime": 1762239641852,
  "iyziPaymentId": 27553416
}


iyzico Link API
iyzilink API içerisinde yer alan servisler aşağıda listelenmiştir.

iyzico Link Oluşturma

Fastlink Oluşturma

iyzico Link Detayı

iyzico Link Listeleme

iyzico Link Güncelleme

iyzico Link Durum Güncelleme

iyzico Link Silme

iyzico Link Oluşturma
post

https://api.iyzipay.com
/v2/iyzilink/products
Yeni bir iyzico Link oluşturmak için kullanılır. Başarılı yanıtta link url'sini döner. Dönen url parametresini müşterilerinize ileterek kullanabilirsiniz.

Header parameters
Authorization
string
IYZWSv2 ile başlayan imza değeri (Base64). Örn: IYZWSv2 YXBpS2V5On...

Example: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type
string · enum
İstek gövdesi formatı.

Example: application/json
Possible values: application/json
Body

application/json

application/json
conversationId
string
İstek/yanıt eşleştirme için gönderilen değer.

Example: 123456
locale
string
Yanıt dili (tr|en). Varsayılan tr.

Example: tr
name
string
Ürünün adı (müşteriye görünür).

Example: Örnek Ürün
description
string
Ürünün açıklaması (müşteriye görünür).

Example: 10 Adet Kitap
price
string · decimal
Ürün fiyatı (decimal).

Example: 50.00
currencyCode
string · enum
Para birimi kodu.

Example: TRY
Possible values: TRYUSDEURGBPRUBCHFNOK
encodedImageFile
string
Ürün resminin base64'e çevrilmiş hali.

Example: a/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3k...
addressIgnorable
boolean
Satın alımda adres istenmesin (true) / istensin (false).

Example: true
installmentRequested
boolean · enum
Taksitli satış aktif/pasif.

Example: false
Possible values: truefalse
stockEnabled
boolean · enum
Stok kontrolü aktif/pasif.

Example: true
Possible values: truefalse
stockCount
integer
Stok sayısı.

Example: 25,
flexibleLink
boolean · enum
Üye işyerinin belirlediği 3 farklı tutardan birinin seçilerek veya müşterinin kendi girdiği tutar ile ödemenin tamamlamalarına olanak sağlamaktadır. Üye işyeri hesabında bu özelliğin aktif olması gerekmektedir.

Example: true
Possible values: truefalse
presetPriceValues
integer · enum
FlexibleLink'te gösterilecek tutarların bilgisi.

Example: 10
Possible values: 102030
categoryType
string · enum
Ürün kategori tipi. Default; "UNKNOWN" değerini alır.

Example: PHONE
Possible values: GOLDFOODPHONEUNKNOWNPCTABLET
Responses
200
Başarılı oluşturma yanıtı.

application/json

Response
all of
post
/v2/iyzilink/products
HTTP

Copy
POST /v2/iyzilink/products
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "conversationId": "123456",
  "locale": "tr",
  "name": "Örnek Ürün",
  "description": "10 Adet Kitap",
  "price": "50.00",
  "currencyCode": "TRY",
  "encodedImageFile": "/9j/4AAQSkZJRgABAQEAYABgAAD...",
  "addressIgnorable": true,
  "installmentRequested": false,
  "stockEnabled": true,
  "stockCount": 25,
  "flexibleLink": true,
  "presetPriceValues": [10.00, 20.00],
  "categoryType": "UNKNOWN"
}
200
Başarılı oluşturma yanıtı.


Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1687827915258,
  "conversationId": "123456",
  "data": {
    "token": "WxI",
    "url": "https://sandbox.iyzi.link/WxI",
    "imageUrl": "https://sandbox-img.iyzi.link/Wx/I.jpg"
  }
}
Örnek Kodlar
PHP

Java

.NET

Python

Postman

Fastlink Oluşturma
post

https://api.iyzipay.com
/v2/iyzilink/fast-link/products
Fastlink Oluşturur. Fast Link, 750 TL ve altı ödemeler için hızlı ve kolay bir şekilde ödeme alınmasını sağlayan çözümdür. Bir linkten yalnızca bir kere ödeme alınabilmektedir. Fastlink oluşturmak için önce onaylı bi iyzico link olması gerekmektedir.

Header parameters
Authorization
string
IYZWSv2 ile başlayan imza değeri (Base64). Örn: IYZWSv2 YXBpS2V5On...

Example: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type
string · enum
İstek gövdesi formatı.

Example: application/json
Possible values: application/json
Body

application/json

application/json
conversationId
string
İstek/yanıt eşleştirme için gönderilen değer.

Example: 123456
locale
string · enum
Yanıt dili (tr|en). Varsayılan tr.

Example: tr
Possible values: tren
description
string
Müşteriye görünecek link açıklaması.

Example: 10 Adet Kitap
price
string · decimal
Ürün fiyatı.

Example: 75.00
currencyCode
string
Para birimi kodu.

Example: TRY
Responses
200
Başarılı oluşturma yanıtı.

application/json

Response
all of
post
/v2/iyzilink/fast-link/products
HTTP

Copy
POST /v2/iyzilink/fast-link/products
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "conversationId": "123456",
  "locale": "tr",
  "description": "10 Adet Kitap",
  "price": "75.00",
  "currencyCode": "TRY"
}
200
Başarılı oluşturma yanıtı.


Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1687827915258,
  "conversationId": "123456",
  "data": {
    "token": "WxI",
    "url": "https://sandbox.iyzi.link/WxI",
    "imageUrl": "https://sandbox-img.iyzi.link/Wx/I.jpg"
  }
}
Örnek Kodlar
PHP

Postman

iyzico Link Sorgulama
get

https://api.iyzipay.com
/v2/iyzilink/products/
{token}
Token ile tek bir link sorgulayabilirsiniz. Sorgulanan token'a ait iyzico Link detayını döner.

Path parameters
token
string
Sorgulanmak istenen iyzico Link'e ait token değeri.

Example: WxI
Query parameters
locale
string
Yanıt dili (varsayılan tr).

Example: tr
conversationId
string
İstek/yanıt eşleştirme değeri.

Example: 123456
Header parameters
Authorization
string
IYZWSv2 ile başlayan imza değeri (Base64). Örn: IYZWSv2 YXBpS2V5On...

Example: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type
string · enum
İstek gövdesi formatı.

Example: application/json
Possible values: application/json
Responses
200
Ürün detay yanıtı.

application/json

Response
all of
get
/v2/iyzilink/products/{token}
HTTP

Copy
GET /v2/iyzilink/products/WxI?locale=tr&conversationId=123456
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json
200
Ürün detay yanıtı.


Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1687827915258,
  "conversationId": "123456",
  "data": {
    "name": "sample-name",
    "conversationId": "1123456789",
    "description": "10 Adet Kitap",
    "price": "50.00000000",
    "currencyId": 3,
    "currencyCode": "USD",
    "token": "Wx0",
    "productType": "IYZILINK",
    "productStatus": "ACTIVE",
    "merchantId": 376927,
    "url": "https://sandbox.iyzi.link/Wx0",
    "imageUrl": "https://sandbox-img.iyzi.link/Wx/0.jpg",
    "addressIgnorable": false,
    "soldCount": 0,
    "installmentRequested": false,
    "stockEnabled": false,
    "stockCount": 0,
    "presetPriceValues": [
      "50.00",
      "75.00",
      "100.00"
    ],
    "flexibleLink": false,
    "categoryType": "PHONE"
  }
}
Örnek Kodlar
PHP

Java

.NET

Python

Postman

iyzico Linkleri Listeleme
get

https://api.iyzipay.com
/v2/iyzilink/products
Oluşturulan tüm iyzico Linkleri sayfalı olarak listeler.

Query parameters
locale
string
Yanıt dili.

Example: tr
page
integer · min: 1
Sayfa numarası.

Example: 1
count
integer · min: 1 · max: 100
Sayfa başına ürün sayısı.

Example: 10
conversationId
string
İstek/yanıt eşleştirme için serbest metin alanı.

Example: test
Header parameters
Authorization
string
IYZWSv2 ile başlayan imza değeri (Base64). Örn: IYZWSv2 YXBpS2V5On...

Example: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type
string · enum
İstek gövdesi formatı.

Example: application/json
Possible values: application/json
Responses
200
Listeleme yanıtı.

application/json

Response
all of
get
/v2/iyzilink/products
HTTP

Copy
GET /v2/iyzilink/products?locale=tr&page=1&count=10&conversationId=test
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json
200
Listeleme yanıtı.


Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1756284905529,
  "conversationId": "123456789",
  "data": {
    "listingReviewed": true,
    "totalCount": 11,
    "currentPage": 1,
    "pageCount": 11,
    "items": [
      {
        "name": "link",
        "conversationId": "conversationId",
        "description": "description",
        "price": "80.00000000",
        "currencyId": 1,
        "currencyCode": "TRY",
        "token": "AAF9Bw",
        "productType": "IYZILINK",
        "productStatus": "ACTIVE",
        "merchantId": 3410007,
        "url": "https://sandbox.iyzi.link/AAF9Bw",
        "imageUrl": "https://sandbox-img.iyzi.link/AA/F9Bw+V3.jpg",
        "addressIgnorable": true,
        "soldCount": 1,
        "installmentRequested": false,
        "stockEnabled": true,
        "stockCount": 3,
        "presetPriceValues": [],
        "flexibleLink": false,
        "categoryType": "UNKNOWN"
      }
    ]
  }
}
Örnek Kodlar
PHP

Java

.NET

Python

Postman

iyzico Link Güncelleme
put

https://api.iyzipay.com
/v2/iyzilink/products/
{token}
iyzico Link oluşturduğunuzda dönen token değeri ile varolan iyzico Linkinizi güncelleyebilirsiniz.

Path parameters
token
string
Güncellenecek iyzilink’in token değeri.

Example: WxI
Header parameters
Authorization
string
IYZWSv2 ile başlayan imza değeri (Base64). Örn: IYZWSv2 YXBpS2V5On...

Example: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type
string · enum
İstek gövdesi formatı.

Example: application/json
Possible values: application/json
Body

application/json

application/json
Link güncelleme için gönderilebilecek alanlar (token path’te gönderilir).

conversationId
string
İstek/yanıt eşleştirmesi için gönderilen değer.

Example: 123456
locale
string
Yanıt dili (tr|en).

Example: tr
name
string
Ürün adı.

Example: Güncellenmiş Ürün
description
string
Ürün açıklaması.

Example: 10 Adet Kitap
price
string · decimal
Ürün fiyatı.

Example: 60.00
currencyCode
string
Para birimi kodu.

Example: TRY
encodedImageFile
string
Ürün resminin base64’e çevrilmiş hali.

Example: a/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3k...
addressIgnorable
boolean · enum
Adres istenmesin/istensin.

Example: false
Possible values: truefalse
installmentRequested
boolean · enum
Taksitli satış aktif/pasif.

Example: true
Possible values: truefalse
stockEnabled
boolean · enum
Stok kontrolü aktif/pasif.

Example: true
Possible values: truefalse
stockCount
integer
Stok sayısı.

Example: 12
categoryType
string · enum
Ürün kategori tipi. Default; "UNKNOWN" değerini alır.

Example: PHONE
Possible values: GOLDFOODPHONEUNKNOWNPCTABLET
Responses
200
Başarılı güncelleme yanıtı.

application/json

Response
all of
put
/v2/iyzilink/products/{token}
HTTP

Copy
PUT /v2/iyzilink/products/WxI
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json

{
  "conversationId": "123456",
  "name": "Güncellenmiş Ürün",
  "description": "10 Adet Kitap",
  "price": "60.00",
  "currencyCode": "TRY",
  "encodedImageFile": "/9j/4AAQSkZJRgABAQEAYABgAAD...",
  "addressIgnorable": false,
  "installmentRequested": true,
  "stockEnabled": true,
  "stockCount": 12
}
200
Başarılı güncelleme yanıtı.


Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1687827915258,
  "conversationId": "123456",
  "data": {
    "token": "WxI",
    "url": "https://sandbox.iyzi.link/WxI",
    "imageUrl": "https://sandbox-img.iyzi.link/Wx/I.jpg"
  }
}
Örnek Kodlar
PHP

Java

.NET

Python

Postman

iyzico Link Statü Güncelleme
patch

https://api.iyzipay.com
/v2/iyzilink/products/
{token}
/status/
{status}
Bir iyzico link’in durumunu ACTIVE veya PASSIVE yapar. iyzico Link'e ait token değeri ve güncellenecek statü değerinin kullanılması gerekmektedir.

Path parameters
token
string
iyzico link'e ait token değeri.

Example: WxI
status
string · enum
Güncellenecek yeni durum.

Example: PASSIVE
Possible values: ACTIVEPASSIVE
Query parameters
locale
string
Yanıt dili (varsayılan tr).

Example: tr
conversationId
string
İstek/yanıt eşleştirme değeri.

Example: 123456
Header parameters
Authorization
string
IYZWSv2 ile başlayan imza değeri (Base64). Örn: IYZWSv2 YXBpS2V5On...

Example: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type
string · enum
İstek gövdesi formatı.

Example: application/json
Possible values: application/json
Responses
200
Durum güncelleme sonucu.

application/json

Response
object
patch
/v2/iyzilink/products/{token}/status/{status}
HTTP

Copy
PATCH /v2/iyzilink/products/WxI/status/PASSIVE?locale=tr&conversationId=123456
Authorization: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type: application/json
200
Durum güncelleme sonucu.


Copy
{
  "status": "success",
  "locale": "tr",
  "systemTime": 1687827915258,
  "conversationId": "123456"
}
Örnek Kodlar
PHP

Postman

iyzico Link Silme
delete

https://api.iyzipay.com
/v2/iyzilink/products/
{token}
Bir iyzico Link'i silmek için kullanılır.

Path parameters
token
string
Silinecek iyzico link token’ı.

Example: WxI
Query parameters
locale
string
Yanıt dili (varsayılan tr).

Example: tr
conversationId
string
İstek/yanıt eşleştirme değeri.

Example: 123456
Header parameters
Authorization
string
IYZWSv2 ile başlayan imza değeri (Base64). Örn: IYZWSv2 YXBpS2V5On...

Example: IYZWSv2 YXBpS2V5OnNhbmRib....E0OGI1MTE=
Content-Type
string · enum
İstek gövdesi formatı.

Example: application/json
Possible values: application/json
Responses
200
Silme sonucu.

application/json

Response
object



API Anahtarları
API Anahtarı
kgvpLKB9EUfzNV64Y40a2wV0JijXbSEK
Güvenlik Anahtarı
Qb1HcmeZEnSjIygCtVASbpUpiMrXrIPb